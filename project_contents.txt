=== app/Http/Resources/CompanyResource.php ===
<?php

namespace App\Http\Resources;

use Illuminate\Http\Request;
use Illuminate\Http\Resources\Json\JsonResource;

class CompanyResource extends JsonResource
{
    public function toArray(Request $request): array
    {
        return [
            'id' => $this->id,
            'name' => $this->name,
            'description' => $this->description,
            'created_at' => $this->created_at,
            'updated_at' => $this->updated_at,
        ];
    }
}



=== app/Http/Resources/ResourceTypeResource.php ===
<?php

namespace App\Http\Resources;

use Illuminate\Http\Request;
use Illuminate\Http\Resources\Json\JsonResource;

class ResourceTypeResource extends JsonResource
{
    public function toArray(Request $request): array
    {
        return [
            'id' => $this->id,
            'company_id' => $this->company_id,
            'timetable_id' => $this->timetable_id,
            'type' => $this->type,
            'name' => $this->name,
            'description' => $this->description,
            'options' => $this->options,
            'resource_config' => $this->resource_config,
            'created_at' => $this->created_at,
            'updated_at' => $this->updated_at,
            'company' => new CompanyResource($this->whenLoaded('company')),
            'timetable' => new TimetableResource($this->whenLoaded('timetable')),
            'resources' => ResourceResource::collection($this->whenLoaded('resources')),
        ];
    }
}



=== app/Http/Resources/ResourceResource.php ===
<?php

namespace App\Http\Resources;

use Illuminate\Http\Request;
use Illuminate\Http\Resources\Json\JsonResource;

class ResourceResource extends JsonResource
{
    public function toArray(Request $request): array
    {
        return [
            'id' => $this->id,
            'company_id' => $this->company_id,
            'timetable_id' => $this->timetable_id,
            'resource_type_id' => $this->resource_type_id,
            'options' => $this->options,
            'payload' => $this->payload,
            'resource_config' => $this->resource_config,
            'created_at' => $this->created_at,
            'updated_at' => $this->updated_at,
            'company' => new CompanyResource($this->whenLoaded('company')),
            'timetable' => new TimetableResource($this->whenLoaded('timetable')),
            'resource_type' => new ResourceTypeResource($this->whenLoaded('resourceType')),
        ];
    }
}



=== app/Http/Resources/TimetableResource.php ===
<?php

namespace App\Http\Resources;

use Illuminate\Http\Request;
use Illuminate\Http\Resources\Json\JsonResource;

class TimetableResource extends JsonResource
{
    public function toArray(Request $request): array
    {
        return [
            'id' => $this->id,
            'company_id' => $this->company_id,
            'type' => $this->type,
            'schedule' => $this->schedule,
            'created_at' => $this->created_at,
            'updated_at' => $this->updated_at,
            'company' => new CompanyResource($this->whenLoaded('company')),
            'resource_types' => ResourceTypeResource::collection($this->whenLoaded('resourceTypes')),
            'resources' => ResourceResource::collection($this->whenLoaded('resources')),
        ];
    }
}



=== app/Http/Resources/BookingResource.php ===
<?php

namespace App\Http\Resources;

use Illuminate\Http\Request;
use Illuminate\Http\Resources\Json\JsonResource;

class BookingResource extends JsonResource
{
    public function toArray(Request $request): array
    {
        return [
            'id' => $this->id,
            'company_id' => $this->company_id,
            'resource_id' => $this->resource_id,
            'timetable_id' => $this->timetable_id,
            'is_group_booking' => $this->is_group_booking,
            'start' => $this->start,
            'end' => $this->end,
            'status' => $this->status,
            'reason' => $this->reason,
            'created_at' => $this->created_at,
            'updated_at' => $this->updated_at,
            'resource' => new ResourceResource($this->whenLoaded('resource')),
            'company' => new CompanyResource($this->whenLoaded('company')),
            'timetable' => new TimetableResource($this->whenLoaded('timetable')),
            'bookers' => BookerResource::collection($this->whenLoaded('bookers')),
        ];
    }
}



=== app/Http/Resources/SlotResource.php ===
<?php

namespace App\Http\Resources;

use Illuminate\Http\Request;
use Illuminate\Http\Resources\Json\JsonResource;

class SlotResource extends JsonResource
{
    public function toArray(Request $request): array
    {
        return [
            'start' => $this->resource['start'],
            'end' => $this->resource['end'],
            'duration_minutes' => $this->resource['duration_minutes'],
        ];
    }
}



=== app/Http/Resources/BookerResource.php ===
<?php

namespace App\Http\Resources;

use Illuminate\Http\Request;
use Illuminate\Http\Resources\Json\JsonResource;

class BookerResource extends JsonResource
{
    public function toArray(Request $request): array
    {
        return [
            'id' => $this->id,
            'external_id' => $this->external_id,
            'type' => $this->type,
            'name' => $this->name,
            'email' => $this->email,
            'phone' => $this->phone,
            'metadata' => $this->metadata,
            'created_at' => $this->created_at,
            'updated_at' => $this->updated_at,
        ];
    }
}



=== app/Http/Kernel.php ===
<?php

namespace App\Http;

use Illuminate\Foundation\Http\Kernel as HttpKernel;

class Kernel extends HttpKernel
{
    /**
     * The application's global HTTP middleware stack.
     *
     * These middleware are run during every request to your application.
     *
     * @var array<int, class-string|string>
     */
    protected $middleware = [
        // \App\Http\Middleware\TrustHosts::class,
        \App\Http\Middleware\TrustProxies::class,
        \Illuminate\Http\Middleware\HandleCors::class,
        \App\Http\Middleware\PreventRequestsDuringMaintenance::class,
        \Illuminate\Foundation\Http\Middleware\ValidatePostSize::class,
        \App\Http\Middleware\TrimStrings::class,
        \Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull::class,
    ];

    /**
     * The application's route middleware groups.
     *
     * @var array<string, array<int, class-string|string>>
     */
    protected $middlewareGroups = [
        'web' => [
            \App\Http\Middleware\EncryptCookies::class,
            \Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse::class,
            \Illuminate\Session\Middleware\StartSession::class,
            \Illuminate\View\Middleware\ShareErrorsFromSession::class,
            \App\Http\Middleware\VerifyCsrfToken::class,
            \Illuminate\Routing\Middleware\SubstituteBindings::class,
        ],

        'api' => [
            // \Laravel\Sanctum\Http\Middleware\EnsureFrontendRequestsAreStateful::class,
            \Illuminate\Routing\Middleware\ThrottleRequests::class.':api',
            \Illuminate\Routing\Middleware\SubstituteBindings::class,
        ],
    ];

    /**
     * The application's middleware aliases.
     *
     * Aliases may be used instead of class names to conveniently assign middleware to routes and groups.
     *
     * @var array<string, class-string|string>
     */
    protected $middlewareAliases = [
        'auth' => \App\Http\Middleware\Authenticate::class,
        'auth.basic' => \Illuminate\Auth\Middleware\AuthenticateWithBasicAuth::class,
        'auth.session' => \Illuminate\Session\Middleware\AuthenticateSession::class,
        'cache.headers' => \Illuminate\Http\Middleware\SetCacheHeaders::class,
        'can' => \Illuminate\Auth\Middleware\Authorize::class,
        'guest' => \App\Http\Middleware\RedirectIfAuthenticated::class,
        'password.confirm' => \Illuminate\Auth\Middleware\RequirePassword::class,
        'precognitive' => \Illuminate\Foundation\Http\Middleware\HandlePrecognitiveRequests::class,
        'signed' => \App\Http\Middleware\ValidateSignature::class,
        'throttle' => \Illuminate\Routing\Middleware\ThrottleRequests::class,
        'verified' => \Illuminate\Auth\Middleware\EnsureEmailIsVerified::class,
    ];
}



=== app/Http/Controllers/Api/TimetableImportController.php ===
<?php

namespace App\Http\Controllers\Api;

use App\Http\Controllers\Controller;
use App\Actions\CreateTimetableFromJsonAction;
use App\Http\Requests\ImportTimetableRequest;
use App\Http\Resources\TimetableResource;
use Illuminate\Http\JsonResponse;

class TimetableImportController extends Controller
{
    public function __construct(
        private CreateTimetableFromJsonAction $createTimetableFromJsonAction
    ) {}

    public function importFromJson(ImportTimetableRequest $request): JsonResponse
    {
        try {
            $timetable = $this->createTimetableFromJsonAction->execute(
                $request->company_id,
                $request->schedule_data,
                $request->type
            );

            return response()->json([
                'data' => new TimetableResource($timetable),
                'message' => 'Timetable imported successfully from JSON'
            ], 201);

        } catch (\Exception $e) {
            return response()->json([
                'error' => $e->getMessage()
            ], 422);
        }
    }

    public function importFromFile(ImportTimetableRequest $request): JsonResponse
    {
        try {
            $fileContent = file_get_contents($request->file('schedule_file')->getPathname());
            $scheduleData = json_decode($fileContent, true);

            if (json_last_error() !== JSON_ERROR_NONE) {
                throw new \Exception('Invalid JSON file: ' . json_last_error_msg());
            }

            $timetable = $this->createTimetableFromJsonAction->execute(
                $request->company_id,
                $scheduleData,
                $request->type
            );

            return response()->json([
                'data' => new TimetableResource($timetable),
                'message' => 'Timetable imported successfully from file'
            ], 201);

        } catch (\Exception $e) {
            return response()->json([
                'error' => $e->getMessage()
            ], 422);
        }
    }
}



=== app/Http/Controllers/Api/BookingController.php ===
<?php

namespace App\Http\Controllers\Api;

use App\Http\Controllers\Controller;
use App\Http\Requests\CheckAvailabilityRequest;
use App\Http\Requests\GetResourceBookingsRequest;
use App\Models\Booking;
use App\Models\Resource;
use App\Services\Booking\BookingService;
use App\Services\Booking\SlotGenerationService;
use App\Actions\CreateBookingAction;
use App\Actions\ConfirmBookingAction;
use App\Actions\CancelBookingAction;
use App\Actions\RescheduleBookingAction;
use App\Http\Requests\CreateBookingRequest;
use App\Http\Requests\RescheduleBookingRequest;
use App\Http\Requests\CancelBookingRequest;
use App\Http\Requests\GetSlotsRequest;
use App\Http\Resources\BookingResource;
use App\Http\Resources\ResourceResource;
use App\Http\Resources\SlotResource;
use Illuminate\Http\JsonResponse;
use Carbon\Carbon;

class BookingController extends Controller
{
    public function __construct(
        private BookingService $bookingService,
        private SlotGenerationService $slotService,
        private CreateBookingAction $createBookingAction,
        private ConfirmBookingAction $confirmBookingAction,
        private CancelBookingAction $cancelBookingAction,
        private RescheduleBookingAction $rescheduleBookingAction
    ) {}

    public function getResources(): JsonResponse
    {
        $resources = Resource::with(['company', 'resourceType', 'timetable'])->get();
        return response()->json(ResourceResource::collection($resources));
    }

    public function getAvailableSlots($resourceId, GetSlotsRequest $request): JsonResponse
    {
        $resource = Resource::findOrFail($resourceId);
        $date = $request->get('date', now()->toDateString());
        $count = $request->get('count', 10);
        $onlyToday = $request->get('only_today', true);

        $from = Carbon::parse($date);
        $slots = $this->bookingService->getNextAvailableSlots($resource, $from, $count, $onlyToday);

        return response()->json(SlotResource::collection($slots));
    }

    public function createBooking(CreateBookingRequest $request): JsonResponse
    {
        try {
            $resource = Resource::findOrFail($request->resource_id);

            $booking = $this->createBookingAction->execute(
                $resource,
                $request->start,
                $request->end,
                $request->booker ?? [],
                $request->is_admin ?? false
            );

            return response()->json([
                'data' => new BookingResource($booking),
                'message' => $booking->status === 'pending'
                    ? '–ë—Ä–æ–Ω—å —Å–æ–∑–¥–∞–Ω–∞ –∏ –æ–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è'
                    : '–ë—Ä–æ–Ω—å —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞'
            ], 201);

        } catch (\Exception $e) {
            return response()->json([
                'error' => $e->getMessage()
            ], 422);
        }
    }

    public function confirmBooking($id): JsonResponse
    {
        try {
            $booking = $this->confirmBookingAction->execute($id);

            return response()->json([
                'data' => new BookingResource($booking),
                'message' => '–ë—Ä–æ–Ω—å —É—Å–ø–µ—à–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞'
            ]);
        } catch (\Exception $e) {
            return response()->json([
                'error' => $e->getMessage()
            ], 422);
        }
    }

    public function cancelBooking($id, CancelBookingRequest $request): JsonResponse
    {
        try {
            $booking = $this->cancelBookingAction->execute(
                $id,
                $request->cancelled_by ?? 'client',
                $request->reason
            );

            return response()->json([
                'data' => new BookingResource($booking),
                'message' => '–ë—Ä–æ–Ω—å —É—Å–ø–µ—à–Ω–æ –æ—Ç–º–µ–Ω–µ–Ω–∞'
            ]);
        } catch (\Exception $e) {
            return response()->json([
                'error' => $e->getMessage()
            ], 422);
        }
    }

    public function rescheduleBooking($id, RescheduleBookingRequest $request): JsonResponse
    {
        try {
            $booking = $this->rescheduleBookingAction->execute(
                $id,
                $request->new_start,
                $request->new_end,
                $request->requested_by ?? 'client'
            );

            return response()->json([
                'data' => new BookingResource($booking),
                'message' => '–ë—Ä–æ–Ω—å —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞'
            ]);
        } catch (\Exception $e) {
            return response()->json([
                'error' => $e->getMessage()
            ], 422);
        }
    }

    public function getBookingsForResource($id, GetResourceBookingsRequest $request): JsonResponse
    {
        $resource = Resource::findOrFail($id);
        $bookings = $this->bookingService->getBookingsForResourceInRange(
            $resource,
            $request->from,
            $request->to
        );

        return response()->json(BookingResource::collection($bookings));
    }

    public function checkSlotAvailability(CheckAvailabilityRequest $request): JsonResponse
    {
        $resource = Resource::findOrFail($request->resource_id);

        if ($request->has('slots')) {
            $available = $this->bookingService->isSlotAvailable(
                $resource,
                $request->start,
                $request->slots
            );
        } else {
            $available = $this->bookingService->isRangeAvailable(
                $resource,
                Carbon::parse($request->start),
                Carbon::parse($request->end)
            );
        }

        return response()->json([
            'available' => $available,
            'message' => $available
                ? '–°–ª–æ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è'
                : '–°–ª–æ—Ç —É–∂–µ –∑–∞–Ω—è—Ç –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω'
        ]);
    }
}



=== app/Http/Controllers/TimetableController.php ===
<?php

namespace App\Http\Controllers;

use App\Actions\CreateOrUpdateCompanyAction;
use App\Actions\StoreTimetableAction;
use App\Actions\UpdateTimetableAction;
use App\Http\Requests\StoreTimetableRequest;
use App\Http\Requests\UpdateTimetableRequest;
use App\Http\Resources\TimetableResource;
use App\Models\Timetable;
use Illuminate\Http\JsonResponse;
use Illuminate\Http\Resources\Json\AnonymousResourceCollection;

class TimetableController extends Controller
{
    public function __construct(
        private CreateOrUpdateCompanyAction $createOrUpdateCompanyAction,
        private StoreTimetableAction $storeTimetableAction,
        private UpdateTimetableAction $updateTimetableAction
    ) {}

    public function index(): AnonymousResourceCollection
    {
        $timetables = Timetable::with(['company', 'resourceTypes', 'resources'])->get();
        return TimetableResource::collection($timetables);
    }

    public function store(StoreTimetableRequest $request): TimetableResource
    {
        $data = $request->validated();

        // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∫–æ–º–ø–∞–Ω–∏—é
        $this->createOrUpdateCompanyAction->execute($data['company_id']);

        $timetable = $this->storeTimetableAction->execute($data);

        return new TimetableResource($timetable->load(['company', 'resourceTypes', 'resources']));
    }

    public function show(Timetable $timetable): TimetableResource
    {
        return new TimetableResource($timetable->load(['company', 'resourceTypes', 'resources']));
    }

    public function update(UpdateTimetableRequest $request, Timetable $timetable): TimetableResource
    {
        $data = $request->validated();

        $timetable = $this->updateTimetableAction->execute($timetable, $data);

        return new TimetableResource($timetable->load(['company', 'resourceTypes', 'resources']));
    }

    public function destroy(Timetable $timetable): JsonResponse
    {
        $timetable->delete();
        return response()->json(['message' => 'Timetable deleted successfully']);
    }

    public function attachResource(Timetable $timetable, Request $request): JsonResponse
    {
        $request->validate([
            'resource_id' => 'required|exists:resources,id'
        ]);

        $resource = \App\Models\Resource::find($request->resource_id);
        $resource->update(['timetable_id' => $timetable->id]);

        return response()->json(['message' => 'Resource attached to timetable successfully']);
    }

    public function detachResource(Timetable $timetable, Request $request): JsonResponse
    {
        $request->validate([
            'resource_id' => 'required|exists:resources,id'
        ]);

        $resource = \App\Models\Resource::find($request->resource_id);
        if ($resource->timetable_id === $timetable->id) {
            $resource->update(['timetable_id' => null]);
        }

        return response()->json(['message' => 'Resource detached from timetable successfully']);
    }

    public function attachResourceType(Timetable $timetable, Request $request): JsonResponse
    {
        $request->validate([
            'resource_type_id' => 'required|exists:resource_types,id'
        ]);

        $resourceType = \App\Models\ResourceType::find($request->resource_type_id);
        $resourceType->update(['timetable_id' => $timetable->id]);

        return response()->json(['message' => 'Resource type attached to timetable successfully']);
    }

    public function detachResourceType(Timetable $timetable, Request $request): JsonResponse
    {
        $request->validate([
            'resource_type_id' => 'required|exists:resource_types,id'
        ]);

        $resourceType = \App\Models\ResourceType::find($request->resource_type_id);
        if ($resourceType->timetable_id === $timetable->id) {
            $resourceType->update(['timetable_id' => null]);
        }

        return response()->json(['message' => 'Resource type detached from timetable successfully']);
    }
}



=== app/Http/Controllers/CompanyController.php ===
<?php

namespace App\Http\Controllers;

use App\Http\Requests\StoreCompanyRequest;
use App\Http\Resources\CompanyResource;
use App\Models\Company;
use Illuminate\Http\JsonResponse;
use Illuminate\Http\Request;
use Illuminate\Http\Resources\Json\AnonymousResourceCollection;

class CompanyController extends Controller
{
    public function index(): AnonymousResourceCollection
    {
        $companies = Company::all();
        return CompanyResource::collection($companies);
    }

    public function store(StoreCompanyRequest $request): CompanyResource
    {
        $company = Company::create($request->validated());
        return new CompanyResource($company);
    }

    public function show(Company $company): CompanyResource
    {
        return new CompanyResource($company);
    }

    public function update(StoreCompanyRequest $request, Company $company): CompanyResource
    {
        $company->update($request->validated());
        return new CompanyResource($company);
    }

    public function destroy(Company $company): JsonResponse
    {
        $company->delete();
        return response()->json(['message' => 'Company deleted successfully']);
    }
}



=== app/Http/Controllers/ResourceTypeController.php ===
<?php

namespace App\Http\Controllers;

use App\Actions\CreateOrUpdateCompanyAction;
use App\Actions\StoreResourceTypeAction;
use App\Http\Requests\StoreResourceTypeRequest;
use App\Http\Resources\ResourceTypeResource;
use App\Models\ResourceType;
use Illuminate\Http\JsonResponse;
use Illuminate\Http\Resources\Json\AnonymousResourceCollection;

class ResourceTypeController extends Controller
{
    public function __construct(
        private CreateOrUpdateCompanyAction $createOrUpdateCompanyAction,
        private StoreResourceTypeAction $storeResourceTypeAction
    ) {}

    public function index(): AnonymousResourceCollection
    {
        $resourceTypes = ResourceType::with(['company', 'timetable', 'resources'])->get();
        return ResourceTypeResource::collection($resourceTypes);
    }

    public function store(StoreResourceTypeRequest $request): ResourceTypeResource
    {
        $data = $request->validated();

        // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∫–æ–º–ø–∞–Ω–∏—é –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω company_id
        if (isset($data['company_id'])) {
            $this->createOrUpdateCompanyAction->execute($data['company_id']);
        }

        $resourceType = $this->storeResourceTypeAction->execute($data);

        return new ResourceTypeResource($resourceType->load(['company', 'timetable', 'resources']));
    }

    public function show(ResourceType $resourceType): ResourceTypeResource
    {
        return new ResourceTypeResource($resourceType->load(['company', 'timetable', 'resources']));
    }

    public function update(StoreResourceTypeRequest $request, ResourceType $resourceType): ResourceTypeResource
    {
        $resourceType->update($request->validated());
        return new ResourceTypeResource($resourceType->load(['company', 'timetable', 'resources']));
    }

    public function destroy(ResourceType $resourceType): JsonResponse
    {
        $resourceType->delete();
        return response()->json(['message' => 'Resource type deleted successfully']);
    }
}



=== app/Http/Controllers/ResourceController.php ===
<?php

namespace App\Http\Controllers;

use App\Actions\CreateOrUpdateCompanyAction;
use App\Actions\StoreResourceAction;
use App\Http\Requests\StoreResourceRequest;
use App\Http\Resources\ResourceResource;
use App\Models\Resource;
use Illuminate\Http\JsonResponse;
use Illuminate\Http\Resources\Json\AnonymousResourceCollection;

class ResourceController extends Controller
{
    public function __construct(
        private CreateOrUpdateCompanyAction $createOrUpdateCompanyAction,
        private StoreResourceAction $storeResourceAction
    ) {}

    public function index(): AnonymousResourceCollection
    {
        $resources = Resource::with(['company', 'timetable', 'resourceType'])->get();
        return ResourceResource::collection($resources);
    }

    public function store(StoreResourceRequest $request): ResourceResource
    {
        $data = $request->validated();

        // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∫–æ–º–ø–∞–Ω–∏—é –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω company_id
        if (isset($data['company_id'])) {
            $this->createOrUpdateCompanyAction->execute($data['company_id']);
        }

        $resource = $this->storeResourceAction->execute($data);

        return new ResourceResource($resource->load(['company', 'timetable', 'resourceType']));
    }

    public function show(Resource $resource): ResourceResource
    {
        return new ResourceResource($resource->load(['company', 'timetable', 'resourceType']));
    }

    public function update(StoreResourceRequest $request, Resource $resource): ResourceResource
    {
        $resource->update($request->validated());
        return new ResourceResource($resource->load(['company', 'timetable', 'resourceType']));
    }

    public function destroy(Resource $resource): JsonResponse
    {
        $resource->delete();
        return response()->json(['message' => 'Resource deleted successfully']);
    }
}



=== app/Http/Controllers/Controller.php ===
<?php

namespace App\Http\Controllers;

use Illuminate\Foundation\Auth\Access\AuthorizesRequests;
use Illuminate\Foundation\Validation\ValidatesRequests;
use Illuminate\Routing\Controller as BaseController;

class Controller extends BaseController
{
    use AuthorizesRequests, ValidatesRequests;
}



=== app/Http/Requests/CreateBookingRequest.php ===
<?php
// app/Http/Requests/CreateBookingRequest.php

namespace App\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;

class CreateBookingRequest extends FormRequest
{
    public function authorize(): bool
    {
        return true;
    }

    public function rules(): array
    {
        return [
            'resource_id' => 'required|exists:resources,id',
            'start' => 'required|date',
            'end' => 'required|date|after:start',
            'booker' => 'sometimes|array',
            'booker.external_id' => 'sometimes|string',
            'booker.type' => 'required|in:client,admin,employee',
            'booker.name' => 'sometimes|string',
            'booker.email' => 'sometimes|email',
            'booker.phone' => 'sometimes|string',
            'booker.metadata' => 'sometimes|array',
            'is_admin' => 'sometimes|boolean' // –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —ç—Ç–æ –ø—Ä–∞–≤–∏–ª–æ –µ—Å—Ç—å
        ];
    }
}



=== app/Http/Requests/StoreResourceTypeRequest.php ===
<?php

namespace App\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;

class StoreResourceTypeRequest extends FormRequest
{
    public function authorize(): bool
    {
        return true;
    }

    public function rules(): array
    {
        return [
            'company_id' => 'sometimes|integer|min:1',
            'timetable_id' => 'nullable|integer|exists:timetables,id',
            'type' => 'required|string|max:63',
            'name' => 'required|string|max:127',
            'description' => 'nullable|string|max:255',
            'options' => 'nullable|array',
            'resource_config' => 'nullable|array',
        ];
    }
}



=== app/Http/Requests/GetResourceBookingsRequest.php ===
<?php

namespace App\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;

class GetResourceBookingsRequest extends FormRequest
{
    public function authorize(): bool
    {
        return true;
    }

    public function rules(): array
    {
        return [
            'from' => 'required|date',
            'to' => 'required|date|after:from'
        ];
    }
}



=== app/Http/Requests/UpdateTimetableRequest.php ===
<?php

namespace App\Http\Requests;

use App\Enums\TimetableType;
use Illuminate\Foundation\Http\FormRequest;
use Illuminate\Validation\Rule;

class UpdateTimetableRequest extends FormRequest
{
    public function authorize(): bool
    {
        return true;
    }

    public function rules(): array
    {
        return [
            'type' => ['sometimes', 'string', Rule::in(TimetableType::values())],
            'schedule' => 'sometimes|array',
            'schedule.days' => 'required_if:type,static|array',
            'schedule.days.*.working_hours' => 'required_if:type,static|array',
            'schedule.days.*.working_hours.start' => 'required_if:type,static|date_format:H:i',
            'schedule.days.*.working_hours.end' => 'required_if:type,static|date_format:H:i',
            'schedule.days.*.breaks' => 'sometimes|array',
            'schedule.days.*.breaks.*.start' => 'required_with:schedule.days.*.breaks|date_format:H:i',
            'schedule.days.*.breaks.*.end' => 'required_with:schedule.days.*.breaks|date_format:H:i',
            'schedule.holidays' => 'sometimes|array',
            'schedule.holidays.*' => 'string|regex:/^\d{2}-\d{2}$/',
            'schedule.dates' => 'required_if:type,dynamic|array',
            'schedule.dates.*.working_hours' => 'required_if:type,dynamic|array',
            'schedule.dates.*.working_hours.start' => 'required_if:type,dynamic|date_format:H:i',
            'schedule.dates.*.working_hours.end' => 'required_if:type,dynamic|date_format:H:i',
            'schedule.dates.*.breaks' => 'sometimes|array',
            'schedule.dates.*.breaks.*.start' => 'required_with:schedule.dates.*.breaks|date_format:H:i',
            'schedule.dates.*.breaks.*.end' => 'required_with:schedule.dates.*.breaks|date_format:H:i',
        ];
    }
}



=== app/Http/Requests/StoreCompanyRequest.php ===
<?php

namespace App\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;

class StoreCompanyRequest extends FormRequest
{
    public function authorize(): bool
    {
        return true;
    }

    public function rules(): array
    {
        return [
            'name' => 'nullable|string|max:255',
            'description' => 'nullable|string',
        ];
    }
}



=== app/Http/Requests/CheckAvailabilityRequest.php ===
<?php

namespace App\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;

class CheckAvailabilityRequest extends FormRequest
{
    public function authorize(): bool
    {
        return true;
    }

    public function rules(): array
    {
        return [
            'resource_id' => 'required|exists:resources,id',
            'start' => 'required|date',
            'end' => 'required|date|after:start',
            'slots' => 'sometimes|integer|min:1'
        ];
    }
}



=== app/Http/Requests/GetSlotsRequest.php ===
<?php

namespace App\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;

class GetSlotsRequest extends FormRequest
{
    public function authorize(): bool
    {
        return true;
    }

    public function rules(): array
    {
        return [
            'date' => 'sometimes|date',
            'count' => 'sometimes|integer|min:1|max:50',
            'only_today' => 'sometimes|boolean'
        ];
    }
}



=== app/Http/Requests/StoreResourceRequest.php ===
<?php

namespace App\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;

class StoreResourceRequest extends FormRequest
{
    public function authorize(): bool
    {
        return true;
    }

    public function rules(): array
    {
        return [
            'company_id' => 'sometimes|integer|min:1',
            'timetable_id' => 'nullable|integer|exists:timetables,id',
            'resource_type_id' => 'required|integer|exists:resource_types,id',
            'options' => 'nullable|array',
            'payload' => 'nullable|array',
            'resource_config' => 'nullable|array',
        ];
    }
}



=== app/Http/Requests/RescheduleBookingRequest.php ===
<?php

namespace App\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;

class RescheduleBookingRequest extends FormRequest
{
    public function authorize(): bool
    {
        return true;
    }

    public function rules(): array
    {
        return [
            'new_start' => 'required|date',
            'new_end' => 'required|date|after:new_start',
            'requested_by' => 'sometimes|in:client,admin'
        ];
    }
}



=== app/Http/Requests/StoreTimetableRequest.php ===
<?php

namespace App\Http\Requests;

use App\Enums\TimetableType;
use Illuminate\Foundation\Http\FormRequest;
use Illuminate\Validation\Rule;

class StoreTimetableRequest extends FormRequest
{
    public function authorize(): bool
    {
        return true;
    }

    public function rules(): array
    {
        return [
            'company_id' => 'required|integer|min:1',
            'type' => ['required', 'string', Rule::in(TimetableType::values())],
            'schedule' => 'required|array',
            'schedule.days' => 'required_if:type,static|array',
            'schedule.days.*.working_hours' => 'required_if:type,static|array',
            'schedule.days.*.working_hours.start' => 'required_if:type,static|date_format:H:i',
            'schedule.days.*.working_hours.end' => 'required_if:type,static|date_format:H:i',
            'schedule.days.*.breaks' => 'sometimes|array',
            'schedule.days.*.breaks.*.start' => 'required_with:schedule.days.*.breaks|date_format:H:i',
            'schedule.days.*.breaks.*.end' => 'required_with:schedule.days.*.breaks|date_format:H:i',
            'schedule.holidays' => 'sometimes|array',
            'schedule.holidays.*' => 'string|regex:/^\d{2}-\d{2}$/',
            'schedule.dates' => 'required_if:type,dynamic|array',
            'schedule.dates.*.working_hours' => 'required_if:type,dynamic|array',
            'schedule.dates.*.working_hours.start' => 'required_if:type,dynamic|date_format:H:i',
            'schedule.dates.*.working_hours.end' => 'required_if:type,dynamic|date_format:H:i',
            'schedule.dates.*.breaks' => 'sometimes|array',
            'schedule.dates.*.breaks.*.start' => 'required_with:schedule.dates.*.breaks|date_format:H:i',
            'schedule.dates.*.breaks.*.end' => 'required_with:schedule.dates.*.breaks|date_format:H:i',
        ];
    }

    public function messages(): array
    {
        return [
            'schedule.holidays.*.regex' => 'Holiday format must be MM-DD',
            'schedule.days.*.working_hours.start.date_format' => 'Start time must be in HH:MM format',
            'schedule.days.*.working_hours.end.date_format' => 'End time must be in HH:MM format',
            'schedule.dates.*.working_hours.start.date_format' => 'Start time must be in HH:MM format',
            'schedule.dates.*.working_hours.end.date_format' => 'End time must be in HH:MM format',
        ];
    }
}



=== app/Http/Requests/CancelBookingRequest.php ===
<?php

namespace App\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;

class CancelBookingRequest extends FormRequest
{
    public function authorize(): bool
    {
        return true;
    }

    public function rules(): array
    {
        return [
            'cancelled_by' => 'sometimes|in:client,admin',
            'reason' => 'sometimes|string|max:255'
        ];
    }
}



=== app/Http/Requests/ImportTimetableRequest.php ===
<?php

namespace App\Http\Requests;

use App\Enums\TimetableType;
use Illuminate\Foundation\Http\FormRequest;
use Illuminate\Validation\Rule;

class ImportTimetableRequest extends FormRequest
{
    public function authorize(): bool
    {
        return true;
    }

    public function rules(): array
    {
        return [
            'company_id' => 'required|integer|exists:companies,id',
            'type' => ['required', 'string', Rule::in(TimetableType::values())],
            'schedule_data' => 'required_without:schedule_file|array',
            'schedule_file' => 'required_without:schedule_data|file|mimes:json|max:10240',
        ];
    }

    public function messages(): array
    {
        return [
            'schedule_file.mimes' => 'The file must be a JSON file',
            'schedule_file.max' => 'The file size must not exceed 10MB',
        ];
    }
}



=== app/Http/Middleware/VerifyCsrfToken.php ===
<?php

namespace App\Http\Middleware;

use Illuminate\Foundation\Http\Middleware\VerifyCsrfToken as Middleware;

class VerifyCsrfToken extends Middleware
{
    /**
     * The URIs that should be excluded from CSRF verification.
     *
     * @var array<int, string>
     */
    protected $except = [
        //
    ];
}



=== app/Http/Middleware/TrimStrings.php ===
<?php

namespace App\Http\Middleware;

use Illuminate\Foundation\Http\Middleware\TrimStrings as Middleware;

class TrimStrings extends Middleware
{
    /**
     * The names of the attributes that should not be trimmed.
     *
     * @var array<int, string>
     */
    protected $except = [
        'current_password',
        'password',
        'password_confirmation',
    ];
}



=== app/Http/Middleware/EncryptCookies.php ===
<?php

namespace App\Http\Middleware;

use Illuminate\Cookie\Middleware\EncryptCookies as Middleware;

class EncryptCookies extends Middleware
{
    /**
     * The names of the cookies that should not be encrypted.
     *
     * @var array<int, string>
     */
    protected $except = [
        //
    ];
}



=== app/Http/Middleware/TrustProxies.php ===
<?php

namespace App\Http\Middleware;

use Illuminate\Http\Middleware\TrustProxies as Middleware;
use Illuminate\Http\Request;

class TrustProxies extends Middleware
{
    /**
     * The trusted proxies for this application.
     *
     * @var array<int, string>|string|null
     */
    protected $proxies;

    /**
     * The headers that should be used to detect proxies.
     *
     * @var int
     */
    protected $headers =
        Request::HEADER_X_FORWARDED_FOR |
        Request::HEADER_X_FORWARDED_HOST |
        Request::HEADER_X_FORWARDED_PORT |
        Request::HEADER_X_FORWARDED_PROTO |
        Request::HEADER_X_FORWARDED_AWS_ELB;
}



=== app/Http/Middleware/PreventRequestsDuringMaintenance.php ===
<?php

namespace App\Http\Middleware;

use Illuminate\Foundation\Http\Middleware\PreventRequestsDuringMaintenance as Middleware;

class PreventRequestsDuringMaintenance extends Middleware
{
    /**
     * The URIs that should be reachable while maintenance mode is enabled.
     *
     * @var array<int, string>
     */
    protected $except = [
        //
    ];
}



=== app/Http/Middleware/Authenticate.php ===
<?php

namespace App\Http\Middleware;

use Illuminate\Auth\Middleware\Authenticate as Middleware;
use Illuminate\Http\Request;

class Authenticate extends Middleware
{
    /**
     * Get the path the user should be redirected to when they are not authenticated.
     */
    protected function redirectTo(Request $request): ?string
    {
        return $request->expectsJson() ? null : route('login');
    }
}



=== app/Http/Middleware/ValidateSignature.php ===
<?php

namespace App\Http\Middleware;

use Illuminate\Routing\Middleware\ValidateSignature as Middleware;

class ValidateSignature extends Middleware
{
    /**
     * The names of the query string parameters that should be ignored.
     *
     * @var array<int, string>
     */
    protected $except = [
        // 'fbclid',
        // 'utm_campaign',
        // 'utm_content',
        // 'utm_medium',
        // 'utm_source',
        // 'utm_term',
    ];
}



=== app/Http/Middleware/RedirectIfAuthenticated.php ===
<?php

namespace App\Http\Middleware;

use App\Providers\RouteServiceProvider;
use Closure;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Symfony\Component\HttpFoundation\Response;

class RedirectIfAuthenticated
{
    /**
     * Handle an incoming request.
     *
     * @param  \Closure(\Illuminate\Http\Request): (\Symfony\Component\HttpFoundation\Response)  $next
     */
    public function handle(Request $request, Closure $next, string ...$guards): Response
    {
        $guards = empty($guards) ? [null] : $guards;

        foreach ($guards as $guard) {
            if (Auth::guard($guard)->check()) {
                return redirect(RouteServiceProvider::HOME);
            }
        }

        return $next($request);
    }
}



=== app/Http/Middleware/TrustHosts.php ===
<?php

namespace App\Http\Middleware;

use Illuminate\Http\Middleware\TrustHosts as Middleware;

class TrustHosts extends Middleware
{
    /**
     * Get the host patterns that should be trusted.
     *
     * @return array<int, string|null>
     */
    public function hosts(): array
    {
        return [
            $this->allSubdomainsOfApplicationUrl(),
        ];
    }
}



=== app/Console/Kernel.php ===
<?php

namespace App\Console;

use Illuminate\Console\Scheduling\Schedule;
use Illuminate\Foundation\Console\Kernel as ConsoleKernel;

class Kernel extends ConsoleKernel
{
    /**
     * Define the application's command schedule.
     */
    protected function schedule(Schedule $schedule): void
    {
        // $schedule->command('inspire')->hourly();
    }

    /**
     * Register the commands for the application.
     */
    protected function commands(): void
    {
        $this->load(__DIR__.'/Commands');

        require base_path('routes/console.php');
    }
}



=== app/Console/Commands/GeneratedynamicTimetable.php ===
<?php

namespace App\Console\Commands;

use App\Actions\CreateOrUpdateCompanyAction;
use App\Actions\CreateTimetableFromJsonAction;
use App\Models\Timetable;
use Illuminate\Console\Command;
use Illuminate\Support\Facades\Storage;
use Carbon\Carbon;
use App\Data\DynamicScheduleTemplates;

class GeneratedynamicTimetable extends Command
{
    protected $signature = 'timetable:generate-dynamic {company_id} {days=30}';
    protected $description = 'Generate dynamic timetable for specified period';

    public function handle(
        CreateOrUpdateCompanyAction $createOrUpdateCompanyAction,
        CreateTimetableFromJsonAction $createTimetableFromJsonAction
    ): void {
        $companyId = $this->argument('company_id');
        $daysCount = $this->argument('days');

        // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –ø–æ–ª—É—á–∞–µ–º –∫–æ–º–ø–∞–Ω–∏—é
        $company = $createOrUpdateCompanyAction->execute($companyId);

        $schedule = ['dates' => []];
        $startDate = now();

        for ($i = 0; $i < $daysCount; $i++) {
            $date = $startDate->copy()->addDays($i);

            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–Ω–∏ (30% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –¥–ª—è –≤—ã—Ö–æ–¥–Ω—ã—Ö)
            $dayOfWeek = $date->dayOfWeek;
            $isWeekend = ($dayOfWeek === 0 || $dayOfWeek === 6); // 0 - –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ, 6 - —Å—É–±–±–æ—Ç–∞

            if ($isWeekend && rand(1, 100) <= 70) {
                continue; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –≤—ã—Ö–æ–¥–Ω—ã—Ö
            }

            if (!$isWeekend && rand(1, 100) <= 15) {
                continue; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –±—É–¥–Ω–∏
            }

            $dateKey = $date->format('m-d');

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è
            $schedule['dates'][$dateKey] = $this->generateDailySchedule();
        }

        $timetable = $createTimetableFromJsonAction->execute($companyId, $schedule, 'dynamic');

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–∏–º–µ—Ä –≤ —Ñ–∞–π–ª
        Storage::put('exports/dynamic_timetable_example.json', json_encode($schedule, JSON_PRETTY_PRINT));

        $this->info("dynamic timetable created successfully for company {$companyId}");
        $this->info("Generated schedule for " . count($schedule['dates']) . " days (some days skipped)");
        $this->info("Example saved to storage/app/exports/dynamic_timetable_example.json");
    }

    /**
     * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ –¥–ª—è –æ–¥–Ω–æ–≥–æ –¥–Ω—è
     */
    private function generateDailySchedule(): array
    {
        $scheduleTypes = DynamicScheduleTemplates::getScheduleTypes();

        // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Ç–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞
        $scheduleType = array_rand($scheduleTypes);
        $workingHours = $scheduleTypes[$scheduleType];

        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–µ—Ä–µ—Ä—ã–≤—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –≥—Ä–∞—Ñ–∏–∫–∞
        $breaks = $this->generateBreaksForSchedule($scheduleType, $workingHours);

        return [
            'working_hours' => $workingHours,
            'breaks' => $breaks,
            'schedule_type' => $scheduleType, // –î–ª—è –æ—Ç–ª–∞–¥–∫–∏
        ];
    }

    /**
     * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–µ—Ä–µ—Ä—ã–≤—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –≥—Ä–∞—Ñ–∏–∫–∞
     */
    private function generateBreaksForSchedule(string $scheduleType, array $workingHours): array
    {
        $breakConfigs = DynamicScheduleTemplates::getBreakConfigurations();
        $config = $breakConfigs[$scheduleType] ?? ['break_count' => [1, 2], 'min_duration' => 30, 'max_duration' => 60];

        $breaks = [];
        $breakCount = rand($config['break_count'][0], $config['break_count'][1]);

        if ($scheduleType === '24h') {
            $breaks = $this->generate24hBreaks($breakCount);
        } elseif ($breakCount > 0) {
            $breaks = $this->generateBreaks($workingHours, $breakCount, $config['min_duration'], $config['max_duration']);
        }

        return $breaks;
    }

    /**
     * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–µ—Ä–µ—Ä—ã–≤—ã –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞
     */
    private function generateBreaks(array $workingHours, int $breakCount, int $minDuration, int $maxDuration): array
    {
        $breaks = [];
        $startHour = (int)explode(':', $workingHours['start'])[0];
        $endHour = (int)explode(':', $workingHours['end'])[0];

        // –î–ª—è 24-—á–∞—Å–æ–≤–æ–π —Å–º–µ–Ω—ã
        if ($endHour <= $startHour) {
            $endHour += 24;
        }

        $workDuration = $endHour - $startHour;
        $interval = $workDuration / ($breakCount + 1);

        for ($i = 1; $i <= $breakCount; $i++) {
            $breakStartHour = $startHour + ($interval * $i);
            $breakDuration = rand($minDuration, $maxDuration);

            // –°–ª—É—á–∞–π–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –ø–µ—Ä–µ—Ä—ã–≤–∞ (¬±30 –º–∏–Ω—É—Ç)
            $breakStartOffset = rand(-30, 30);
            $breakStartHour += $breakStartOffset / 60;

            $breakStart = $this->minutesToTime($breakStartHour * 60);
            $breakEnd = $this->minutesToTime(($breakStartHour * 60) + $breakDuration);

            $breaks[] = [
                'start' => $breakStart,
                'end' => $breakEnd,
                'duration_minutes' => $breakDuration,
            ];
        }

        return $breaks;
    }

    /**
     * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–µ—Ä–µ—Ä—ã–≤—ã –¥–ª—è 24-—á–∞—Å–æ–≤–æ–π —Å–º–µ–Ω—ã
     */
    private function generate24hBreaks(int $breakCount): array
    {
        $breaks = [];
        $totalBreakMinutes = 180; // 3 —á–∞—Å–∞ —Å—É–º–º–∞—Ä–Ω–æ
        $breakDuration = (int)($totalBreakMinutes / $breakCount);

        // –†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–µ—Ä–µ—Ä—ã–≤—ã –ø–æ 24-—á–∞—Å–æ–≤–æ–π —Å–º–µ–Ω–µ
        $shiftDuration = 24 * 60; // 24 —á–∞—Å–∞ –≤ –º–∏–Ω—É—Ç–∞—Ö
        $interval = (int)($shiftDuration / ($breakCount + 1));

        for ($i = 1; $i <= $breakCount; $i++) {
            $breakStartMinutes = $interval * $i;
            $breakEndMinutes = $breakStartMinutes + $breakDuration;

            $breakStart = $this->minutesToTime($breakStartMinutes);
            $breakEnd = $this->minutesToTime($breakEndMinutes);

            $breaks[] = [
                'start' => $breakStart,
                'end' => $breakEnd,
                'duration_minutes' => $breakDuration,
            ];
        }

        return $breaks;
    }

    /**
     * –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –º–∏–Ω—É—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏ HH:MM
     */
    private function minutesToTime(int $totalMinutes): string
    {
        $hours = floor($totalMinutes / 60) % 24;
        $minutes = $totalMinutes % 60;

        return sprintf('%02d:%02d', $hours, $minutes);
    }
}



=== app/Console/Commands/GenerateTestBookingData.php ===
<?php

namespace App\Console\Commands;

use Illuminate\Console\Command;
use App\Actions\GenerateTestDataAction;

class GenerateTestBookingData extends Command
{
    protected $signature = 'booking:generate-test-data {--company-id=}';
    protected $description = 'Generate test data for booking system using Artisan commands';

    public function handle(GenerateTestDataAction $generateTestDataAction): void
    {
        $companyId = $this->option('company-id') ?? 1;

        $this->info("üè¢ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏ {$companyId}...");
        $this->info("üìã –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–µ Artisan –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π");

        $result = $generateTestDataAction->execute($companyId);

        $this->info("üéâ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω—ã!");

        // –í—ã–≤–æ–¥–∏–º –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        $this->info("\nüìä –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:");
        $this->info("   - –ö–æ–º–ø–∞–Ω–∏—è: {$result['company']->name} (ID: {$result['company']->id})");

        $this->info("   - –†–∞—Å–ø–∏—Å–∞–Ω–∏—è:");
        $this->info("     ‚Ä¢ –°—Ç–∞—Ç–∏—á–µ—Å–∫–æ–µ: {$result['timetable_info']['static']['working_days']} —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π, {$result['timetable_info']['static']['total_breaks']} –ø–µ—Ä–µ—Ä—ã–≤–æ–≤");
        $this->info("     ‚Ä¢ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ: {$result['timetable_info']['dynamic']['working_days']} —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π, {$result['timetable_info']['dynamic']['total_breaks']} –ø–µ—Ä–µ—Ä—ã–≤–æ–≤");

        $this->info("   - –¢–∏–ø—ã —Ä–µ—Å—É—Ä—Å–æ–≤: " . count($result['resource_types']));
        foreach ($result['resource_types'] as $type => $resourceType) {
            $this->info("     ‚Ä¢ {$resourceType->name}: {$resourceType->description}");
        }

        $resourcesByType = [];
        foreach ($result['resources'] as $resource) {
            $typeName = $resource->resourceType->name;
            $resourcesByType[$typeName] = ($resourcesByType[$typeName] ?? 0) + 1;
        }

        $this->info("   - –†–µ—Å—É—Ä—Å—ã: " . count($result['resources']));
        foreach ($resourcesByType as $typeName => $count) {
            $this->info("     ‚Ä¢ {$typeName}: {$count} —à—Ç.");
        }

        $this->info("   - –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: " . count($result['bookings']));

        $bookingsByStatus = [];
        foreach ($result['bookings'] as $booking) {
            $bookingsByStatus[$booking->status] = ($bookingsByStatus[$booking->status] ?? 0) + 1;
        }

        foreach ($bookingsByStatus as $status => $count) {
            $this->info("     ‚Ä¢ {$status}: {$count} —à—Ç.");
        }

        $this->info("\nüöÄ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!");
        $this->info("üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: php artisan serve");
        $this->info("üìö API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ Postman –∫–æ–ª–ª–µ–∫—Ü–∏–∏: storage/app/exports/booking_system_postman_collection.json");
    }
}



=== app/Console/Commands/DemoScenarios/ScenarioRunnerService.php ===
<?php

namespace App\Console\Commands\DemoScenarios;

use App\Models\Resource;
use App\Models\Booking;
use App\Models\Company;
use App\Models\Timetable;
use App\Models\ResourceType;
use App\Actions\CreateOrUpdateCompanyAction;
use App\Actions\CreateTimetableFromJsonAction;
use App\Actions\StoreResourceTypeAction;
use App\Actions\StoreResourceAction;
use App\Services\Booking\BookingService;
use App\Http\Controllers\Api\BookingController;
use App\Http\Requests\GetSlotsRequest;
use App\Http\Requests\CreateBookingRequest;
use App\Http\Requests\CancelBookingRequest;
use App\Http\Requests\RescheduleBookingRequest;
use App\Data\ScenarioTimetableData;
use App\Data\ScenarioResourceConfigData;
use App\Data\ScenarioOptionsData;
use Carbon\Carbon;
use Illuminate\Http\Request;

class ScenarioRunnerService
{
    private BookingController $bookingController;
    private int $currentCompanyId;
    private int $currentResourceId;

    public function __construct(
        private CreateOrUpdateCompanyAction $createCompanyAction,
        private CreateTimetableFromJsonAction $createTimetableAction,
        private StoreResourceTypeAction $storeResourceTypeAction,
        private StoreResourceAction $storeResourceAction,
        private BookingService $bookingService
    ) {
        $this->bookingController = app(BookingController::class);
    }

    /**
     * –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ –¥–ª—è —Ä–µ—Å—É—Ä—Å–∞
     */
    public function getSlots(int $resourceId, string $date, int $count): array
    {
        try {
            $request = new GetSlotsRequest();
            $request->merge([
                'date' => $date,
                'count' => $count,
                'only_today' => true
            ]);

            $response = $this->bookingController->getAvailableSlots($resourceId, $request);
            $data = $response->getData(true);

            if (isset($data['data'])) {
                return array_map(function($slot) {
                    return $slot['start'] . '-' . $slot['end'];
                }, $data['data']);
            }

            return ["10:00-11:00", "11:00-12:00", "14:00-15:00"];
        } catch (\Exception $e) {
            return ["10:00-11:00", "11:00-12:00", "14:00-15:00"];
        }
    }

    /**
     * –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –±—Ä–æ–Ω–∏
     */
    public function createBooking(array $data): array
    {
        $request = new CreateBookingRequest();
        $request->merge($data);

        $response = $this->bookingController->createBooking($request);
        return $this->handleApiResponse($response, '–°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏');
    }

    /**
     * –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±—Ä–æ–Ω–∏
     */
    public function confirmBooking(int $bookingId): array
    {
        $response = $this->bookingController->confirmBooking($bookingId);
        return $this->handleApiResponse($response, '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±—Ä–æ–Ω–∏');
    }

    /**
     * –û—Ç–º–µ–Ω–∞ –±—Ä–æ–Ω–∏
     */
    public function cancelBooking(int $bookingId, string $cancelledBy, ?string $reason = null): array
    {
        try {
            $request = new CancelBookingRequest();
            $request->merge([
                'cancelled_by' => $cancelledBy,
                'reason' => $reason
            ]);

            $response = $this->bookingController->cancelBooking($bookingId, $request);
            return $this->handleApiResponse($response, '–û—Ç–º–µ–Ω–∞ –±—Ä–æ–Ω–∏');

        } catch (\Exception $e) {
            throw new \Exception('–û—à–∏–±–∫–∞ –æ—Ç–º–µ–Ω—ã –±—Ä–æ–Ω–∏: ' . $e->getMessage());
        }
    }

    /**
     * –ü–µ—Ä–µ–Ω–æ—Å –±—Ä–æ–Ω–∏
     */
    public function rescheduleBooking(int $bookingId, string $newStart, string $newEnd, string $requestedBy): array
    {
        $request = new RescheduleBookingRequest();
        $request->merge([
            'new_start' => $newStart,
            'new_end' => $newEnd,
            'requested_by' => $requestedBy
        ]);

        $response = $this->bookingController->rescheduleBooking($bookingId, $request);
        return $this->handleApiResponse($response, '–ü–µ—Ä–µ–Ω–æ—Å –±—Ä–æ–Ω–∏');
    }

    /**
     * –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
     */
    public function isRangeAvailable(int $resourceId, string $start, string $end): bool
    {
        $resource = Resource::find($resourceId);
        $startTime = Carbon::parse($start);
        $endTime = Carbon::parse($end);

        return $this->bookingService->isTimeRangeAvailable($resource, $startTime, $endTime);
    }

    /**
     * –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±—Ä–æ–Ω–∏ –ø–æ ID
     */
    public function getBooking(int $bookingId): array
    {
        try {
            $booking = Booking::with(['resource', 'bookers'])->findOrFail($bookingId);
            return [
                'id' => $booking->id,
                'resource_id' => $booking->resource_id,
                'start' => $booking->start,
                'end' => $booking->end,
                'status' => $booking->status,
                'reason' => $booking->reason,
                'resource' => $booking->resource,
                'bookers' => $booking->bookers
            ];
        } catch (\Exception $e) {
            throw new \Exception('–ë—Ä–æ–Ω—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: ' . $e->getMessage());
        }
    }

    /**
     * –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –±—Ä–æ–Ω–∏
     */
    public function checkStatus(array $booking, string $expectedStatus, string $message): void
    {
        // This method will be called from scenarios, so we need to handle output there
        // This is just a placeholder - actual implementation depends on how we want to handle output
    }

    /**
     * –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ API –æ—Ç–≤–µ—Ç–æ–≤
     */
    private function handleApiResponse($response, string $action): array
    {
        $responseData = $response->getData(true);

        if (!isset($responseData['data']) && !isset($responseData['error'])) {
            throw new \Exception("{$action}: –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API");
        }

        if (isset($responseData['error'])) {
            throw new \Exception("{$action}: {$responseData['error']}");
        }

        return $responseData['data'];
    }

    /**
     * –û—Ç–ª–∞–¥–æ—á–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
     */
    public function debug(string $message, array $context = []): void
    {
        if (app()->runningInConsole()) {
            echo "   üîç [DEBUG] {$message}: " . json_encode($context) . "\n";
        }
    }

    /**
     * –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—è
     */
    public function setupScenario(int $scenarioId): ?array
    {
        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º ID –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—è
        $companyId = $scenarioId * 100;
        $company = $this->createCompanyAction->execute(
            $companyId,
            "–î–µ–º–æ –∫–æ–º–ø–∞–Ω–∏—è –°—Ü–µ–Ω–∞—Ä–∏–π {$scenarioId}"
        );
        $this->currentCompanyId = $company->id;

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—è
        $timetableData = ScenarioTimetableData::getTimetableForScenario($scenarioId);
        $timetable = $this->createTimetableAction->execute(
            $company->id,
            $timetableData['schedule'],
            $timetableData['type']
        );

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–∏–ø–∞ —Ä–µ—Å—É—Ä—Å–∞
        $resourceTypeConfig = ScenarioResourceConfigData::getResourceConfigForScenario($scenarioId);
        $resourceTypeData = [
            'company_id' => $company->id,
            'timetable_id' => $timetable->id,
            'type' => "type_scenario_{$scenarioId}",
            'name' => "–¢–∏–ø —Ä–µ—Å—É—Ä—Å–∞ –°—Ü–µ–Ω–∞—Ä–∏–π {$scenarioId}",
            'description' => ScenarioOptionsData::getScenarioDescription($scenarioId),
            'resource_config' => $resourceTypeConfig
        ];

        $resourceType = $this->storeResourceTypeAction->execute($resourceTypeData);

        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞
        $resourceData = [
            'company_id' => $company->id,
            'timetable_id' => $timetable->id,
            'resource_type_id' => $resourceType->id,
            'options' => ScenarioOptionsData::getResourceOptionsForScenario($scenarioId),
            'resource_config' => $this->getResourceOverridesForScenario($scenarioId)
        ];

        $resource = $this->storeResourceAction->execute($resourceData);

        return [
            'company_id' => $company->id,
            'timetable_id' => $timetable->id,
            'resource_type_id' => $resourceType->id,
            'resource_id' => $resource->id
        ];
    }

    /**
     * –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ä–µ—Å—É—Ä—Å–∞
     */
    public function getResourceOverridesForScenario(int $scenarioId): array
    {
        return [];
    }

    /**
     * –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è
     */
    public function cleanupScenarioData(int $scenarioId): void
    {
        $companyId = $scenarioId * 100;
        Company::where('id', $companyId)->delete();
    }
}



=== app/Console/Commands/DemoScenarios/Scenarios/Scenario2_MeetingRoom.php ===
<?php
// app/Console/Commands/DemoScenarios/Scenarios/Scenario2_MeetingRoom.php

namespace App\Console\Commands\DemoScenarios\Scenarios;

class Scenario2_MeetingRoom extends BaseScenario
{
    protected int $scenarioId = 2;
    protected string $name = "üè¢ –ü–µ—Ä–µ–≥–æ–≤–æ—Ä–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞";
    protected string $description = "–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Å–ª–æ—Ç—ã + —Ä—É—á–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ";

    public function getDescription(): string
    {
        return "–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Å–ª–æ—Ç–æ–≤ —Å —Ä—É—á–Ω—ã–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º";
    }

    public function run(array $setupData): void
    {
        $resourceId = $setupData['resource_id'];

        $this->info("\nüè¢ –°–¶–ï–ù–ê–†–ò–ô 2: –ü–ï–†–ï–ì–û–í–û–†–ù–ê–Ø –ö–û–ú–ù–ê–¢–ê");
        $this->line("üéØ –¶–µ–ª—å: " . $this->getDescription());
        $this->line("üìã –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: —Ä—É—á–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Å–ª–æ—Ç—ã 30 –º–∏–Ω, —Ä–∞–∑–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞");

        // –®–ê–ì 1: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–µ—Ç –±—Ä–æ–Ω—å –≤–Ω–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
        $this->info("\nüë®‚Äçüíº –®–ê–ì 1: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–µ—Ç –±—Ä–æ–Ω—å –≤–Ω–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è...");
        $adminBooking = $this->runner->createBooking([
            'resource_id' => $resourceId,
            'start' => '2024-01-16 10:00:00',
            'end' => '2024-01-16 11:30:00',
            'is_admin' => true,
            'booker' => ['name' => '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', 'type' => 'admin']
        ]);
        $this->checkStatus($adminBooking, 'confirmed', "–ë—Ä–æ–Ω—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∞–≤—Ç–æ-–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞");

        // –®–ê–ì 2: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –±—Ä–æ–Ω—å (—Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)
        $this->info("\nüë§ –®–ê–ì 2: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –±—Ä–æ–Ω—å (—Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)...");
        $userBooking = $this->runner->createBooking([
            'resource_id' => $resourceId,
            'start' => '2024-01-16 13:00:00',
            'end' => '2024-01-16 14:00:00',
            'booker' => ['name' => '–ü–µ—Ç—Ä –°–∏–¥–æ—Ä–æ–≤', 'email' => 'peter@example.com']
        ]);
        $this->checkStatus($userBooking, 'pending', "–ë—Ä–æ–Ω—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è");

        // –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ª–æ—Ç—ã —Å —É—á–µ—Ç–æ–º pending –±—Ä–æ–Ω–∏
        $this->info("\nüìÖ –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª–æ—Ç–æ–≤ —Å —É—á–µ—Ç–æ–º –æ–∂–∏–¥–∞—é—â–µ–π –±—Ä–æ–Ω–∏...");
        $slots = $this->runner->getSlots($resourceId, '2024-01-16', 8);
        $this->info("   üìä –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã: " . count($slots));

        // –®–ê–ì 4: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±—Ä–æ–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
        $this->info("\n‚úÖ –®–ê–ì 4: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±—Ä–æ–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º...");
        $confirmedBooking = $this->runner->confirmBooking($userBooking['id']);
        $this->checkStatus($confirmedBooking, 'confirmed', "–ë—Ä–æ–Ω—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º");

        $this->info("\nüéâ –°–¶–ï–ù–ê–†–ò–ô 2 –ó–ê–í–ï–†–®–ï–ù: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Å–ª–æ—Ç—ã –∏ —Ä—É—á–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!");
    }

    private function checkStatus(array $booking, string $expectedStatus, string $message): void
    {
        if ($booking['status'] === $expectedStatus) {
            $this->info("   ‚úÖ {$message}: —Å—Ç–∞—Ç—É—Å = {$booking['status']}");
        } else {
            $this->error("   ‚ùå {$message}: –æ–∂–∏–¥–∞–ª—Å—è {$expectedStatus}, –ø–æ–ª—É—á–µ–Ω {$booking['status']}");
        }
    }
}



=== app/Console/Commands/DemoScenarios/Scenarios/Scenario3_GroupTraining.php ===
<?php
// app/Console/Commands/DemoScenarios/Scenarios/Scenario3_GroupTraining.php

namespace App\Console\Commands\DemoScenarios\Scenarios;

class Scenario3_GroupTraining extends BaseScenario
{
    protected int $scenarioId = 3;
    protected string $name = "üèãÔ∏è –ì—Ä—É–ø–ø–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞";
    protected string $description = "–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã + –≥—Ä—É–ø–ø–æ–≤—ã–µ –±—Ä–æ–Ω–∏";

    public function getDescription(): string
    {
        return "–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≥—Ä—É–ø–ø–æ–≤—ã—Ö –±—Ä–æ–Ω–µ–π —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤";
    }

    public function run(array $setupData): void
    {
        $resourceId = $setupData['resource_id'];

        $this->info("\nüèãÔ∏è –°–¶–ï–ù–ê–†–ò–ô 3: –ì–†–£–ü–ü–û–í–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê");
        $this->line("üéØ –¶–µ–ª—å: " . $this->getDescription());
        $this->line("üìã –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: –≥—Ä—É–ø–ø–æ–≤–æ–π —Ä–µ—Å—É—Ä—Å, —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã 90 –º–∏–Ω, –ª–∏–º–∏—Ç 10 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤");

        // –®–ê–ì 1: –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã –¥–ª—è –≥—Ä—É–ø–ø–æ–≤–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        $this->info("\nüìÖ –®–ê–ì 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ –¥–ª—è –≥—Ä—É–ø–ø–æ–≤–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏...");
        $slots = $this->runner->getSlots($resourceId, '2024-01-17', 5);
        $this->info("   üìä –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã: " . count($slots));

        // –®–ê–ì 2: –°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø–æ–≤—É—é –±—Ä–æ–Ω—å —Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–º
        $this->info("\nüë• –®–ê–ì 2: –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø–æ–≤–æ–π –±—Ä–æ–Ω–∏ —Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–º...");
        $groupBooking = $this->runner->createBooking([
            'resource_id' => $resourceId,
            'start' => '2024-01-17 10:00:00',
            'end' => '2024-01-17 11:30:00',
            'booker' => [
                'name' => '–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏',
                'email' => 'organizer@example.com',
                'type' => 'client',
                'metadata' => ['is_organizer' => true]
            ]
        ]);
        $this->checkStatus($groupBooking, 'confirmed', "–ì—Ä—É–ø–ø–æ–≤–∞—è –±—Ä–æ–Ω—å —Å–æ–∑–¥–∞–Ω–∞");

        // –®–ê–ì 3: –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∫ –±—Ä–æ–Ω–∏
        $this->info("\nüë• –®–ê–ì 3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ –≥—Ä—É–ø–ø–æ–≤—É—é –±—Ä–æ–Ω—å...");
        $this->addParticipantsToBooking($groupBooking['id'], [
            ['name' => '–£—á–∞—Å—Ç–Ω–∏–∫ 1', 'email' => 'user1@example.com'],
            ['name' => '–£—á–∞—Å—Ç–Ω–∏–∫ 2', 'email' => 'user2@example.com'],
            ['name' => '–£—á–∞—Å—Ç–Ω–∏–∫ 3', 'email' => 'user3@example.com'],
        ]);

        $this->info("\nüéâ –°–¶–ï–ù–ê–†–ò–ô 3 –ó–ê–í–ï–†–®–ï–ù: –ì—Ä—É–ø–ø–æ–≤—ã–µ –±—Ä–æ–Ω–∏ –∏ –ª–∏–º–∏—Ç—ã —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!");
    }

    private function checkStatus(array $booking, string $expectedStatus, string $message): void
    {
        if ($booking['status'] === $expectedStatus) {
            $this->info("   ‚úÖ {$message}: —Å—Ç–∞—Ç—É—Å = {$booking['status']}");
        } else {
            $this->error("   ‚ùå {$message}: –æ–∂–∏–¥–∞–ª—Å—è {$expectedStatus}, –ø–æ–ª—É—á–µ–Ω {$booking['status']}");
        }
    }

    private function addParticipantsToBooking(int $bookingId, array $participants): void
    {
        $this->line("   üë• –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ –±—Ä–æ–Ω—å {$bookingId}:");

        foreach ($participants as $participant) {
            $this->info("      üë§ –î–æ–±–∞–≤–ª–µ–Ω —É—á–∞—Å—Ç–Ω–∏–∫: {$participant['name']}");
        }
        $this->info("   ‚úÖ –£—á–∞—Å—Ç–Ω–∏–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –±—Ä–æ–Ω—å {$bookingId}");
    }
}



=== app/Console/Commands/DemoScenarios/Scenarios/Scenario7_BeautySalon.php ===
<?php
// app/Console/Commands/DemoScenarios/Scenarios/Scenario7_BeautySalon.php

namespace App\Console\Commands\DemoScenarios\Scenarios;

class Scenario7_BeautySalon extends BaseScenario
{
    protected int $scenarioId = 7;
    protected string $name = "üíÖ –°–∞–ª–æ–Ω –∫—Ä–∞—Å–æ—Ç—ã";
    protected string $description = "–°—Ç–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å –ø—Ä–∞–∑–¥–Ω–∏–∫–∞–º–∏";

    public function getDescription(): string
    {
        return "–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–º–∏ –¥–Ω—è–º–∏ –∏ –≤—ã—Ö–æ–¥–Ω—ã–º–∏";
    }

    public function run(array $setupData): void
    {
        $resourceId = $setupData['resource_id'];

        $this->info("\nüíÖ –°–¶–ï–ù–ê–†–ò–ô 7: –°–ê–õ–û–ù –ö–†–ê–°–û–¢–´");
        $this->line("üéØ –¶–µ–ª—å: " . $this->getDescription());
        $this->line("üìã –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: –°—Ç–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å –ø—Ä–∞–∑–¥–Ω–∏–∫–∞–º–∏, —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã");

        // –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–Ω–µ–π: —Ä–∞–±–æ—á–∏–µ, –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ, –≤—ã—Ö–æ–¥–Ω—ã–µ
        $testDates = [
            '2024-01-15' => ['type' => 'working', 'desc' => '–†–∞–±–æ—á–∏–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫'],
            '2024-01-01' => ['type' => 'holiday', 'desc' => '–ü—Ä–∞–∑–¥–Ω–∏–∫ (–ù–æ–≤—ã–π –≥–æ–¥)'],
            '2024-01-14' => ['type' => 'weekend', 'desc' => '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ (–≤—ã—Ö–æ–¥–Ω–æ–π)'],
            '2024-03-08' => ['type' => 'holiday', 'desc' => '–ü—Ä–∞–∑–¥–Ω–∏–∫ (8 –º–∞—Ä—Ç–∞)'],
            '2024-01-16' => ['type' => 'working', 'desc' => '–†–∞–±–æ—á–∏–π –≤—Ç–æ—Ä–Ω–∏–∫']
        ];

        foreach ($testDates as $date => $info) {
            $this->info("\nüìÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ {$info['desc']} ({$date})...");
            $slots = $this->runner->getSlots($resourceId, $date, 3);

            if ($info['type'] === 'working' && count($slots) > 0) {
                $this->info("   ‚úÖ {$info['desc']}: " . count($slots) . " —Å–ª–æ—Ç–æ–≤ –¥–æ—Å—Ç—É–ø–Ω–æ");
                $this->line("      üïí –ü–µ—Ä–≤—ã–µ —Å–ª–æ—Ç—ã: " . implode(', ', array_slice($slots, 0, 2)));
            } elseif ($info['type'] === 'working') {
                $this->error("   ‚ùå {$info['desc']}: –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ (–ù–ï–û–ñ–ò–î–ê–ù–ù–û)");
            } else {
                $this->info("   ‚úÖ {$info['desc']}: –ù–µ—Ç —Å–ª–æ—Ç–æ–≤ (–æ–∂–∏–¥–∞–µ–º–æ)");
            }
        }

        $this->info("\nüéâ –°–¶–ï–ù–ê–†–ò–ô 7 –ó–ê–í–ï–†–®–ï–ù: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤ –∏ –ø–µ—Ä–µ—Ä—ã–≤–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!");
    }
}



=== app/Console/Commands/DemoScenarios/Scenarios/Scenario5_HotelRoom.php ===
<?php
// app/Console/Commands/DemoScenarios/Scenarios/Scenario5_HotelRoom.php

namespace App\Console\Commands\DemoScenarios\Scenarios;

class Scenario5_HotelRoom extends BaseScenario
{
    protected int $scenarioId = 5;
    protected string $name = "üè® –ì–æ—Å—Ç–∏–Ω–∏—á–Ω—ã–π –Ω–æ–º–µ—Ä";
    protected string $description = "–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ –±—Ä–æ–Ω–∏ + —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏";

    public function getDescription(): string
    {
        return "–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –º–Ω–æ–≥–æ–¥–Ω–µ–≤–Ω—ã—Ö (–ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö) –±—Ä–æ–Ω–µ–π";
    }

    public function run(array $setupData): void
    {
        $resourceId = $setupData['resource_id'];

        $this->info("\nüè® –°–¶–ï–ù–ê–†–ò–ô 5: –ì–û–°–¢–ò–ù–ò–ß–ù–´–ô –ù–û–ú–ï–†");
        $this->line("üéØ –¶–µ–ª—å: " . $this->getDescription());
        $this->line("üìã –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ –±—Ä–æ–Ω–∏, –º–Ω–æ–≥–æ–¥–Ω–µ–≤–Ω—ã–µ, —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã 24 —á–∞—Å–∞");

        // –®–ê–ì 1: –ë—Ä–æ–Ω—å –Ω–∞ 3 –¥–Ω—è
        $this->info("\nüìÖ –®–ê–ì 1: –ë—Ä–æ–Ω—å –Ω–æ–º–µ—Ä–∞ –Ω–∞ 3 –¥–Ω—è...");
        $threeDayBooking = $this->runner->createBooking([
            'resource_id' => $resourceId,
            'start' => '2024-01-20 14:00:00',
            'end' => '2024-01-23 12:00:00',
            'booker' => ['name' => '–ì–æ—Å—Ç—å –æ—Ç–µ–ª—è', 'email' => 'guest@example.com']
        ]);
        $this->checkStatus($threeDayBooking, 'confirmed', "–ë—Ä–æ–Ω—å –Ω–∞ 3 –¥–Ω—è —Å–æ–∑–¥–∞–Ω–∞");

        // –®–ê–ì 2: –ü–æ–ø—ã—Ç–∫–∞ –±—Ä–æ–Ω–∏ –≤ –ø–µ—Ä–µ—Å–µ–∫–∞—é—â–∏–µ—Å—è –¥–∞—Ç—ã (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞)
        $this->info("\n‚ùå –®–ê–ì 2: –ü–æ–ø—ã—Ç–∫–∞ –±—Ä–æ–Ω–∏ –≤ –ø–µ—Ä–µ—Å–µ–∫–∞—é—â–∏–µ—Å—è –¥–∞—Ç—ã...");
        try {
            $this->runner->createBooking([
                'resource_id' => $resourceId,
                'start' => '2024-01-22 10:00:00',
                'end' => '2024-01-24 12:00:00',
                'booker' => ['name' => '–ö–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã–π –≥–æ—Å—Ç—å']
            ]);
            $this->error("   üö® –ù–ï–û–ñ–ò–î–ê–ù–ù–û: –î–æ–ª–∂–Ω–æ –±—ã–ª–æ –±—ã—Ç—å –æ—à–∏–±–∫–æ–π!");
        } catch (\Exception $e) {
            $this->info("   ‚úÖ –û–∂–∏–¥–∞–µ–º–∞—è –æ—à–∏–±–∫–∞: {$e->getMessage()}");
        }

        // –®–ê–ì 3: –ë—Ä–æ–Ω—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –Ω–æ–º–µ—Ä–∞
        $this->info("\n‚úÖ –®–ê–ì 3: –ë—Ä–æ–Ω—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –Ω–æ–º–µ—Ä–∞...");
        $nextBooking = $this->runner->createBooking([
            'resource_id' => $resourceId,
            'start' => '2024-01-23 14:00:00',
            'end' => '2024-01-25 12:00:00',
            'booker' => ['name' => '–°–ª–µ–¥—É—é—â–∏–π –≥–æ—Å—Ç—å']
        ]);
        $this->checkStatus($nextBooking, 'confirmed', "–ë—Ä–æ–Ω—å –ø–æ—Å–ª–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω–∞");

        $this->info("\nüéâ –°–¶–ï–ù–ê–†–ò–ô 5 –ó–ê–í–ï–†–®–ï–ù: –ú–Ω–æ–≥–æ–¥–Ω–µ–≤–Ω—ã–µ –±—Ä–æ–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!");
    }

    private function checkStatus(array $booking, string $expectedStatus, string $message): void
    {
        if ($booking['status'] === $expectedStatus) {
            $this->info("   ‚úÖ {$message}: —Å—Ç–∞—Ç—É—Å = {$booking['status']}");
        } else {
            $this->error("   ‚ùå {$message}: –æ–∂–∏–¥–∞–ª—Å—è {$expectedStatus}, –ø–æ–ª—É—á–µ–Ω {$booking['status']}");
        }
    }
}



=== app/Console/Commands/DemoScenarios/Scenarios/Scenario4_ExpensiveEquipment.php ===
<?php

namespace App\Console\Commands\DemoScenarios\Scenarios;

class Scenario4_ExpensiveEquipment extends BaseScenario
{
    protected int $scenarioId = 4;
    protected string $name = "üíé –î–æ—Ä–æ–≥–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ";
    protected string $description = "–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Å–ª–æ—Ç—ã + —Å—Ç—Ä–æ–≥–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è";

    public function getDescription(): string
    {
        return "–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Å—Ç—Ä–æ–≥–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –¥–ª—è —Ü–µ–Ω–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤";
    }

    public function run(array $setupData): void
    {
        $resourceId = $setupData['resource_id'];

        $this->info("\nüíé –°–¶–ï–ù–ê–†–ò–ô 4: –î–û–†–û–ì–û–ï –û–ë–û–†–£–î–û–í–ê–ù–ò–ï");
        $this->line("üéØ –¶–µ–ª—å: " . $this->getDescription());
        $this->line("üìã –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: —Å—Ç—Ä–æ–≥–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Å–ª–æ—Ç—ã 120 –º–∏–Ω, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ");

        // –®–ê–ì 1: –ü–æ–ø—ã—Ç–∫–∞ –±—Ä–æ–Ω–∏ –±–µ–∑ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞)
        $this->info("\n‚ùå –®–ê–ì 1: –ü–æ–ø—ã—Ç–∫–∞ –±—Ä–æ–Ω–∏ –±–µ–∑ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏...");
        try {
            $this->runner->createBooking([
                'resource_id' => $resourceId,
                'start' => now()->addMinutes(30)->format('Y-m-d H:i:s'),
                'end' => now()->addMinutes(150)->format('Y-m-d H:i:s'),
                'booker' => ['name' => '–¢–æ—Ä–æ–ø–ª–∏–≤—ã–π –∫–ª–∏–µ–Ω—Ç']
            ]);
            $this->error("   üö® –ù–ï–û–ñ–ò–î–ê–ù–ù–û: –î–æ–ª–∂–Ω–æ –±—ã–ª–æ –±—ã—Ç—å –æ—à–∏–±–∫–æ–π!");
            $this->runner->debug("–ë—Ä–æ–Ω—å —Å–æ–∑–¥–∞–ª–∞—Å—å –±–µ–∑ –æ—à–∏–±–∫–∏, —Ö–æ—Ç—è min_advance_time = 2880 –º–∏–Ω—É—Ç");
        } catch (\Exception $e) {
            $this->info("   ‚úÖ –û–∂–∏–¥–∞–µ–º–∞—è –æ—à–∏–±–∫–∞: " . $this->shortenErrorMessage($e->getMessage()));
        }

        // –®–ê–ì 2: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –±—Ä–æ–Ω—å —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        $this->info("\n‚è≥ –®–ê–ì 2: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –±—Ä–æ–Ω—å —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è...");
        $pendingBooking = $this->runner->createBooking([
            'resource_id' => $resourceId,
            'start' => '2024-01-18 10:00:00',
            'end' => '2024-01-18 12:00:00',
            'booker' => ['name' => '–°–µ—Ä—å–µ–∑–Ω—ã–π –∫–ª–∏–µ–Ω—Ç', 'email' => 'serious@example.com']
        ]);
        $this->checkStatus($pendingBooking, 'pending', "–ë—Ä–æ–Ω—å –æ–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è");

        // –®–ê–ì 3: –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –±—Ä–æ–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
        $this->info("\n‚ùå –®–ê–ì 3: –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –±—Ä–æ–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º...");
        $rejectedBooking = $this->runner->cancelBooking($pendingBooking['id'], 'admin', '–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –Ω–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏');
        $this->checkStatus($rejectedBooking, 'cancelled_by_admin', "–ë—Ä–æ–Ω—å –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º");

        // –®–ê–ì 4: –ë—Ä–æ–Ω—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º —Å –æ–±—Ö–æ–¥–æ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
        $this->info("\nüë®‚Äçüíº –®–ê–ì 4: –ë—Ä–æ–Ω—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º —Å –æ–±—Ö–æ–¥–æ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π...");

        $adminStart = '2024-01-18 10:00:00';
        $adminEnd = '2024-01-18 12:00:00';

        $adminBooking = $this->runner->createBooking([
            'resource_id' => $resourceId,
            'start' => $adminStart,
            'end' => $adminEnd,
            'is_admin' => true,
            'booker' => ['name' => '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', 'type' => 'admin']
        ]);
        $this->checkStatus($adminBooking, 'confirmed', "–ë—Ä–æ–Ω—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞");

        // –®–ê–ì 5: –ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–º–µ–Ω—ã –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–æ–º–µ–Ω—Ç (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞)
        $this->info("\n‚ùå –®–ê–ì 5: –ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–º–µ–Ω—ã –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–æ–º–µ–Ω—Ç...");
        try {
            $result = $this->runner->cancelBooking($adminBooking['id'], 'client', '–°—Ä–æ—á–Ω—ã–µ –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞');

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–º–µ–Ω—ã
            if (isset($result['status']) && $result['status'] === 'cancelled_by_client') {
                $this->error("   üö® –ù–ï–û–ñ–ò–î–ê–ù–ù–û: –û—Ç–º–µ–Ω–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ, —Ö–æ—Ç—è –¥–æ–ª–∂–Ω–∞ –±—ã–ª–∞ –±—ã—Ç—å –æ—à–∏–±–∫–æ–π!");
            } else {
                $this->error("   üö® –ù–ï–û–ñ–ò–î–ê–ù–ù–û: –û—Ç–º–µ–Ω–∞ –Ω–µ –≤—ã–∑–≤–∞–ª–∞ –æ—à–∏–±–∫—É!");
            }
        } catch (\Exception $e) {
            $this->info("   ‚úÖ –û–∂–∏–¥–∞–µ–º–∞—è –æ—à–∏–±–∫–∞: " . $this->shortenErrorMessage($e->getMessage()));
        }

        $this->info("\nüéâ –°–¶–ï–ù–ê–†–ò–ô 4 –ó–ê–í–ï–†–®–ï–ù: –°—Ç—Ä–æ–≥–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è —Ü–µ–Ω–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!");
    }

    private function checkStatus(array $booking, string $expectedStatus, string $message): void
    {
        if ($booking['status'] === $expectedStatus) {
            $this->info("   ‚úÖ {$message}: —Å—Ç–∞—Ç—É—Å = {$booking['status']}");
        } else {
            $this->error("   ‚ùå {$message}: –æ–∂–∏–¥–∞–ª—Å—è {$expectedStatus}, –ø–æ–ª—É—á–µ–Ω {$booking['status']}");
        }
    }

    /**
     * –°–æ–∫—Ä–∞—â–∞–µ—Ç –¥–ª–∏–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –¥–ª—è –ª—É—á—à–µ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
     */
    private function shortenErrorMessage(string $message): string
    {
        if (strlen($message) > 80) {
            return substr($message, 0, 77) . '...';
        }
        return $message;
    }
}



=== app/Console/Commands/DemoScenarios/Scenarios/Scenario1_HairSalon.php ===
<?php
// app/Console/Commands/DemoScenarios/Scenarios/Scenario1_HairSalon.php

namespace App\Console\Commands\DemoScenarios\Scenarios;

class Scenario1_HairSalon extends BaseScenario
{
    protected int $scenarioId = 1;
    protected string $name = "üíà –ü–∞—Ä–∏–∫–º–∞—Ö–µ—Ä—Å–∫–∞—è";
    protected string $description = "–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã + –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ";

    public function getDescription(): string
    {
        return "–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º";
    }

    public function run(array $setupData): void
    {
        $resourceId = $setupData['resource_id'];

        $this->info("\nüíà –°–¶–ï–ù–ê–†–ò–ô 1: –ü–ê–†–ò–ö–ú–ê–•–ï–†–°–ö–ê–Ø");
        $this->line("üéØ –¶–µ–ª—å: " . $this->getDescription());
        $this->line("üìã –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: –∞–≤—Ç–æ-–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã 60 –º–∏–Ω, –ø–µ—Ä–µ—Ä—ã–≤ 13:15-14:15");

        // –®–ê–ì 1: –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        $this->info("\nüìÖ –®–ê–ì 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤...");
        $slots = $this->runner->getSlots($resourceId, '2024-01-15', 8);
        $this->info("   üìä –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã: " . count($slots));
        $this->info("   üïí –ü—Ä–∏–º–µ—Ä—ã: " . implode(', ', array_slice($slots, 0, 3)));

        // –®–ê–ì 2: –°–æ–∑–¥–∞—Ç—å –±—Ä–æ–Ω—å –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–ª–æ—Ç –¥–æ –ø–µ—Ä–µ—Ä—ã–≤–∞
        $this->info("\n‚úÖ –®–ê–ì 2: –ë—Ä–æ–Ω—å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–ª–æ—Ç–∞ –¥–æ –ø–µ—Ä–µ—Ä—ã–≤–∞...");
        $booking1 = $this->runner->createBooking([
            'resource_id' => $resourceId,
            'start' => '2024-01-15 12:00:00',
            'end' => '2024-01-15 13:00:00',
            'booker' => ['name' => '–ê–Ω–Ω–∞ –ò–≤–∞–Ω–æ–≤–∞', 'email' => 'anna@example.com']
        ]);
        $this->checkStatus($booking1, 'confirmed', "–ë—Ä–æ–Ω—å –∞–≤—Ç–æ-–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞");

        // –®–ê–ì 3: –ü–æ–ø—ã—Ç–∫–∞ –±—Ä–æ–Ω–∏ —Å –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ–º –ø–µ—Ä–µ—Ä—ã–≤–∞ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞)
        $this->info("\n‚ùå –®–ê–ì 3: –ü–æ–ø—ã—Ç–∫–∞ –±—Ä–æ–Ω–∏ —Å –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ–º –ø–µ—Ä–µ—Ä—ã–≤–∞...");
        try {
            $this->runner->createBooking([
                'resource_id' => $resourceId,
                'start' => '2024-01-15 12:45:00',
                'end' => '2024-01-15 13:45:00',
                'booker' => ['name' => '–ö–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã–π –∫–ª–∏–µ–Ω—Ç']
            ]);
            $this->error("   üö® –ù–ï–û–ñ–ò–î–ê–ù–ù–û: –î–æ–ª–∂–Ω–æ –±—ã–ª–æ –±—ã—Ç—å –æ—à–∏–±–∫–æ–π!");
        } catch (\Exception $e) {
            $this->info("   ‚úÖ –û–∂–∏–¥–∞–µ–º–∞—è –æ—à–∏–±–∫–∞: {$e->getMessage()}");
        }

        // –®–ê–ì 4: –ë—Ä–æ–Ω—å –ø–µ—Ä–≤–æ–≥–æ —Å–ª–æ—Ç–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Ä—ã–≤–∞
        $this->info("\n‚úÖ –®–ê–ì 4: –ë—Ä–æ–Ω—å –ø–µ—Ä–≤–æ–≥–æ —Å–ª–æ—Ç–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Ä—ã–≤–∞...");
        $booking2 = $this->runner->createBooking([
            'resource_id' => $resourceId,
            'start' => '2024-01-15 14:15:00',
            'end' => '2024-01-15 15:15:00',
            'booker' => ['name' => '–ü–µ—Ç—Ä –°–∏–¥–æ—Ä–æ–≤']
        ]);
        $this->checkStatus($booking2, 'confirmed', "–ë—Ä–æ–Ω—å –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Ä—ã–≤–∞ —Å–æ–∑–¥–∞–Ω–∞");

        // –®–ê–ì 5: –û—Ç–º–µ–Ω–∞ –±—Ä–æ–Ω–∏ –∫–ª–∏–µ–Ω—Ç–æ–º
        $this->info("\nüîÑ –®–ê–ì 5: –û—Ç–º–µ–Ω–∞ –±—Ä–æ–Ω–∏ –∫–ª–∏–µ–Ω—Ç–æ–º...");
        $canceledBooking = $this->runner->cancelBooking($booking1['id'], 'client', '–ü–ª–∞–Ω—ã –∏–∑–º–µ–Ω–∏–ª–∏—Å—å');
        $this->checkStatus($canceledBooking, 'cancelled_by_client', "–ë—Ä–æ–Ω—å –æ—Ç–º–µ–Ω–µ–Ω–∞ –∫–ª–∏–µ–Ω—Ç–æ–º");

        $this->info("\nüéâ –°–¶–ï–ù–ê–†–ò–ô 1 –ó–ê–í–ï–†–®–ï–ù: –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!");
    }

    private function checkStatus(array $booking, string $expectedStatus, string $message): void
    {
        if ($booking['status'] === $expectedStatus) {
            $this->info("   ‚úÖ {$message}: —Å—Ç–∞—Ç—É—Å = {$booking['status']}");
        } else {
            $this->error("   ‚ùå {$message}: –æ–∂–∏–¥–∞–ª—Å—è {$expectedStatus}, –ø–æ–ª—É—á–µ–Ω {$booking['status']}");
        }
    }
}



=== app/Console/Commands/DemoScenarios/Scenarios/Scenario6_EmergencyCase.php ===
<?php
// app/Console/Commands/DemoScenarios/Scenarios/Scenario6_EmergencyCase.php

namespace App\Console\Commands\DemoScenarios\Scenarios;

class Scenario6_EmergencyCase extends BaseScenario
{
    protected int $scenarioId = 6;
    protected string $name = "‚ö° –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π —Å–ª—É—á–∞–π";
    protected string $description = "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä vs –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å";

    public function getDescription(): string
    {
        return "–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –Ω–∞–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º";
    }

    public function run(array $setupData): void
    {
        $resourceId = $setupData['resource_id'];

        $this->info("\n‚ö° –°–¶–ï–ù–ê–†–ò–ô 6: –≠–ö–°–¢–†–ï–ù–ù–´–ô –°–õ–£–ß–ê–ô");
        $this->line("üéØ –¶–µ–ª—å: " . $this->getDescription());
        $this->line("üìã –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞, —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ –æ—Ç–º–µ–Ω—ã, –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ");

        // –®–ê–ì 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –æ–±—ã—á–Ω—É—é –±—Ä–æ–Ω—å
        $this->info("\nüë§ –®–ê–ì 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –æ–±—ã—á–Ω—É—é –±—Ä–æ–Ω—å...");
        $userBooking = $this->runner->createBooking([
            'resource_id' => $resourceId,
            'start' => '2024-01-19 15:00:00',
            'end' => '2024-01-19 16:00:00',
            'is_admin' => false, // –Ø–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ —ç—Ç–æ –Ω–µ –∞–¥–º–∏–Ω
            'booker' => ['name' => '–û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', 'type' => 'client']
        ]);

        // –î–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—è 2 —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, –ø–æ—ç—Ç–æ–º—É —Å—Ç–∞—Ç—É—Å –±—É–¥–µ—Ç pending
        $expectedStatus = 'pending';
        $this->checkStatus($userBooking, $expectedStatus, "–ë—Ä–æ–Ω—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ–∑–¥–∞–Ω–∞");

        // –®–ê–ì 2: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –æ—Ç–º–µ–Ω—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é –±—Ä–æ–Ω—å
        $this->info("\nüë®‚Äçüíº –®–ê–ì 2: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –æ—Ç–º–µ–Ω—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é –±—Ä–æ–Ω—å...");
        $cancelledBooking = $this->runner->cancelBooking($userBooking['id'], 'admin', '–≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å');
        $this->checkStatus($cancelledBooking, 'cancelled_by_admin', "–ë—Ä–æ–Ω—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç–º–µ–Ω–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º");

        // –®–ê–ì 3: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–µ—Ç —ç–∫—Å—Ç—Ä–µ–Ω–Ω—É—é –±—Ä–æ–Ω—å –Ω–∞ —Ç–æ –∂–µ –≤—Ä–µ–º—è
        $this->info("\nüë®‚Äçüíº –®–ê–ì 3: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–µ—Ç —ç–∫—Å—Ç—Ä–µ–Ω–Ω—É—é –±—Ä–æ–Ω—å...");
        $emergencyBooking = $this->runner->createBooking([
            'resource_id' => $resourceId,
            'start' => '2024-01-19 15:00:00',
            'end' => '2024-01-19 16:00:00',
            'is_admin' => true, // –ö–ª—é—á–µ–≤–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
            'booker' => ['name' => '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', 'type' => 'admin']
        ]);
        $this->checkStatus($emergencyBooking, 'confirmed', "–≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –±—Ä–æ–Ω—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞");

        // –®–ê–ì 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –±—Ä–æ–Ω—å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–º–µ–Ω–µ–Ω–∞
        $this->info("\nüîç –®–ê–ì 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –±—Ä–æ–Ω–∏...");
        $updatedUserBooking = $this->runner->getBooking($userBooking['id']);
        $this->checkStatus($updatedUserBooking, 'cancelled_by_admin', "–ë—Ä–æ–Ω—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç–º–µ–Ω–µ–Ω–∞");

        $this->info("\nüéâ –°–¶–ï–ù–ê–†–ò–ô 6 –ó–ê–í–ï–†–®–ï–ù: –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!");
    }

    private function checkStatus(array $booking, string $expectedStatus, string $message): void
    {
        if ($booking['status'] === $expectedStatus) {
            $this->info("   ‚úÖ {$message}: —Å—Ç–∞—Ç—É—Å = {$booking['status']}");
        } else {
            $this->error("   ‚ùå {$message}: –æ–∂–∏–¥–∞–ª—Å—è {$expectedStatus}, –ø–æ–ª—É—á–µ–Ω {$booking['status']}");
        }
    }
}



=== app/Console/Commands/DemoScenarios/Scenarios/BaseScenario.php ===
<?php
// app/Console/Commands/DemoScenarios/Scenarios/BaseScenario.php

namespace App\Console\Commands\DemoScenarios\Scenarios;

use App\Services\Booking\BookingService;
use App\Console\Commands\DemoScenarios\ScenarioRunnerService;
use Illuminate\Console\Command;

abstract class BaseScenario
{
    protected Command $command;
    protected ScenarioRunnerService $runner;
    protected BookingService $bookingService;

    protected int $scenarioId;
    protected string $name;
    protected string $description;

    public function __construct(
        Command $command,
        ScenarioRunnerService $runner,
        BookingService $bookingService
    ) {
        $this->command = $command;
        $this->runner = $runner;
        $this->bookingService = $bookingService;
    }

    abstract public function run(array $setupData): void;

    abstract public function getDescription(): string;

    public function getName(): string
    {
        return $this->name;
    }

    public function getScenarioId(): int
    {
        return $this->scenarioId;
    }

    // –û–±—â–∏–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
    protected function info(string $message): void
    {
        $this->command->info($message);
    }

    protected function error(string $message): void
    {
        $this->command->error($message);
    }

    protected function line(string $message): void
    {
        $this->command->line($message);
    }

    protected function warn(string $message): void
    {
        $this->command->warn($message);
    }
}



=== app/Console/Commands/DemoScenarios/Scenarios/Scenario8_BusinessCenter.php ===
<?php
// app/Console/Commands/DemoScenarios/Scenarios/Scenario8_BusinessCenter.php

namespace App\Console\Commands\DemoScenarios\Scenarios;

class Scenario8_BusinessCenter extends BaseScenario
{
    protected int $scenarioId = 8;
    protected string $name = "üè¢ –ë–∏–∑–Ω–µ—Å-—Ü–µ–Ω—Ç—Ä";
    protected string $description = "–°–º–µ—à–∞–Ω–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ + –ø–µ—Ä–µ—Ä—ã–≤—ã";

    public function getDescription(): string
    {
        return "–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å–ª–æ–∂–Ω—ã–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –ø–µ—Ä–µ—Ä—ã–≤–∞–º–∏";
    }

    public function run(array $setupData): void
    {
        $resourceId = $setupData['resource_id'];

        $this->info("\nüè¢ –°–¶–ï–ù–ê–†–ò–ô 8: –ë–ò–ó–ù–ï–°-–¶–ï–ù–¢–†");
        $this->line("üéØ –¶–µ–ª—å: " . $this->getDescription());
        $this->line("üìã –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: –°–ª–æ–∂–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –ø–µ—Ä–µ—Ä—ã–≤–∞–º–∏, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Å–ª–æ—Ç—ã");

        // –®–ê–ì 1: –ü–æ–ª—É—á–∏—Ç—å —Å–ª–æ—Ç—ã –≤ –¥–µ–Ω—å —Å–æ —Å–ª–æ–∂–Ω—ã–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º
        $this->info("\nüìÖ –®–ê–ì 1: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ª–æ—Ç–æ–≤ –≤ –¥–µ–Ω—å —Å–æ —Å–ª–æ–∂–Ω—ã–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º...");
        $slots = $this->runner->getSlots($resourceId, '2024-01-22', 10);
        $this->info("   üìä –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã: " . count($slots));
        $this->info("   üïí –ü—Ä–∏–º–µ—Ä—ã —Å–ª–æ—Ç–æ–≤: " . implode(', ', array_slice($slots, 0, 5)));

        // –®–ê–ì 2: –°–æ–∑–¥–∞—Ç—å –±—Ä–æ–Ω—å –º–µ–∂–¥—É –ø–µ—Ä–µ—Ä—ã–≤–∞–º–∏
        $this->info("\n‚úÖ –®–ê–ì 2: –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏ –º–µ–∂–¥—É –ø–µ—Ä–µ—Ä—ã–≤–∞–º–∏...");
        $betweenBreaksBooking = $this->runner->createBooking([
            'resource_id' => $resourceId,
            'start' => '2024-01-22 13:30:00',
            'end' => '2024-01-22 15:00:00',
            'booker' => ['name' => '–ë–∏–∑–Ω–µ—Å-–≤—Å—Ç—Ä–µ—á–∞']
        ]);
        $this->checkStatus($betweenBreaksBooking, 'pending', "–ë—Ä–æ–Ω—å –º–µ–∂–¥—É –ø–µ—Ä–µ—Ä—ã–≤–∞–º–∏ —Å–æ–∑–¥–∞–Ω–∞");

        // –®–ê–ì 3: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±—Ä–æ–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
        $this->info("\n‚úÖ –®–ê–ì 3: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±—Ä–æ–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º...");
        $confirmedBooking = $this->runner->confirmBooking($betweenBreaksBooking['id']);
        $this->checkStatus($confirmedBooking, 'confirmed', "–ë—Ä–æ–Ω—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞");

        // –®–ê–ì 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤ –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π –¥–µ–Ω—å
        $this->info("\nüéÑ –®–ê–ì 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤ –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π –¥–µ–Ω—å...");
        $holidaySlots = $this->runner->getSlots($resourceId, '2024-01-01', 5);
        if (count($holidaySlots) === 0) {
            $this->info("   ‚úÖ –í –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π –¥–µ–Ω—å —Å–ª–æ—Ç–æ–≤ –Ω–µ—Ç (–æ–∂–∏–¥–∞–µ–º–æ)");
        } else {
            $this->error("   ‚ùå –í –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π –¥–µ–Ω—å –µ—Å—Ç—å —Å–ª–æ—Ç—ã (–ù–ï–û–ñ–ò–î–ê–ù–ù–û)");
        }

        $this->info("\nüéâ –°–¶–ï–ù–ê–†–ò–ô 8 –ó–ê–í–ï–†–®–ï–ù: –°–ª–æ–∂–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –ø–µ—Ä–µ—Ä—ã–≤–∞–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!");
    }

    private function checkStatus(array $booking, string $expectedStatus, string $message): void
    {
        if ($booking['status'] === $expectedStatus) {
            $this->info("   ‚úÖ {$message}: —Å—Ç–∞—Ç—É—Å = {$booking['status']}");
        } else {
            $this->error("   ‚ùå {$message}: –æ–∂–∏–¥–∞–ª—Å—è {$expectedStatus}, –ø–æ–ª—É—á–µ–Ω {$booking['status']}");
        }
    }
}



=== app/Console/Commands/DemoScenarios/DemoBookingScenarios.php ===
<?php
// app/Console/Commands/DemoScenarios/DemoBookingScenarios.php

namespace App\Console\Commands\DemoScenarios;

use Illuminate\Console\Command;
use App\Console\Commands\DemoScenarios\Scenarios;

class DemoBookingScenarios extends Command
{
    protected $signature = 'demo:booking-scenarios
                            {scenario? : –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –∑–∞–ø—É—Å–∫–∞ (1-8)}
                            {--all : –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏}
                            {--list : –ü–æ–∫–∞–∑–∞—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏}';

    protected $description = '–ó–∞–ø—É—Å–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Å–∏—Å—Ç–µ–º—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è';

    public function handle(ScenarioRunnerService $runner): int
    {
        if ($this->option('list')) {
            return $this->showScenarios();
        }

        $this->info('üöÄ –ó–∞–ø—É—Å–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è');
        $this->line('==================================================');

        $scenarios = $this->getScenariosToRun();

        foreach ($scenarios as $scenario) {
            $this->runScenario($scenario, $runner);
        }

        $this->info('üéâ –í—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã!');
        return 0;
    }

    /**
     * –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º
     */
    private function showScenarios(): int
    {
        $this->info('üìã –î–û–°–¢–£–ü–ù–´–ï –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–û–ù–ù–´–ï –°–¶–ï–ù–ê–†–ò–ò:');
        $this->line('');

        $scenarios = [
            1 => 'üíà –°–¶–ï–ù–ê–†–ò–ô 1: –ü–∞—Ä–∏–∫–º–∞—Ö–µ—Ä—Å–∫–∞—è - –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã + –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ',
            2 => 'üè¢ –°–¶–ï–ù–ê–†–ò–ô 2: –ü–µ—Ä–µ–≥–æ–≤–æ—Ä–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞ - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Å–ª–æ—Ç—ã + —Ä—É—á–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ',
            3 => 'üèãÔ∏è –°–¶–ï–ù–ê–†–ò–ô 3: –ì—Ä—É–ø–ø–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ - –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã + –≥—Ä—É–ø–ø–æ–≤—ã–µ –±—Ä–æ–Ω–∏',
            4 => 'üíé –°–¶–ï–ù–ê–†–ò–ô 4: –î–æ—Ä–æ–≥–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Å–ª–æ—Ç—ã + —Å—Ç—Ä–æ–≥–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è',
            5 => 'üè® –°–¶–ï–ù–ê–†–ò–ô 5: –ì–æ—Å—Ç–∏–Ω–∏—á–Ω—ã–π –Ω–æ–º–µ—Ä - –ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ –±—Ä–æ–Ω–∏ + —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏',
            6 => '‚ö° –°–¶–ï–ù–ê–†–ò–ô 6: –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π —Å–ª—É—á–∞–π - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä vs –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
            7 => 'üíÖ –°–¶–ï–ù–ê–†–ò–ô 7: –°–∞–ª–æ–Ω –∫—Ä–∞—Å–æ—Ç—ã - –°—Ç–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å –ø—Ä–∞–∑–¥–Ω–∏–∫–∞–º–∏',
            8 => 'üè¢ –°–¶–ï–ù–ê–†–ò–ô 8: –ë–∏–∑–Ω–µ—Å-—Ü–µ–Ω—Ç—Ä - –°–º–µ—à–∞–Ω–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ + –ø–µ—Ä–µ—Ä—ã–≤—ã'
        ];

        foreach ($scenarios as $id => $description) {
            $this->line("  {$id}. {$description}");
        }

        $this->line("\nüí° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:");
        $this->line("  php artisan demo:booking-scenarios --all      # –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏");
        $this->line("  php artisan demo:booking-scenarios 1          # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å—Ü–µ–Ω–∞—Ä–∏–π 1");
        $this->line("  php artisan demo:booking-scenarios --list     # –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç–æ—Ç —Å–ø–∏—Å–æ–∫");

        return 0;
    }

    /**
     * –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–∞–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å
     */
    private function getScenariosToRun(): array
    {
        if ($this->option('all')) {
            return range(1, 8);
        }

        $scenario = $this->argument('scenario');
        if ($scenario) {
            return [$scenario];
        }

        // –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≤—ã–±–æ—Ä –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        $choice = $this->choice(
            'üéØ –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –∑–∞–ø—É—Å–∫–∞:',
            [
                1 => '1. üíà –ü–∞—Ä–∏–∫–º–∞—Ö–µ—Ä—Å–∫–∞—è (–∞–≤—Ç–æ-–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã)',
                2 => '2. üè¢ –ü–µ—Ä–µ–≥–æ–≤–æ—Ä–Ω–∞—è (—Ä—É—á–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Å–ª–æ—Ç—ã)',
                3 => '3. üèãÔ∏è –ì—Ä—É–ø–ø–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ (–ª–∏–º–∏—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –≥—Ä—É–ø–ø–æ–≤—ã–µ –±—Ä–æ–Ω–∏)',
                4 => '4. üíé –î–æ—Ä–æ–≥–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ (—Å—Ç—Ä–æ–≥–∏–µ –ø—Ä–∞–≤–∏–ª–∞, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ)',
                5 => '5. üè® –ì–æ—Å—Ç–∏–Ω–∏—á–Ω—ã–π –Ω–æ–º–µ—Ä (–º–Ω–æ–≥–æ–¥–Ω–µ–≤–Ω—ã–µ –±—Ä–æ–Ω–∏)',
                6 => '6. ‚ö° –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π —Å–ª—É—á–∞–π (–∞–¥–º–∏–Ω vs –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)',
                7 => '7. üíÖ –°–∞–ª–æ–Ω –∫—Ä–∞—Å–æ—Ç—ã (–ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –¥–Ω–∏, –ø–µ—Ä–µ—Ä—ã–≤—ã)',
                8 => '8. üè¢ –ë–∏–∑–Ω–µ—Å-—Ü–µ–Ω—Ç—Ä (—Å–ª–æ–∂–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ—Ä—ã–≤—ã)',
                'all' => 'ALL. üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏'
            ],
            'all'
        );

        return $choice === 'all' ? range(1, 8) : [explode('.', $choice)[0]];
    }

    /**
     * –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è
     */
    private function runScenario(int $scenarioId, ScenarioRunnerService $runner): void
    {
        $this->info("\nüé¨ –ó–ê–ü–£–°–ö –°–¶–ï–ù–ê–†–ò–Ø {$scenarioId}");
        $this->line(str_repeat('‚îÄ', 60));

        // –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∑–∞–ø—É—Å–∫–∞
        $runner->cleanupScenarioData($scenarioId);

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è
        $setupData = $runner->setupScenario($scenarioId);

        if (!$setupData) {
            $this->error("‚ùå –û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è {$scenarioId}");
            return;
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è
        $scenario = $this->getScenarioInstance($scenarioId, $runner);

        if (!$scenario) {
            $this->error("‚ùå –°—Ü–µ–Ω–∞—Ä–∏–π {$scenarioId} –Ω–µ –Ω–∞–π–¥–µ–Ω");
            return;
        }

        // –ó–∞–ø—É—Å–∫ —Å—Ü–µ–Ω–∞—Ä–∏—è
        $scenario->run($setupData);

        $this->info("‚úÖ –°—Ü–µ–Ω–∞—Ä–∏–π {$scenarioId} –∑–∞–≤–µ—Ä—à–µ–Ω");
    }

    /**
     * –ü–æ–ª—É—á–∏—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä —Å—Ü–µ–Ω–∞—Ä–∏—è –ø–æ ID
     */
    private function getScenarioInstance(int $scenarioId, ScenarioRunnerService $runner)
    {
        $scenarios = [
            1 => new Scenarios\Scenario1_HairSalon($this, $runner, app(\App\Services\Booking\BookingService::class)),
            2 => new Scenarios\Scenario2_MeetingRoom($this, $runner, app(\App\Services\Booking\BookingService::class)),
            3 => new Scenarios\Scenario3_GroupTraining($this, $runner, app(\App\Services\Booking\BookingService::class)),
            4 => new Scenarios\Scenario4_ExpensiveEquipment($this, $runner, app(\App\Services\Booking\BookingService::class)),
            5 => new Scenarios\Scenario5_HotelRoom($this, $runner, app(\App\Services\Booking\BookingService::class)),
            6 => new Scenarios\Scenario6_EmergencyCase($this, $runner, app(\App\Services\Booking\BookingService::class)),
            7 => new Scenarios\Scenario7_BeautySalon($this, $runner, app(\App\Services\Booking\BookingService::class)),
            8 => new Scenarios\Scenario8_BusinessCenter($this, $runner, app(\App\Services\Booking\BookingService::class)),
        ];

        return $scenarios[$scenarioId] ?? null;
    }
}



=== app/Console/Commands/CheckResourceConfigs.php ===
<?php

namespace App\Console\Commands;

use Illuminate\Console\Command;
use App\Models\Resource;

class CheckResourceConfigs extends Command
{
    protected $signature = 'check:resource-configs {scenario?}';
    protected $description = '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤';

    public function handle(): void
    {
        $scenarioId = $this->argument('scenario');

        if ($scenarioId) {
            $this->checkScenarioConfig($scenarioId);
        } else {
            for ($i = 1; $i <= 8; $i++) {
                $this->checkScenarioConfig($i);
            }
        }
    }

    private function checkScenarioConfig(int $scenarioId): void
    {
        $companyId = $scenarioId * 100;

        $resources = Resource::where('company_id', $companyId)->get();

        $this->info("\nüîß –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—è {$scenarioId}:");

        if ($resources->count() === 0) {
            $this->warn("   ‚ùå –†–µ—Å—É—Ä—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏ ID: {$companyId}");
            return;
        }

        foreach ($resources as $resource) {
            $config = $resource->getResourceConfig();

            $this->line("   –†–µ—Å—É—Ä—Å ID: {$resource->id}");
            $this->line("   - min_advance_time: {$config->min_advance_time} –º–∏–Ω");
            $this->line("   - cancellation_time: " . ($config->cancellation_time ?? 'null') . " –º–∏–Ω");
            $this->line("   - reschedule_time: " . ($config->reschedule_time ?? 'null') . " –º–∏–Ω");
            $this->line("   - require_confirmation: " . ($config->requiresConfirmation() ? '–¥–∞' : '–Ω–µ—Ç'));
            $this->line("   - slot_duration_minutes: {$config->slot_duration_minutes} –º–∏–Ω");
            $this->line("   - slot_strategy: {$config->slot_strategy->value}");
            $this->line("   - max_participants: " . ($config->max_participants ?? 'null'));
            $this->line("");
        }
    }
}



=== app/Console/Commands/GenerateStaticTimetable.php ===
<?php

namespace App\Console\Commands;

use App\Actions\CreateOrUpdateCompanyAction;
use App\Models\Timetable;
use Illuminate\Console\Command;
use Illuminate\Support\Facades\Storage;
use App\Data\WorkingHoursTemplates;

class GenerateStaticTimetable extends Command
{
    protected $signature = 'timetable:generate-static {company_id}';
    protected $description = 'Generate static timetable with random parameters';

    public function handle(CreateOrUpdateCompanyAction $createOrUpdateCompanyAction): void
    {
        $companyId = $this->argument('company_id');

        // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –ø–æ–ª—É—á–∞–µ–º –∫–æ–º–ø–∞–Ω–∏—é
        $company = $createOrUpdateCompanyAction->execute($companyId);

        // –í—ã–±–∏—Ä–∞–µ–º –æ–¥–∏–Ω –∏–∑ –¥–≤—É—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π
        $workingDaysPattern = $this->selectWorkingDaysPattern();

        // –í—ã–±–∏—Ä–∞–µ–º –æ–¥–∏–Ω –∏–∑ —Ç—Ä–µ—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
        $workingHoursTemplate = $this->selectWorkingHoursTemplate();

        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–µ—Ä–µ—Ä—ã–≤—ã –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –≤—Å–µ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
        $breaksTemplate = $this->generateBreaksTemplate($workingHoursTemplate['regular']);

        $schedule = ['days' => []];

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤—Å–µ –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏
        $allDays = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];

        foreach ($allDays as $day) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –¥–µ–Ω—å —Ä–∞–±–æ—á–∏–º –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –ø–∞—Ç—Ç–µ—Ä–Ω–µ
            if (in_array($day, $workingDaysPattern)) {
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã –¥–ª—è –¥–Ω—è
                if (in_array($day, ['friday', 'saturday'])) {
                    // –ü—è—Ç–Ω–∏—Ü–∞ –∏ —Å—É–±–±–æ—Ç–∞ - –Ω–∞ —á–∞—Å —Ä–∞–Ω—å—à–µ
                    $workingHours = $workingHoursTemplate['early'];
                } else {
                    // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏ - –æ–±—ã—á–Ω–æ–µ –≤—Ä–µ–º—è
                    $workingHours = $workingHoursTemplate['regular'];
                }

                $schedule['days'][$day] = [
                    'working_hours' => $workingHours,
                    'breaks' => $breaksTemplate,
                ];
            }
            // –ù–µ—Ä–∞–±–æ—á–∏–µ –¥–Ω–∏ –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
        }

        // –†–æ—Å—Å–∏–π—Å–∫–∏–µ –ø—Ä–∞–∑–¥–Ω–∏–∫–∏
        $schedule['holidays'] = WorkingHoursTemplates::getRussianHolidays();

        $timetable = Timetable::create([
            'company_id' => $companyId,
            'type' => 'static',
            'schedule' => $schedule,
        ]);

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–∏–º–µ—Ä –≤ —Ñ–∞–π–ª
        Storage::put('exports/static_timetable_example.json', json_encode($schedule, JSON_PRETTY_PRINT));

        $this->info("Static timetable created successfully for company {$companyId}");
        $this->info("Working days pattern: " . implode(', ', $workingDaysPattern));
        $this->info("Working hours: {$workingHoursTemplate['regular']['start']} - {$workingHoursTemplate['regular']['end']}");
        $this->info("Breaks count: " . count($breaksTemplate));
        $this->info("Example saved to storage/app/exports/static_timetable_example.json");
    }

    /**
     * –í—ã–±–∏—Ä–∞–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π
     */
    private function selectWorkingDaysPattern(): array
    {
        $patterns = WorkingHoursTemplates::getWorkingDaysPatterns();
        return $patterns[array_rand($patterns)];
    }

    /**
     * –í—ã–±–∏—Ä–∞–µ—Ç —à–∞–±–ª–æ–Ω —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤
     */
    private function selectWorkingHoursTemplate(): array
    {
        $templates = WorkingHoursTemplates::getWorkingHoursTemplates();
        return $templates[array_rand($templates)];
    }

    /**
     * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —à–∞–±–ª–æ–Ω –ø–µ—Ä–µ—Ä—ã–≤–æ–≤ –¥–ª—è –≤—Å–µ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
     */
    private function generateBreaksTemplate(array $workingHours): array
    {
        $breaks = [];

        // –ü–∞—Ä—Å–∏–º –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è
        $startHour = (int)explode(':', $workingHours['start'])[0];
        $endHour = (int)explode(':', $workingHours['end'])[0];

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ—Ä—ã–≤–æ–≤
        $breakCount = $this->getBreakCount();

        if ($breakCount === 0) {
            return $breaks;
        }

        if ($breakCount === 1) {
            // –û–¥–∏–Ω –ø–µ—Ä–µ—Ä—ã–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é 60 –º–∏–Ω—É—Ç
            $breakStart = $startHour + 3; // –ù–µ –º–µ–Ω–µ–µ 3 —á–∞—Å–æ–≤ –ø–æ—Å–ª–µ –Ω–∞—á–∞–ª–∞
            $maxBreakStart = $endHour - 4; // –ù–µ –º–µ–Ω–µ–µ 3 —á–∞—Å–æ–≤ –¥–æ –∫–æ–Ω—Ü–∞ (60 –º–∏–Ω –ø–µ—Ä–µ—Ä—ã–≤ + 3 —á–∞—Å–∞ —Ä–∞–±–æ—Ç—ã)

            if ($breakStart <= $maxBreakStart) {
                $breakStart = rand($breakStart, $maxBreakStart);
                $breaks[] = [
                    'start' => sprintf('%02d:00', $breakStart),
                    'end' => sprintf('%02d:00', $breakStart + 1),
                ];
            }
        } else {
            // –î–≤–∞ –ø–µ—Ä–µ—Ä—ã–≤–∞ –ø–æ 30 –º–∏–Ω—É—Ç –∫–∞–∂–¥—ã–π
            $minGapBetweenBreaks = 3; // 3 —á–∞—Å–∞ –º–µ–∂–¥—É –ø–µ—Ä–µ—Ä—ã–≤–∞–º–∏
            $minEdgeGap = 2.5; // 2.5 —á–∞—Å–∞ –æ—Ç –∫—Ä–∞–µ–≤

            $firstBreakStart = $startHour + $minEdgeGap;
            $secondBreakEnd = $endHour - $minEdgeGap;

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –¥–≤—É—Ö –ø–µ—Ä–µ—Ä—ã–≤–æ–≤
            $availableTime = $secondBreakEnd - $firstBreakStart - 1; // 1 —á–∞—Å –Ω–∞ –æ–±–∞ –ø–µ—Ä–µ—Ä—ã–≤–∞
            if ($availableTime >= $minGapBetweenBreaks) {
                $firstBreakStart = rand(
                    (int)$firstBreakStart,
                    (int)($secondBreakEnd - $minGapBetweenBreaks - 1)
                );

                $secondBreakStart = $firstBreakStart + 0.5 + $minGapBetweenBreaks; // 30 –º–∏–Ω –ø–µ—Ä–≤—ã–π –ø–µ—Ä–µ—Ä—ã–≤ + 3 —á–∞—Å–∞
                $secondBreakStart = min($secondBreakStart, $endHour - $minEdgeGap - 0.5);

                if ($secondBreakStart <= $endHour - $minEdgeGap - 0.5) {
                    $breaks[] = [
                        'start' => sprintf('%02d:00', $firstBreakStart),
                        'end' => sprintf('%02d:30', $firstBreakStart),
                    ];
                    $breaks[] = [
                        'start' => sprintf('%02d:00', $secondBreakStart),
                        'end' => sprintf('%02d:30', $secondBreakStart),
                    ];
                }
            }
        }

        return $breaks;
    }

    /**
     * –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ—Ä—ã–≤–æ–≤ —Å –∑–∞–¥–∞–Ω–Ω—ã–º–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—è–º–∏
     */
    private function getBreakCount(): int
    {
        $random = rand(1, 100);

        if ($random <= 40) {
            return 1;
        } else {
            return 2;
        }
    }
}



=== app/Actions/UpdateTimetableAction.php ===
<?php

namespace App\Actions;

use App\Models\Timetable;
use Illuminate\Support\Facades\Storage;

class UpdateTimetableAction
{
    public function execute(Timetable $timetable, array $data): Timetable
    {
        if (isset($data['schedule'])) {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ñ–∞–π–ª —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
            $filename = 'timetable_' . $timetable->id . '_' . time() . '.json';
            Storage::put('imports/' . $filename, json_encode($data['schedule']));
        }

        $timetable->update($data);

        return $timetable;
    }
}



=== app/Actions/StoreTimetableAction.php ===
<?php

namespace App\Actions;

use App\Models\Timetable;
use Illuminate\Support\Facades\Storage;

class StoreTimetableAction
{
    public function execute(array $data): Timetable
    {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
        $filename = 'timetable_' . time() . '.json';
        Storage::put('imports/' . $filename, json_encode($data['schedule']));

        $timetable = Timetable::create($data);

        return $timetable;
    }
}



=== app/Actions/ConfirmBookingAction.php ===
<?php

namespace App\Actions;

use App\Models\Booking;
use App\Enums\BookingStatus;

class ConfirmBookingAction
{
    public function execute(int $bookingId): Booking
    {
        $booking = Booking::findOrFail($bookingId);

        if ($booking->status !== BookingStatus::PENDING->value) {
            throw new \Exception('–ú–æ–∂–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—Ä–æ–Ω–∏ –≤ —Å—Ç–∞—Ç—É—Å–µ –æ–∂–∏–¥–∞–Ω–∏—è');
        }

        $booking->status = BookingStatus::CONFIRMED->value;
        $booking->save();

        return $booking;
    }
}



=== app/Actions/CancelBookingAction.php ===
<?php

namespace App\Actions;

use App\Models\Booking;
use App\Enums\BookingStatus;
use App\ValueObjects\ResourceConfig;

class CancelBookingAction
{
    public function execute(int $bookingId, string $cancelledBy = 'client', ?string $reason = null): Booking
    {
        $booking = Booking::findOrFail($bookingId);
        $config = $booking->resource->getResourceConfig();

        if ($cancelledBy === 'client' && !$config->canCancel($booking->start)) {
            throw new \Exception('–í—Ä–µ–º—è –¥–ª—è –æ—Ç–º–µ–Ω—ã –±—Ä–æ–Ω–∏ –∏—Å—Ç–µ–∫–ª–æ');
        }

        $status = $cancelledBy === 'admin'
            ? BookingStatus::CANCELLED_BY_ADMIN
            : BookingStatus::CANCELLED_BY_CLIENT;

        $booking->update([
            'status' => $status->value,
            'reason' => $reason
        ]);

        return $booking;
    }
}



=== app/Actions/StoreResourceTypeAction.php ===
<?php

namespace App\Actions;

use App\Models\ResourceType;

class StoreResourceTypeAction
{
    public function execute(array $data): ResourceType
    {
        // –ï—Å–ª–∏ company_id –Ω–µ —É–∫–∞–∑–∞–Ω, —Å–æ–∑–¥–∞–µ–º –∫–æ–º–ø–∞–Ω–∏—é
        if (!isset($data['company_id']) && isset($data['timetable_id'])) {
            // –ü–æ–ª—É—á–∞–µ–º company_id –∏–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
            $timetable = \App\Models\Timetable::find($data['timetable_id']);
            if ($timetable) {
                $data['company_id'] = $timetable->company_id;
            }
        }

        return ResourceType::create($data);
    }
}



=== app/Actions/RescheduleBookingAction.php ===
<?php

namespace App\Actions;

use App\Models\Booking;
use App\Enums\BookingStatus;
use App\ValueObjects\ResourceConfig;
use Illuminate\Support\Facades\DB;
use Carbon\Carbon;

class RescheduleBookingAction
{
    public function execute(
        int $bookingId,
        string $newStart,
        string $newEnd,
        string $requestedBy = 'client'
    ): Booking {
        return DB::transaction(function () use ($bookingId, $newStart, $newEnd, $requestedBy) {
            $booking = Booking::findOrFail($bookingId);
            $resource = $booking->resource;
            $config = $resource->getResourceConfig();

            if (BookingStatus::from($booking->status)->isCancelled()) {
                throw new \Exception('–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –æ—Ç–º–µ–Ω–µ–Ω–Ω—É—é –±—Ä–æ–Ω—å');
            }

            if ($requestedBy === 'client' && !$config->canReschedule($booking->start)) {
                throw new \Exception('–í—Ä–µ–º—è –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –±—Ä–æ–Ω–∏ –∏—Å—Ç–µ–∫–ª–æ');
            }

            $newStartTime = Carbon::parse($newStart);
            $newEndTime = Carbon::parse($newEnd);

            $booking->update([
                'start' => $newStartTime,
                'end' => $newEndTime
            ]);

            return $booking;
        });
    }
}



=== app/Actions/GenerateTestDataAction.php ===
<?php

namespace App\Actions;

use App\Models\Company;
use App\Models\Timetable;
use App\Models\ResourceType;
use App\Models\Resource;
use App\Models\Booking;
use App\Services\ArtisanCommandService;
use Carbon\Carbon;

class GenerateTestDataAction
{
    public function __construct(
        private CreateOrUpdateCompanyAction $createOrUpdateCompanyAction,
        private CreateTimetableFromJsonAction $createTimetableFromJsonAction,
        private ArtisanCommandService $artisanCommandService
    ) {}

    public function execute(int $companyId = 1): array
    {
        $company = $this->createOrUpdateCompanyAction->execute($companyId, 'Test Company ' . $companyId);

        // –°–æ–∑–¥–∞–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—è Artisan –∫–æ–º–∞–Ω–¥—ã
        $staticTimetable = $this->createStaticTimetable($companyId);
        $dynamicTimetable = $this->createDynamicTimetable($companyId);

        // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
        $staticTimetableInfo = $this->artisanCommandService->getTimetableInfo($staticTimetable->schedule, 'static');
        $dynamicTimetableInfo = $this->artisanCommandService->getTimetableInfo($dynamicTimetable->schedule, 'dynamic');

        // –°–æ–∑–¥–∞–µ–º —Ç–∏–ø—ã —Ä–µ—Å—É—Ä—Å–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π
        $resourceTypes = $this->createResourceTypes($companyId, $staticTimetable, $dynamicTimetable, $staticTimetableInfo, $dynamicTimetableInfo);

        // –°–æ–∑–¥–∞–µ–º —Ä–µ—Å—É—Ä—Å—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∏–ø–æ–≤
        $resources = $this->createResources($companyId, $resourceTypes, $staticTimetable, $dynamicTimetable);

        // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
        $bookings = $this->createTestBookings($resources, $staticTimetable, $dynamicTimetable);

        return [
            'company' => $company,
            'timetables' => [
                'static' => $staticTimetable,
                'dynamic' => $dynamicTimetable
            ],
            'timetable_info' => [
                'static' => $staticTimetableInfo,
                'dynamic' => $dynamicTimetableInfo
            ],
            'resource_types' => $resourceTypes,
            'resources' => $resources,
            'bookings' => $bookings,
        ];
    }

    private function createStaticTimetable(int $companyId): Timetable
    {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º Artisan –∫–æ–º–∞–Ω–¥—É –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
        $staticData = $this->artisanCommandService->generateStaticTimetable($companyId);

        return $this->createTimetableFromJsonAction->execute($companyId, $staticData, 'static');
    }

    private function createDynamicTimetable(int $companyId): Timetable
    {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º Artisan –∫–æ–º–∞–Ω–¥—É –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
        $dynamicData = $this->artisanCommandService->generateDynamicTimetable($companyId, 14); // 14 –¥–Ω–µ–π –¥–ª—è —Ç–µ—Å—Ç–æ–≤

        return $this->createTimetableFromJsonAction->execute($companyId, $dynamicData, 'dynamic');
    }

    private function createResourceTypes(
        int $companyId,
        Timetable $staticTimetable,
        Timetable $dynamicTimetable,
        array $staticInfo,
        array $dynamicInfo
    ): array {
        // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ç–∏–ø–æ–≤ —Ä–µ—Å—É—Ä—Å–æ–≤

        // –î–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (—Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏)
        $employeeType = ResourceType::create([
            'company_id' => $companyId,
            'timetable_id' => $staticTimetable->id,
            'type' => 'employee',
            'name' => '–°–æ—Ç—Ä—É–¥–Ω–∏–∫',
            'description' => "–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ ({$staticInfo['working_days']} —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π –≤ –Ω–µ–¥–µ–ª—é)",
            'resource_config' => [
                'slot_duration_minutes' => 60,
                'slot_strategy' => 'fixed',
                'require_confirmation' => false,
                'min_advance_time' => 60,
                'cancellation_time' => 120,
                'reschedule_time' => 240,
            ]
        ]);

        // –î–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (–ø–µ—Ä–µ–≥–æ–≤–æ—Ä–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã)
        $roomType = ResourceType::create([
            'company_id' => $companyId,
            'timetable_id' => $staticTimetable->id,
            'type' => 'meeting_room',
            'name' => '–ü–µ—Ä–µ–≥–æ–≤–æ—Ä–Ω–∞—è',
            'description' => "–ö–æ–º–Ω–∞—Ç–∞ –¥–ª—è –≤—Å—Ç—Ä–µ—á ({$staticInfo['total_breaks']} –ø–µ—Ä–µ—Ä—ã–≤–æ–≤ –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏)",
            'resource_config' => [
                'slot_duration_minutes' => 30,
                'slot_strategy' => 'dynamic',
                'require_confirmation' => true,
                'max_participants' => 10,
                'min_advance_time' => 30,
            ]
        ]);

        // –î–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (—Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è)
        $trainingType = ResourceType::create([
            'company_id' => $companyId,
            'timetable_id' => $dynamicTimetable->id,
            'type' => 'training',
            'name' => '–ì—Ä—É–ø–ø–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞',
            'description' => "–ì—Ä—É–ø–ø–æ–≤—ã–µ –∑–∞–Ω—è—Ç–∏—è ({$dynamicInfo['working_days']} –¥–Ω–µ–π –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏)",
            'resource_config' => [
                'slot_duration_minutes' => 90,
                'slot_strategy' => 'fixed',
                'require_confirmation' => false,
                'max_participants' => 20,
                'min_advance_time' => 1440,
            ]
        ]);

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ç–∏–ø –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ)
        $equipmentType = ResourceType::create([
            'company_id' => $companyId,
            'timetable_id' => $dynamicTimetable->id,
            'type' => 'equipment',
            'name' => '–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ',
            'description' => '–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π',
            'resource_config' => [
                'slot_duration_minutes' => 120,
                'slot_strategy' => 'dynamic',
                'require_confirmation' => true,
                'max_participants' => 5,
                'min_advance_time' => 480,
            ]
        ]);

        return [
            'employee' => $employeeType,
            'meeting_room' => $roomType,
            'training' => $trainingType,
            'equipment' => $equipmentType,
        ];
    }

    private function createResources(
        int $companyId,
        array $resourceTypes,
        Timetable $staticTimetable,
        Timetable $dynamicTimetable
    ): array {
        $resources = [];

        // –†–µ—Å—É—Ä—Å—ã –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏)
        $resources[] = Resource::create([
            'company_id' => $companyId,
            'resource_type_id' => $resourceTypes['employee']->id,
            'timetable_id' => $staticTimetable->id,
            'options' => ['specialization' => '–ü–∞—Ä–∏–∫–º–∞—Ö–µ—Ä', 'experience' => '5 –ª–µ—Ç'],
            'resource_config' => ['slot_duration_minutes' => 45]
        ]);

        $resources[] = Resource::create([
            'company_id' => $companyId,
            'resource_type_id' => $resourceTypes['employee']->id,
            'timetable_id' => $staticTimetable->id,
            'options' => ['specialization' => '–ú–∞—Å—Å–∞–∂–∏—Å—Ç', 'experience' => '3 –≥–æ–¥–∞'],
        ]);

        $resources[] = Resource::create([
            'company_id' => $companyId,
            'resource_type_id' => $resourceTypes['employee']->id,
            'timetable_id' => $staticTimetable->id,
            'options' => ['specialization' => '–ö–æ—Å–º–µ—Ç–æ–ª–æ–≥', 'experience' => '4 –≥–æ–¥–∞'],
        ]);

        // –†–µ—Å—É—Ä—Å—ã –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (–ø–µ—Ä–µ–≥–æ–≤–æ—Ä–Ω—ã–µ)
        $resources[] = Resource::create([
            'company_id' => $companyId,
            'resource_type_id' => $resourceTypes['meeting_room']->id,
            'timetable_id' => $staticTimetable->id,
            'options' => ['location' => '–≠—Ç–∞–∂ 3', 'capacity' => 8, 'equipment' => ['projector', 'whiteboard']],
            'resource_config' => ['max_participants' => 8]
        ]);

        $resources[] = Resource::create([
            'company_id' => $companyId,
            'resource_type_id' => $resourceTypes['meeting_room']->id,
            'timetable_id' => $staticTimetable->id,
            'options' => ['location' => '–≠—Ç–∞–∂ 2', 'capacity' => 15, 'equipment' => ['tv', 'conference_phone']],
        ]);

        // –†–µ—Å—É—Ä—Å—ã –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏)
        $resources[] = Resource::create([
            'company_id' => $companyId,
            'resource_type_id' => $resourceTypes['training']->id,
            'timetable_id' => $dynamicTimetable->id,
            'options' => ['location' => '–ó–∞–ª –ê', 'trainer' => '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤', 'type' => '–ô–æ–≥–∞'],
        ]);

        $resources[] = Resource::create([
            'company_id' => $companyId,
            'resource_type_id' => $resourceTypes['training']->id,
            'timetable_id' => $dynamicTimetable->id,
            'options' => ['location' => '–ó–∞–ª –ë', 'trainer' => '–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞', 'type' => '–ü–∏–ª–∞—Ç–µ—Å'],
        ]);

        // –†–µ—Å—É—Ä—Å—ã –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ)
        $resources[] = Resource::create([
            'company_id' => $companyId,
            'resource_type_id' => $resourceTypes['equipment']->id,
            'timetable_id' => $dynamicTimetable->id,
            'options' => ['name' => '3D –ø—Ä–∏–Ω—Ç–µ—Ä', 'model' => 'Ultimaker S5', 'specifications' => ['print_volume' => '330√ó240√ó300 mm']],
        ]);

        return $resources;
    }

    private function createTestBookings(array $resources, Timetable $staticTimetable, Timetable $dynamicTimetable): array
    {
        $bookings = [];
        $now = now();

        // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
        $staticSchedule = $staticTimetable->schedule;
        $dynamicSchedule = $dynamicTimetable->schedule;

        foreach ($resources as $resource) {
            $isStatic = $resource->timetable_id === $staticTimetable->id;
            $schedule = $isStatic ? $staticSchedule : $dynamicSchedule;

            // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—à–µ–¥—à–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (2-3 –Ω–∞ —Ä–µ—Å—É—Ä—Å)
            $pastBookingsCount = rand(2, 3);
            for ($i = 0; $i < $pastBookingsCount; $i++) {
                $daysAgo = rand(1, 7);
                $hour = rand(9, 16);

                $bookings[] = Booking::create([
                    'company_id' => 1,
                    'resource_id' => $resource->id,
                    'timetable_id' => $resource->timetable_id,
                    'start' => $now->copy()->subDays($daysAgo)->setHour($hour)->setMinute(0),
                    'end' => $now->copy()->subDays($daysAgo)->setHour($hour + 1)->setMinute(0),
                    'status' => 'confirmed',
                    'is_group_booking' => $resource->resourceType->type === 'training',
                ]);
            }

            // –°–æ–∑–¥–∞–µ–º –±—É–¥—É—â–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (1-2 –Ω–∞ —Ä–µ—Å—É—Ä—Å)
            $futureBookingsCount = rand(1, 2);
            for ($i = 0; $i < $futureBookingsCount; $i++) {
                $daysAhead = rand(1, 14);
                $hour = rand(9, 16);

                $bookings[] = Booking::create([
                    'company_id' => 1,
                    'resource_id' => $resource->id,
                    'timetable_id' => $resource->timetable_id,
                    'start' => $now->copy()->addDays($daysAhead)->setHour($hour)->setMinute(0),
                    'end' => $now->copy()->addDays($daysAhead)->setHour($hour + 1)->setMinute(0),
                    'status' => rand(0, 1) ? 'confirmed' : 'pending',
                    'is_group_booking' => $resource->resourceType->type === 'training',
                ]);
            }
        }

        return $bookings;
    }
}



=== app/Actions/StoreResourceAction.php ===
<?php

namespace App\Actions;

use App\Models\Resource;

class StoreResourceAction
{
    public function execute(array $data): Resource
    {
        // –ï—Å–ª–∏ company_id –Ω–µ —É–∫–∞–∑–∞–Ω, –±–µ—Ä–µ–º –∏–∑ —Ç–∏–ø–∞ —Ä–µ—Å—É—Ä—Å–∞
        if (!isset($data['company_id'])) {
            $resourceType = \App\Models\ResourceType::find($data['resource_type_id']);
            if ($resourceType) {
                $data['company_id'] = $resourceType->company_id;
            }
        }

        return Resource::create($data);
    }
}



=== app/Actions/AttachBookerAction.php ===
<?php

namespace App\Actions;

use App\Models\Booking;
use App\Models\Booker;

class AttachBookerAction
{
    public function execute(Booking $booking, array $bookerData): void
    {
        $booker = Booker::firstOrCreate(
            [
                'external_id' => $bookerData['external_id'] ?? null,
                'type' => $bookerData['type'] ?? 'client'
            ],
            [
                'name' => $bookerData['name'] ?? null,
                'email' => $bookerData['email'] ?? null,
                'phone' => $bookerData['phone'] ?? null,
                'metadata' => $bookerData['metadata'] ?? null,
            ]
        );

        // –ü—Ä–∏–∫—Ä–µ–ø–ª—è–µ–º booker –∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—é —á–µ—Ä–µ–∑ —Å–≤—è–∑—å –º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º
        $booking->bookers()->syncWithoutDetaching([$booker->id]);
    }
}



=== app/Actions/CreateTimetableFromJsonAction.php ===
<?php

namespace App\Actions;

use App\Models\Timetable;
use App\Models\Company;
use App\Enums\TimetableType;
use Illuminate\Support\Facades\Validator;
use Illuminate\Validation\ValidationException;

class CreateTimetableFromJsonAction
{
    public function execute(int $companyId, array $jsonData, string $type = 'static'): Timetable
    {
        // –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ—Ç null –∑–Ω–∞—á–µ–Ω–∏–π
        $cleanedData = $this->cleanScheduleData($jsonData, $type);

        // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
        $this->validateJsonData($cleanedData, $type);

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
        $company = Company::find($companyId);
        if (!$company) {
            throw new \Exception("Company with ID {$companyId} not found");
        }

        // –°–æ–∑–¥–∞–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
        return Timetable::create([
            'company_id' => $companyId,
            'type' => $type,
            'schedule' => $cleanedData,
        ]);
    }

    private function cleanScheduleData(array $data, string $type): array
    {
        if ($type === TimetableType::STATIC->value) {
            // –£–¥–∞–ª—è–µ–º –¥–Ω–∏ —Å null –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
            if (isset($data['days']) && is_array($data['days'])) {
                $data['days'] = array_filter($data['days'], function ($day) {
                    return $day !== null;
                });
            }
        } else {
            // –£–¥–∞–ª—è–µ–º –¥–∞—Ç—ã —Å null –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
            if (isset($data['dates']) && is_array($data['dates'])) {
                $data['dates'] = array_filter($data['dates'], function ($date) {
                    return $date !== null;
                });
            }
        }

        return $data;
    }

    private function validateJsonData(array $data, string $type): void
    {
        $rules = [];

        if ($type === TimetableType::STATIC->value) {
            $rules = [
                'days' => 'required|array',
                'days.*.working_hours' => 'required|array',
                'days.*.working_hours.start' => 'required|date_format:H:i',
                'days.*.working_hours.end' => 'required|date_format:H:i',
                'days.*.breaks' => 'sometimes|array',
                'days.*.breaks.*.start' => 'required_with:days.*.breaks|date_format:H:i',
                'days.*.breaks.*.end' => 'required_with:days.*.breaks|date_format:H:i',
                'holidays' => 'sometimes|array',
                'holidays.*' => 'string|regex:/^\d{2}-\d{2}$/',
            ];
        } else {
            $rules = [
                'dates' => 'required|array',
                'dates.*.working_hours' => 'required|array',
                'dates.*.working_hours.start' => 'required|date_format:H:i',
                'dates.*.working_hours.end' => 'required|date_format:H:i',
                'dates.*.breaks' => 'sometimes|array',
                'dates.*.breaks.*.start' => 'required_with:dates.*.breaks|date_format:H:i',
                'dates.*.breaks.*.end' => 'required_with:dates.*.breaks|date_format:H:i',
            ];
        }

        $validator = Validator::make($data, $rules);

        if ($validator->fails()) {
            throw new ValidationException($validator);
        }
    }
}



=== app/Actions/CreateOrUpdateCompanyAction.php ===
<?php

namespace App\Actions;

use App\Models\Company;

class CreateOrUpdateCompanyAction
{
    public function execute(int $companyId, ?string $name = null): Company
    {
        $company = Company::find($companyId);

        if (!$company) {
            $company = Company::create([
                'id' => $companyId,
                'name' => $name ?? '–ö–æ–º–ø–∞–Ω–∏—è_' . $companyId,
            ]);
        }

        return $company;
    }
}



=== app/Actions/CreateBookingAction.php ===
<?php
// app/Actions/CreateBookingAction.php

namespace App\Actions;

use App\Models\Booking;
use App\Models\Resource;
use App\Enums\BookingStatus;
use App\ValueObjects\ResourceConfig;
use Illuminate\Support\Facades\DB;
use Carbon\Carbon;

class CreateBookingAction
{
    public function __construct(
        private \App\Services\Booking\BookingService $bookingService
    ) {}

    public function execute(
        Resource $resource,
        string $start,
        string $end,
        array $bookerData = [],
        bool $isAdmin = false // –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —ç—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –µ—Å—Ç—å
    ): Booking {
        return DB::transaction(function () use ($resource, $start, $end, $bookerData, $isAdmin) {
            $config = $resource->getResourceConfig();
            $startTime = Carbon::parse($start);
            $endTime = Carbon::parse($end);

            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
            if (!$this->bookingService->isTimeRangeAvailable($resource, $startTime, $endTime)) {
                throw new \Exception('–í—ã–±—Ä–∞–Ω–Ω—ã–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–∑–∞–Ω—è—Ç –∏–ª–∏ –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è —Å –ø–µ—Ä–µ—Ä—ã–≤–æ–º)');
            }

            $status = $config->requiresConfirmation() && !$isAdmin
                ? BookingStatus::PENDING
                : BookingStatus::CONFIRMED;

            $booking = Booking::create([
                'company_id' => $resource->company_id,
                'resource_id' => $resource->id,
                'timetable_id' => $resource->getEffectiveTimetable()?->id,
                'is_group_booking' => $config->isGroupResource(),
                'start' => $startTime,
                'end' => $endTime,
                'status' => $status->value,
            ]);

            if (!empty($bookerData)) {
                app(AttachBookerAction::class)->execute($booking, $bookerData);
            }

            return $booking;
        });
    }
}



=== app/Enums/SlotStrategy.php ===
<?php

namespace App\Enums;

enum SlotStrategy: string
{
    case FIXED = 'fixed';
    case dynamic = 'dynamic';

    public static function values(): array
    {
        return array_column(self::cases(), 'value');
    }

    public static function isValid(string $value): bool
    {
        return in_array($value, self::values());
    }

    public function label(): string
    {
        return match($this) {
            self::FIXED => 'Fixed',
            self::dynamic => 'dynamic',
        };
    }
}



=== app/Enums/BookingStatus.php ===
<?php

namespace App\Enums;

enum BookingStatus: string
{
    case PENDING = 'pending';
    case CONFIRMED = 'confirmed';
    case CANCELLED_BY_CLIENT = 'cancelled_by_client';
    case CANCELLED_BY_ADMIN = 'cancelled_by_admin';
    case REJECTED = 'rejected';

    public static function values(): array
    {
        return array_column(self::cases(), 'value');
    }

    public function label(): string
    {
        return match($this) {
            self::PENDING => '–û–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è',
            self::CONFIRMED => '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞',
            self::CANCELLED_BY_CLIENT => '–û—Ç–º–µ–Ω–µ–Ω–∞ –∫–ª–∏–µ–Ω—Ç–æ–º',
            self::CANCELLED_BY_ADMIN => '–û—Ç–º–µ–Ω–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º',
            self::REJECTED => '–û—Ç–∫–ª–æ–Ω–µ–Ω–∞',
        };
    }

    public function isActive(): bool
    {
        return in_array($this, [self::PENDING, self::CONFIRMED]);
    }

    public function isCancelled(): bool
    {
        return in_array($this, [self::CANCELLED_BY_CLIENT, self::CANCELLED_BY_ADMIN, self::REJECTED]);
    }
}



=== app/Enums/TimetableType.php ===
<?php

namespace App\Enums;

enum TimetableType: string
{
    case STATIC = 'static';
    case dynamic = 'dynamic';

    public static function values(): array
    {
        return array_column(self::cases(), 'value');
    }

    public static function isValid(string $value): bool
    {
        return in_array($value, self::values());
    }

    public function label(): string
    {
        return match($this) {
            self::STATIC => 'Static Schedule',
            self::dynamic => 'dynamic Schedule',
        };
    }

    public function isStatic(): bool
    {
        return $this === self::STATIC;
    }

    public function isdynamic(): bool
    {
        return $this === self::dynamic;
    }
}



=== app/Models/Concerns/HasResourceConfig.php ===
<?php

namespace App\Models\Concerns;

use App\ValueObjects\ResourceConfig;

trait HasResourceConfig
{
    public function getResourceConfig(): ResourceConfig
    {
        $config = $this->resource_config ?? [];

        if (empty($config) && method_exists($this, 'resourceType')) {
            $config = $this->resourceType->resource_config ?? [];
        }

        return new ResourceConfig($config);
    }

    public function getEffectiveTimetable()
    {
        if ($this->timetable_id) {
            return $this->timetable;
        }

        if (method_exists($this, 'resourceType') && $this->resourceType?->timetable_id) {
            return $this->resourceType->timetable;
        }

        return null;
    }
}



=== app/Models/Timetable.php ===
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\Relations\HasMany;

class Timetable extends Model
{
    use HasFactory;

    protected $fillable = [
        'company_id',
        'type',
        'schedule',
    ];

    protected $casts = [
        'schedule' => 'array',
    ];

    public function company(): BelongsTo
    {
        return $this->belongsTo(Company::class);
    }

    public function resourceTypes(): HasMany
    {
        return $this->hasMany(ResourceType::class);
    }

    public function resources(): HasMany
    {
        return $this->hasMany(Resource::class);
    }

    public function bookings(): HasMany
    {
        return $this->hasMany(Booking::class);
    }
}



=== app/Models/Booker.php ===
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsToMany;

class Booker extends Model
{
    use HasFactory;

    protected $fillable = [
        'external_id',
        'type',
        'name',
        'email',
        'phone',
        'metadata'
    ];

    protected $casts = [
        'metadata' => 'array'
    ];

    public function bookings(): BelongsToMany
    {
        return $this->belongsToMany(Booking::class, 'booking_booker')
            ->withTimestamps();
    }
}



=== app/Models/ResourceType.php ===
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\Relations\HasMany;
use App\Models\Concerns\HasResourceConfig;

class ResourceType extends Model
{
    use HasFactory, HasResourceConfig;

    protected $fillable = [
        'company_id',
        'timetable_id',
        'type',
        'name',
        'description',
        'options',
        'resource_config',
    ];

    protected $casts = [
        'options' => 'array',
        'resource_config' => 'array',
    ];

    public function company(): BelongsTo
    {
        return $this->belongsTo(Company::class);
    }

    public function timetable(): BelongsTo
    {
        return $this->belongsTo(Timetable::class);
    }

    public function resources(): HasMany
    {
        return $this->hasMany(Resource::class);
    }
}



=== app/Models/Resource.php ===
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use App\Models\Concerns\HasResourceConfig;

class Resource extends Model
{
    use HasFactory, HasResourceConfig;

    protected $fillable = [
        'company_id',
        'timetable_id',
        'resource_type_id',
        'options',
        'payload',
        'resource_config',
    ];

    protected $casts = [
        'options' => 'array',
        'payload' => 'array',
        'resource_config' => 'array',
    ];

    public function company(): BelongsTo
    {
        return $this->belongsTo(Company::class);
    }

    public function timetable(): BelongsTo
    {
        return $this->belongsTo(Timetable::class);
    }

    public function resourceType(): BelongsTo
    {
        return $this->belongsTo(ResourceType::class);
    }

    public function bookings()
    {
        return $this->hasMany(Booking::class);
    }
}



=== app/Models/Company.php ===
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\HasMany;

class Company extends Model
{
    use HasFactory;

    public $incrementing = false; // –û—Ç–∫–ª—é—á–∞–µ–º –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç
    protected $keyType = 'integer'; // –¢–∏–ø –∫–ª—é—á–∞

    protected $fillable = ['id', 'name', 'description'];

    public function timetables(): HasMany
    {
        return $this->hasMany(Timetable::class);
    }

    public function resourceTypes(): HasMany
    {
        return $this->hasMany(ResourceType::class);
    }

    public function resources(): HasMany
    {
        return $this->hasMany(Resource::class);
    }

    public function bookings(): HasMany
    {
        return $this->hasMany(Booking::class);
    }
}



=== app/Models/User.php ===
<?php

namespace App\Models;

// use Illuminate\Contracts\Auth\MustVerifyEmail;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;
use Laravel\Sanctum\HasApiTokens;

class User extends Authenticatable
{
    use HasApiTokens, HasFactory, Notifiable;

    /**
     * The attributes that are mass assignable.
     *
     * @var array<int, string>
     */
    protected $fillable = [
        'name',
        'email',
        'password',
    ];

    /**
     * The attributes that should be hidden for serialization.
     *
     * @var array<int, string>
     */
    protected $hidden = [
        'password',
        'remember_token',
    ];

    /**
     * The attributes that should be cast.
     *
     * @var array<string, string>
     */
    protected $casts = [
        'email_verified_at' => 'datetime',
        'password' => 'hashed',
    ];
}



=== app/Models/Booking.php ===
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\Relations\BelongsToMany;

class Booking extends Model
{
    use HasFactory;

    protected $fillable = [
        'company_id',
        'resource_id',
        'timetable_id',
        'is_group_booking',
        'start',
        'end',
        'status',
        'reason'
    ];

    protected $casts = [
        'is_group_booking' => 'boolean',
        'start' => 'datetime',
        'end' => 'datetime'
    ];

    public function resource(): BelongsTo
    {
        return $this->belongsTo(Resource::class);
    }

    public function timetable(): BelongsTo
    {
        return $this->belongsTo(Timetable::class);
    }

    public function company(): BelongsTo
    {
        return $this->belongsTo(Company::class);
    }

    public function bookers(): BelongsToMany
    {
        return $this->belongsToMany(Booker::class, 'booking_booker')
            ->withTimestamps();
    }
}



=== app/Providers/EventServiceProvider.php ===
<?php

namespace App\Providers;

use Illuminate\Auth\Events\Registered;
use Illuminate\Auth\Listeners\SendEmailVerificationNotification;
use Illuminate\Foundation\Support\Providers\EventServiceProvider as ServiceProvider;

class EventServiceProvider extends ServiceProvider
{
    protected $listen = [
        Registered::class => [
            SendEmailVerificationNotification::class,
        ],
        \App\Events\BookingCreated::class => [
            \App\Listeners\BookingCreatedListener::class,
        ],
        \App\Events\BookingConfirmed::class => [
            \App\Listeners\BookingConfirmedListener::class,
        ],
        \App\Events\BookingCancelled::class => [
            \App\Listeners\BookingCancelledListener::class,
        ],
        \App\Events\BookingRescheduled::class => [
            \App\Listeners\BookingRescheduledListener::class,
        ],
        \App\Events\BookingReminder::class => [
            \App\Listeners\BookingReminderListener::class,
        ],
    ];

    public function boot(): void
    {
        parent::boot();
    }
}



=== app/Providers/RouteServiceProvider.php ===
<?php

namespace App\Providers;

use Illuminate\Cache\RateLimiting\Limit;
use Illuminate\Foundation\Support\Providers\RouteServiceProvider as ServiceProvider;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\RateLimiter;
use Illuminate\Support\Facades\Route;

class RouteServiceProvider extends ServiceProvider
{
    /**
     * The path to your application's "home" route.
     *
     * Typically, users are redirected here after authentication.
     *
     * @var string
     */
    public const HOME = '/home';

    /**
     * Define your route model bindings, pattern filters, and other route configuration.
     */
    public function boot(): void
    {
        RateLimiter::for('api', function (Request $request) {
            return Limit::perMinute(60)->by($request->user()?->id ?: $request->ip());
        });

        $this->routes(function () {
            Route::middleware('api')
                ->prefix('api')
                ->group(base_path('routes/api.php'));

            Route::middleware('web')
                ->group(base_path('routes/web.php'));
        });
    }
}



=== app/Providers/AppServiceProvider.php ===
<?php

namespace App\Providers;

use Illuminate\Support\ServiceProvider;
use App\Services\Booking\BookingService;
use App\Services\Booking\SlotGenerationService;
use App\Services\ArtisanCommandService;

class AppServiceProvider extends ServiceProvider
{
    public function register(): void
    {
        $this->app->singleton(SlotGenerationService::class);
        $this->app->singleton(BookingService::class);
        $this->app->singleton(ArtisanCommandService::class);
    }

    public function boot(): void
    {
        //
    }
}



=== app/Providers/AuthServiceProvider.php ===
<?php

namespace App\Providers;

// use Illuminate\Support\Facades\Gate;
use Illuminate\Foundation\Support\Providers\AuthServiceProvider as ServiceProvider;

class AuthServiceProvider extends ServiceProvider
{
    /**
     * The model to policy mappings for the application.
     *
     * @var array<class-string, class-string>
     */
    protected $policies = [
        //
    ];

    /**
     * Register any authentication / authorization services.
     */
    public function boot(): void
    {
        //
    }
}



=== app/Providers/BroadcastServiceProvider.php ===
<?php

namespace App\Providers;

use Illuminate\Support\Facades\Broadcast;
use Illuminate\Support\ServiceProvider;

class BroadcastServiceProvider extends ServiceProvider
{
    /**
     * Bootstrap any application services.
     */
    public function boot(): void
    {
        Broadcast::routes();

        require base_path('routes/channels.php');
    }
}



=== app/ValueObjects/ResourceConfig.php ===
<?php

namespace App\ValueObjects;

use App\Enums\SlotStrategy;
use InvalidArgumentException;

class ResourceConfig
{
    public ?bool $require_confirmation = false;
    public ?int $slot_duration_minutes = 60;
    public ?int $max_participants = null;
    public ?SlotStrategy $slot_strategy = SlotStrategy::FIXED;
    public ?int $min_advance_time = 0;
    public ?int $cancellation_time = null;
    public ?int $reschedule_time = null;
    public ?int $reminder_time = null;

    public function __construct(array $data = [])
    {
        foreach ($data as $key => $value) {
            if (property_exists($this, $key)) {
                $this->setProperty($key, $value);
            }
        }

        $this->validate();
    }

    private function setProperty(string $key, $value): void
    {
        if ($key === 'slot_strategy') {
            $this->slot_strategy = is_string($value) ? SlotStrategy::from($value) : $value;
        } else {
            $this->$key = $value;
        }
    }

    private function validate(): void
    {
        if ($this->slot_duration_minutes !== null && $this->slot_duration_minutes <= 0) {
            throw new InvalidArgumentException('Slot duration must be positive');
        }

        if ($this->max_participants !== null && $this->max_participants < 0) {
            throw new InvalidArgumentException('Max participants cannot be negative');
        }
    }

    public function toArray(): array
    {
        return [
            'require_confirmation' => $this->require_confirmation,
            'slot_duration_minutes' => $this->slot_duration_minutes,
            'max_participants' => $this->max_participants,
            'slot_strategy' => $this->slot_strategy->value,
            'min_advance_time' => $this->min_advance_time,
            'cancellation_time' => $this->cancellation_time,
            'reschedule_time' => $this->reschedule_time,
            'reminder_time' => $this->reminder_time,
        ];
    }

    public function isGroupResource(): bool
    {
        return $this->max_participants !== null && $this->max_participants > 1;
    }

    public function requiresConfirmation(): bool
    {
        return $this->require_confirmation === true;
    }

    public function isFixedStrategy(): bool
    {
        return $this->slot_strategy === SlotStrategy::FIXED;
    }

    public function isDynamicStrategy(): bool
    {
        return $this->slot_strategy === SlotStrategy::dynamic;
    }

    public function canCancel(\DateTime $bookingStart): bool
    {
        if ($this->cancellation_time === null) return true;

        // –î–ª—è —Å—Ç—Ä–æ–≥–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π: –µ—Å–ª–∏ cancellation_time = 0, –æ—Ç–º–µ–Ω–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞
        if ($this->cancellation_time === 0) {
            return false;
        }

        $now = new \DateTime();
        $diff = $now->diff($bookingStart);
        $minutes = $diff->days * 24 * 60 + $diff->h * 60 + $diff->i;

        return $minutes >= $this->cancellation_time;
    }

    public function canReschedule(\DateTime $bookingStart): bool
    {
        if ($this->reschedule_time === null) return true;

        // –î–ª—è —Å—Ç—Ä–æ–≥–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π: –µ—Å–ª–∏ reschedule_time = 0, –ø–µ—Ä–µ–Ω–æ—Å –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω
        if ($this->reschedule_time === 0) {
            return false;
        }

        $now = new \DateTime();
        $diff = $now->diff($bookingStart);
        $minutes = $diff->days * 24 * 60 + $diff->h * 60 + $diff->i;

        return $minutes >= $this->reschedule_time;
    }

    public function shouldSendReminder(\DateTime $bookingStart): bool
    {
        if ($this->reminder_time === null) return false;

        $now = new \DateTime();
        $diff = $now->diff($bookingStart);
        $minutes = $diff->days * 24 * 60 + $diff->h * 60 + $diff->i;

        return $minutes <= $this->reminder_time;
    }
}



=== app/Events/BookingCancelled.php ===
<?php

namespace App\Events;

use App\Models\Booking;
use Illuminate\Broadcasting\InteractsWithSockets;
use Illuminate\Foundation\Events\Dispatchable;
use Illuminate\Queue\SerializesModels;

class BookingCancelled
{
    use Dispatchable, InteractsWithSockets, SerializesModels;

    public function __construct(public Booking $booking)
    {
    }
}



=== app/Events/BookingReminder.php ===
<?php

namespace App\Events;

use App\Models\Booking;
use Illuminate\Broadcasting\InteractsWithSockets;
use Illuminate\Foundation\Events\Dispatchable;
use Illuminate\Queue\SerializesModels;

class BookingReminder
{
    use Dispatchable, InteractsWithSockets, SerializesModels;

    public function __construct(public Booking $booking)
    {
    }
}



=== app/Events/BookingCreated.php ===
<?php

namespace App\Events;

use App\Models\Booking;
use Illuminate\Broadcasting\InteractsWithSockets;
use Illuminate\Foundation\Events\Dispatchable;
use Illuminate\Queue\SerializesModels;

class BookingCreated
{
    use Dispatchable, InteractsWithSockets, SerializesModels;

    public function __construct(public Booking $booking)
    {
    }
}



=== app/Events/BookingConfirmed.php ===
<?php

namespace App\Events;

use App\Models\Booking;
use Illuminate\Broadcasting\InteractsWithSockets;
use Illuminate\Foundation\Events\Dispatchable;
use Illuminate\Queue\SerializesModels;

class BookingConfirmed
{
    use Dispatchable, InteractsWithSockets, SerializesModels;

    public function __construct(public Booking $booking)
    {
    }
}



=== app/Events/BookingRescheduled.php ===
<?php

namespace App\Events;

use App\Models\Booking;
use Illuminate\Broadcasting\InteractsWithSockets;
use Illuminate\Foundation\Events\Dispatchable;
use Illuminate\Queue\SerializesModels;

class BookingRescheduled
{
    use Dispatchable, InteractsWithSockets, SerializesModels;

    public function __construct(public Booking $booking)
    {
    }
}



=== app/sh/files.sh ===
#!/bin/bash

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd "$(dirname "$0")"

# –ë–∞–∑–æ–≤—ã–π URL –¥–ª—è —Å—ã—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤
BASE_URL="https://raw.githubusercontent.com/tarzanpasha/booking-v2/refs/heads/master"

# –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª —Å –ø–æ–ª–Ω—ã–º–∏ URL
find . -type f \
    ! -path "./Vendor/*" \
    ! -path "./vendor/*" \
    ! -path "./Docker/*" \
    ! -path "./docker/*" \
    ! -path "./.git/*" \
    ! -path "./.idea/*" \
    -print0 | while IFS= read -r -d '' file; do
    # –£–¥–∞–ª—è–µ–º ./ –≤ –Ω–∞—á–∞–ª–µ –ø—É—Ç–∏ –∏ –¥–æ–±–∞–≤–ª—è–µ–º URL
    relative_path="${file#./}"
    echo "${BASE_URL}/${relative_path}"
done > project_files.txt

echo "–§–∞–π–ª project_files.txt —Å–æ–∑–¥–∞–Ω"
echo "–ù–∞–π–¥–µ–Ω–æ —Ñ–∞–π–ª–æ–≤: $(wc -l < project_files.txt)"



=== app/Listeners/BookingReminderListener.php ===
<?php

namespace App\Listeners;

use App\Events\BookingReminder;
use App\Services\Logging\BookingLoggerService;

class BookingReminderListener
{
    public function handle(BookingReminder $event)
    {
        BookingLoggerService::info("‚è∞ [EVENT] –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –±—Ä–æ–Ω–∏", [
            'booking_id' => $event->booking->id,
            'start' => $event->booking->start
        ]);
    }
}



=== app/Listeners/BookingCancelledListener.php ===
<?php

namespace App\Listeners;

use App\Events\BookingCancelled;
use App\Services\Logging\BookingLoggerService;

class BookingCancelledListener
{
    public function handle(BookingCancelled $event)
    {
        BookingLoggerService::warning("‚ùå [EVENT] –ë—Ä–æ–Ω—å –æ—Ç–º–µ–Ω–µ–Ω–∞", [
            'booking_id' => $event->booking->id,
            'status' => $event->booking->status,
            'reason' => $event->booking->reason
        ]);
    }
}



=== app/Listeners/BookingCreatedListener.php ===
<?php

namespace App\Listeners;

use App\Events\BookingCreated;
use App\Services\Logging\BookingLoggerService;

class BookingCreatedListener
{
    public function handle(BookingCreated $event)
    {
        BookingLoggerService::info("üìù [EVENT] –ù–æ–≤–∞—è –±—Ä–æ–Ω—å —Å–æ–∑–¥–∞–Ω–∞", [
            'booking_id' => $event->booking->id,
            'resource_id' => $event->booking->resource_id,
            'status' => $event->booking->status
        ]);
    }
}



=== app/Listeners/BookingRescheduledListener.php ===
<?php

namespace App\Listeners;

use App\Events\BookingRescheduled;
use App\Services\Logging\BookingLoggerService;

class BookingRescheduledListener
{
    public function handle(BookingRescheduled $event)
    {
        BookingLoggerService::info("üîÅ [EVENT] –ë—Ä–æ–Ω—å –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞", [
            'booking_id' => $event->booking->id,
            'new_start' => $event->booking->start,
            'new_end' => $event->booking->end
        ]);
    }
}



=== app/Listeners/BookingConfirmedListener.php ===
<?php

namespace App\Listeners;

use App\Events\BookingConfirmed;
use App\Services\Logging\BookingLoggerService;

class BookingConfirmedListener
{
    public function handle(BookingConfirmed $event)
    {
        BookingLoggerService::info("‚úÖ [EVENT] –ë—Ä–æ–Ω—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞", [
            'booking_id' => $event->booking->id,
            'status' => $event->booking->status
        ]);
    }
}



=== app/Exceptions/Handler.php ===
<?php

namespace App\Exceptions;

use Illuminate\Foundation\Exceptions\Handler as ExceptionHandler;
use Throwable;

class Handler extends ExceptionHandler
{
    /**
     * The list of the inputs that are never flashed to the session on validation exceptions.
     *
     * @var array<int, string>
     */
    protected $dontFlash = [
        'current_password',
        'password',
        'password_confirmation',
    ];

    /**
     * Register the exception handling callbacks for the application.
     */
    public function register(): void
    {
        $this->reportable(function (Throwable $e) {
            //
        });
    }
}



=== app/Data/ScenarioTimetableData.php ===
<?php

namespace App\Data;

class ScenarioTimetableData
{
    public static function getTimetableForScenario(int $scenarioId): array
    {
        $timetables = [
            1 => [
                'type' => 'static',
                'schedule' => [
                    'days' => [
                        'monday' => [
                            'working_hours' => ['start' => '09:00', 'end' => '18:00'],
                            'breaks' => [['start' => '13:15', 'end' => '14:15']]
                        ],
                        'tuesday' => [
                            'working_hours' => ['start' => '09:00', 'end' => '18:00'],
                            'breaks' => [['start' => '13:15', 'end' => '14:15']]
                        ],
                        'wednesday' => [
                            'working_hours' => ['start' => '09:00', 'end' => '18:00'],
                            'breaks' => [['start' => '13:15', 'end' => '14:15']]
                        ],
                        'thursday' => [
                            'working_hours' => ['start' => '09:00', 'end' => '18:00'],
                            'breaks' => [['start' => '13:15', 'end' => '14:15']]
                        ],
                        'friday' => [
                            'working_hours' => ['start' => '09:00', 'end' => '18:00'],
                            'breaks' => [['start' => '13:15', 'end' => '14:15']]
                        ]
                    ]
                ]
            ],
            2 => [
                'type' => 'static',
                'schedule' => [
                    'days' => [
                        'monday' => ['working_hours' => ['start' => '08:00', 'end' => '20:00']],
                        'tuesday' => ['working_hours' => ['start' => '08:00', 'end' => '20:00']],
                        'wednesday' => ['working_hours' => ['start' => '08:00', 'end' => '20:00']],
                        'thursday' => ['working_hours' => ['start' => '08:00', 'end' => '20:00']],
                        'friday' => ['working_hours' => ['start' => '08:00', 'end' => '18:00']],
                    ]
                ]
            ],
            3 => [
                'type' => 'static',
                'schedule' => [
                    'days' => [
                        'monday' => ['working_hours' => ['start' => '07:00', 'end' => '22:00']],
                        'tuesday' => ['working_hours' => ['start' => '07:00', 'end' => '22:00']],
                        'wednesday' => ['working_hours' => ['start' => '07:00', 'end' => '22:00']],
                        'thursday' => ['working_hours' => ['start' => '07:00', 'end' => '22:00']],
                        'friday' => ['working_hours' => ['start' => '07:00', 'end' => '22:00']],
                        'saturday' => ['working_hours' => ['start' => '09:00', 'end' => '18:00']],
                        'sunday' => ['working_hours' => ['start' => '09:00', 'end' => '16:00']],
                    ]
                ]
            ],
            4 => [
                'type' => 'static',
                'schedule' => [
                    'days' => [
                        'monday' => [
                            'working_hours' => ['start' => '09:00', 'end' => '18:00'],
                            'breaks' => [['start' => '12:30', 'end' => '13:30']]
                        ],
                        'tuesday' => [
                            'working_hours' => ['start' => '09:00', 'end' => '18:00'],
                            'breaks' => [['start' => '12:30', 'end' => '13:30']]
                        ],
                        'wednesday' => [
                            'working_hours' => ['start' => '09:00', 'end' => '18:00'],
                            'breaks' => [['start' => '12:30', 'end' => '13:30']]
                        ],
                        'thursday' => [
                            'working_hours' => ['start' => '09:00', 'end' => '18:00'],
                            'breaks' => [['start' => '12:30', 'end' => '13:30']]
                        ],
                        'friday' => [
                            'working_hours' => ['start' => '09:00', 'end' => '18:00'],
                            'breaks' => [['start' => '12:30', 'end' => '13:30']]
                        ],
                    ]
                ]
            ],
            5 => [
                'type' => 'static',
                'schedule' => [
                    'days' => [
                        'monday' => ['working_hours' => ['start' => '00:00', 'end' => '23:59']],
                        'tuesday' => ['working_hours' => ['start' => '00:00', 'end' => '23:59']],
                        'wednesday' => ['working_hours' => ['start' => '00:00', 'end' => '23:59']],
                        'thursday' => ['working_hours' => ['start' => '00:00', 'end' => '23:59']],
                        'friday' => ['working_hours' => ['start' => '00:00', 'end' => '23:59']],
                        'saturday' => ['working_hours' => ['start' => '00:00', 'end' => '23:59']],
                        'sunday' => ['working_hours' => ['start' => '00:00', 'end' => '23:59']],
                    ]
                ]
            ],
            6 => [
                'type' => 'static',
                'schedule' => [
                    'days' => [
                        'monday' => ['working_hours' => ['start' => '08:00', 'end' => '20:00']],
                        'tuesday' => ['working_hours' => ['start' => '08:00', 'end' => '20:00']],
                        'wednesday' => ['working_hours' => ['start' => '08:00', 'end' => '20:00']],
                        'thursday' => ['working_hours' => ['start' => '08:00', 'end' => '20:00']],
                        'friday' => ['working_hours' => ['start' => '08:00', 'end' => '20:00']],
                    ]
                ]
            ],
            7 => [
                'type' => 'static',
                'schedule' => [
                    'days' => [
                        'monday' => [
                            'working_hours' => ['start' => '09:00', 'end' => '20:00'],
                            'breaks' => [['start' => '13:15', 'end' => '14:15']]
                        ],
                        'tuesday' => [
                            'working_hours' => ['start' => '09:00', 'end' => '20:00'],
                            'breaks' => [['start' => '13:15', 'end' => '14:15']]
                        ],
                        'wednesday' => [
                            'working_hours' => ['start' => '10:00', 'end' => '18:00'],
                            'breaks' => [['start' => '14:00', 'end' => '15:00']]
                        ],
                        'thursday' => [
                            'working_hours' => ['start' => '09:00', 'end' => '20:00'],
                            'breaks' => [['start' => '13:15', 'end' => '14:15']]
                        ],
                        'friday' => [
                            'working_hours' => ['start' => '09:00', 'end' => '21:00'],
                            'breaks' => [['start' => '13:15', 'end' => '14:15']]
                        ],
                        'saturday' => [
                            'working_hours' => ['start' => '10:00', 'end' => '16:00'],
                            'breaks' => [['start' => '13:15', 'end' => '14:15']]
                        ]
                    ],
                    'holidays' => ['01-01', '01-02', '01-07', '03-08', '05-01', '05-09']
                ]
            ],
            8 => [
                'type' => 'static',
                'schedule' => [
                    'days' => [
                        'monday' => [
                            'working_hours' => ['start' => '08:00', 'end' => '22:00'],
                            'breaks' => [
                                ['start' => '12:15', 'end' => '13:15'],
                                ['start' => '16:00', 'end' => '16:30']
                            ]
                        ],
                        'tuesday' => [
                            'working_hours' => ['start' => '08:00', 'end' => '22:00'],
                            'breaks' => [
                                ['start' => '12:15', 'end' => '13:15'],
                                ['start' => '16:00', 'end' => '16:30']
                            ]
                        ],
                        'wednesday' => [
                            'working_hours' => ['start' => '08:00', 'end' => '22:00'],
                            'breaks' => [
                                ['start' => '12:15', 'end' => '13:15'],
                                ['start' => '16:00', 'end' => '16:30']
                            ]
                        ],
                        'thursday' => [
                            'working_hours' => ['start' => '08:00', 'end' => '22:00'],
                            'breaks' => [
                                ['start' => '12:15', 'end' => '13:15'],
                                ['start' => '16:00', 'end' => '16:30']
                            ]
                        ],
                        'friday' => [
                            'working_hours' => ['start' => '08:00', 'end' => '20:00'],
                            'breaks' => [
                                ['start' => '12:15', 'end' => '13:15'],
                                ['start' => '15:00', 'end' => '15:30']
                            ]
                        ],
                        'saturday' => [
                            'working_hours' => ['start' => '10:00', 'end' => '16:00'],
                            'breaks' => [['start' => '13:15', 'end' => '14:15']]
                        ]
                    ],
                    'holidays' => ['01-01', '01-02', '01-07', '02-23', '03-08', '05-01', '05-09', '06-12', '11-04']
                ]
            ]
        ];

        return $timetables[$scenarioId] ?? $timetables[1];
    }
}



=== app/Data/ScenarioResourceConfigData.php ===
<?php

namespace App\Data;

class ScenarioResourceConfigData
{
    public static function getResourceConfigForScenario(int $scenarioId): array
    {
        $configs = [
            1 => [
                'require_confirmation' => false,
                'slot_duration_minutes' => 60,
                'slot_strategy' => 'fixed',
                'min_advance_time' => 60,
                'cancellation_time' => 120,
                'reschedule_time' => 240,
                'reminder_time' => 1440
            ],
            2 => [
                'require_confirmation' => true,
                'slot_duration_minutes' => 30,
                'slot_strategy' => 'dynamic',
                'min_advance_time' => 1440,
                'cancellation_time' => 720,
                'reschedule_time' => 1440
            ],
            3 => [
                'require_confirmation' => false,
                'slot_duration_minutes' => 90,
                'slot_strategy' => 'fixed',
                'max_participants' => 10,
                'min_advance_time' => 60,
                'cancellation_time' => 180,
                'reschedule_time' => 360
            ],
            4 => [
                'require_confirmation' => true,
                'slot_duration_minutes' => 120,
                'slot_strategy' => 'dynamic',
                'min_advance_time' => 2880, // 48 —á–∞—Å–æ–≤
                'cancellation_time' => 0,    // –û—Ç–º–µ–Ω–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
                'reschedule_time' => 0,      // –ü–µ—Ä–µ–Ω–æ—Å –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
                'reminder_time' => 1440
            ],
            5 => [
                'require_confirmation' => false,
                'slot_duration_minutes' => 1440,
                'slot_strategy' => 'fixed',
                'min_advance_time' => 0,
                'cancellation_time' => 10080,
                'reschedule_time' => 10080
            ],
            6 => [
                'require_confirmation' => true,
                'slot_duration_minutes' => 60,
                'slot_strategy' => 'dynamic',
                'min_advance_time' => 0,
                'cancellation_time' => 0,
                'reschedule_time' => 0
            ],
            7 => [
                'require_confirmation' => false,
                'slot_duration_minutes' => 60,
                'slot_strategy' => 'fixed',
                'min_advance_time' => 120,
                'cancellation_time' => 180,
                'reschedule_time' => 360,
                'reminder_time' => 1440
            ],
            8 => [
                'require_confirmation' => true,
                'slot_duration_minutes' => 60,
                'slot_strategy' => 'dynamic',
                'max_participants' => 20,
                'min_advance_time' => 1440,
                'cancellation_time' => 720,
                'reschedule_time' => 1440
            ]
        ];

        return $configs[$scenarioId] ?? $configs[1];
    }
}



=== app/Data/ScenarioOptionsData.php ===
<?php

namespace App\Data;

class ScenarioOptionsData
{
    public static function getResourceOptionsForScenario(int $scenarioId): array
    {
        $options = [
            1 => ['specialization' => '–ü–∞—Ä–∏–∫–º–∞—Ö–µ—Ä', 'experience' => '5 –ª–µ—Ç'],
            2 => ['location' => '–≠—Ç–∞–∂ 3', 'capacity' => 8, 'equipment' => ['projector', 'whiteboard']],
            3 => ['location' => '–ó–∞–ª –ê', 'trainer' => '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤', 'type' => '–ô–æ–≥–∞'],
            4 => ['name' => '3D –ø—Ä–∏–Ω—Ç–µ—Ä', 'model' => 'Ultimaker S5', 'value' => '250000 —Ä—É–±'],
            5 => ['room_number' => '404', 'type' => '–°—Ç–∞–Ω–¥–∞—Ä—Ç', 'beds' => 2],
            6 => ['priority' => 'high', 'emergency_contact' => '+7-XXX-XXX-XX-XX'],
            7 => ['specialization' => '–ö–æ—Å–º–µ—Ç–æ–ª–æ–≥', 'services' => ['–º–∞–Ω–∏–∫—é—Ä', '–ø–µ–¥–∏–∫—é—Ä']],
            8 => ['location' => '–ë–∏–∑–Ω–µ—Å-—Ü–µ–Ω—Ç—Ä "–°–∏—Ç–∏"', 'floor' => '15', 'capacity' => 50]
        ];

        return $options[$scenarioId] ?? ['scenario_id' => $scenarioId, 'demo' => true];
    }

    public static function getScenarioDescription(int $scenarioId): string
    {
        $descriptions = [
            1 => "–ü–∞—Ä–∏–∫–º–∞—Ö–µ—Ä—Å–∫–∞—è —É—Å–ª—É–≥–∞ —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å–ª–æ—Ç–∞–º–∏ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º",
            2 => "–ü–µ—Ä–µ–≥–æ–≤–æ—Ä–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ —Å–ª–æ—Ç–∞–º–∏ –∏ —Ä—É—á–Ω—ã–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º",
            3 => "–ì—Ä—É–ø–ø–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å–ª–æ—Ç–∞–º–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤",
            4 => "–î–æ—Ä–æ–≥–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ —Å–ª–æ—Ç–∞–º–∏ –∏ —Å—Ç—Ä–æ–≥–∏–º–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏",
            5 => "–ì–æ—Å—Ç–∏–Ω–∏—á–Ω—ã–π –Ω–æ–º–µ—Ä —Å –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏–º–∏ –±—Ä–æ–Ω—è–º–∏ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π",
            6 => "–≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ —Å–ª—É—á–∞–∏ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞",
            7 => "–°–∞–ª–æ–Ω –∫—Ä–∞—Å–æ—Ç—ã —Å–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –∏ —É—á–µ—Ç–æ–º –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã—Ö –¥–Ω–µ–π",
            8 => "–ë–∏–∑–Ω–µ—Å-—Ü–µ–Ω—Ç—Ä —Å–æ —Å–ª–æ–∂–Ω—ã–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –ø–µ—Ä–µ—Ä—ã–≤–∞–º–∏"
        ];

        return $descriptions[$scenarioId] ?? "–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π {$scenarioId}";
    }
}



=== app/Data/WorkingHoursTemplates.php ===
<?php

namespace App\Data;

class WorkingHoursTemplates
{
    public static function getWorkingDaysPatterns(): array
    {
        return [
            ['monday', 'wednesday', 'friday'],    // –ü–Ω, –°—Ä, –ü—Ç
            ['tuesday', 'thursday', 'saturday'],  // –í—Ç, –ß—Ç, –°–±
        ];
    }

    public static function getWorkingHoursTemplates(): array
    {
        return [
            [
                'regular' => ['start' => '08:00', 'end' => '17:00'],
                'early' => ['start' => '08:00', 'end' => '16:00'] // –ù–∞ —á–∞—Å —Ä–∞–Ω—å—à–µ
            ],
            [
                'regular' => ['start' => '09:00', 'end' => '18:00'],
                'early' => ['start' => '09:00', 'end' => '17:00'] // –ù–∞ —á–∞—Å —Ä–∞–Ω—å—à–µ
            ],
            [
                'regular' => ['start' => '10:00', 'end' => '19:00'],
                'early' => ['start' => '10:00', 'end' => '18:00'] // –ù–∞ —á–∞—Å —Ä–∞–Ω—å—à–µ
            ]
        ];
    }

    public static function getRussianHolidays(): array
    {
        return [
            '01-01', '01-02', '01-03', '01-04', '01-05', '01-06', '01-08', // –ù–æ–≤–æ–≥–æ–¥–Ω–∏–µ –∫–∞–Ω–∏–∫—É–ª—ã
            '01-07', // –†–æ–∂–¥–µ—Å—Ç–≤–æ
            '02-23', // –î–µ–Ω—å –∑–∞—â–∏—Ç–Ω–∏–∫–∞ –û—Ç–µ—á–µ—Å—Ç–≤–∞
            '03-08', // –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π –∂–µ–Ω—Å–∫–∏–π –¥–µ–Ω—å
            '05-01', // –ü—Ä–∞–∑–¥–Ω–∏–∫ –í–µ—Å–Ω—ã –∏ –¢—Ä—É–¥–∞
            '05-09', // –î–µ–Ω—å –ü–æ–±–µ–¥—ã
            '06-12', // –î–µ–Ω—å –†–æ—Å—Å–∏–∏
            '11-04', // –î–µ–Ω—å –Ω–∞—Ä–æ–¥–Ω–æ–≥–æ –µ–¥–∏–Ω—Å—Ç–≤–∞
        ];
    }
}



=== app/Data/DynamicScheduleTemplates.php ===
<?php

namespace App\Data;

class DynamicScheduleTemplates
{
    public static function getScheduleTypes(): array
    {
        return [
            '8h_normal' => ['start' => '09:00', 'end' => '17:00'],
            '8h_early' => ['start' => '08:00', 'end' => '16:00'],
            '8h_late' => ['start' => '10:00', 'end' => '18:00'],
            '10h' => ['start' => '08:00', 'end' => '18:00'],
            '12h' => ['start' => '08:00', 'end' => '20:00'],
            '24h' => ['start' => '08:00', 'end' => '08:00'], // –°–ª–µ–¥—É—é—â–µ–≥–æ –¥–Ω—è
            '6h_short' => ['start' => '10:00', 'end' => '16:00'],
        ];
    }

    public static function getBreakConfigurations(): array
    {
        return [
            '8h_normal' => ['break_count' => [1, 2], 'min_duration' => 30, 'max_duration' => 60],
            '8h_early' => ['break_count' => [1, 2], 'min_duration' => 30, 'max_duration' => 60],
            '8h_late' => ['break_count' => [1, 2], 'min_duration' => 30, 'max_duration' => 60],
            '10h' => ['break_count' => [2, 3], 'min_duration' => 15, 'max_duration' => 45],
            '12h' => ['break_count' => [3, 4], 'min_duration' => 15, 'max_duration' => 60],
            '24h' => ['break_count' => [4, 6], 'min_duration' => 15, 'max_duration' => 60],
            '6h_short' => ['break_count' => [0, 1], 'min_duration' => 15, 'max_duration' => 30],
        ];
    }
}



=== app/Services/Booking/SlotGenerationService.php ===
<?php

namespace App\Services\Booking;

use App\Models\Resource;
use App\Models\Booking;
use App\ValueObjects\ResourceConfig;
use Carbon\Carbon;
use Carbon\CarbonPeriod;

class SlotGenerationService
{
    public function getNextAvailableSlots(
        Resource $resource,
        Carbon $from = null,
        int $count = 5,
        bool $onlyToday = true
    ): array {
        $from = $from ?? now();
        $config = $resource->getResourceConfig();
        $slots = [];
        $currentDate = $from->copy();

        while (count($slots) < $count) {
            $daySlots = $this->generateSlotsForDate($resource, $currentDate);

            // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –ø—É—Å—Ç—ã–µ —Å–ª–æ—Ç—ã –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
            if (!empty($daySlots)) {
                foreach ($daySlots as $slot) {
                    if (count($slots) >= $count) break;

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Å–ª–æ—Ç –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
                    if (isset($slot['start']) && isset($slot['end'])) {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Å–ª–æ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω
                        if ($this->isSlotAvailable($resource, $slot['start'], 1)) {
                            $slots[] = $slot;
                        }
                    }
                }
            }

            if ($onlyToday) break;
            $currentDate->addDay();
        }

        return $slots;
    }

    public function generateSlotsForDate(Resource $resource, Carbon $date): array
    {
        $config = $resource->getResourceConfig();
        $timetable = $resource->getEffectiveTimetable();

        if (!$timetable) {
            return [];
        }

        $workingHours = $this->getWorkingHoursForDate($timetable, $date);

        // –ï—Å–ª–∏ —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã (–ø—Ä–∞–∑–¥–Ω–∏–∫ –∏–ª–∏ –≤—ã—Ö–æ–¥–Ω–æ–π) - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
        if (!$workingHours) {
            return [];
        }

        $slots = $config->isFixedStrategy()
            ? $this->generateFixedSlots($resource, $date, $workingHours, $config)
            : $this->generateDynamicSlots($resource, $date, $workingHours, $config);

        // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º —á—Ç–æ –≤—Å–µ —Å–ª–æ—Ç—ã –∏–º–µ—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
        return array_filter($slots, function($slot) {
            return isset($slot['start']) && isset($slot['end']) && isset($slot['duration_minutes']);
        });
    }

    private function generateFixedSlots(Resource $resource, Carbon $date, array $workingHours, ResourceConfig $config): array
    {
        if (!isset($workingHours['working_hours'])) {
            return [];
        }

        $workingHours = $workingHours['working_hours'];
        $slots = [];
        $slotDuration = $config->slot_duration_minutes ?? 60;

        try {
            $startTime = Carbon::parse($date->format('Y-m-d') . ' ' . $workingHours['start']);
            $endTime = Carbon::parse($date->format('Y-m-d') . ' ' . $workingHours['end']);
        } catch (\Exception $e) {
            return [];
        }

        $breaks = $workingHours['breaks'] ?? [];
        $current = $startTime->copy();

        while ($current->lt($endTime)) {
            $slotEnd = $current->copy()->addMinutes($slotDuration);

            if ($slotEnd->gt($endTime)) break;

            // –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê: –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ—Ä—ã–≤–æ–≤
            $slotAvailable = true;
            foreach ($breaks as $break) {
                if (!isset($break['start']) || !isset($break['end'])) continue;

                $breakStart = Carbon::parse($date->format('Y-m-d') . ' ' . $break['start']);
                $breakEnd = Carbon::parse($date->format('Y-m-d') . ' ' . $break['end']);

                // –°–ª–æ—Ç –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ—Å–µ–∫–∞—Ç—å—Å—è —Å –ø–µ—Ä–µ—Ä—ã–≤–æ–º
                if ($current->lt($breakEnd) && $slotEnd->gt($breakStart) &&
                    !$slotEnd->eq($breakStart) && !$current->eq($breakEnd)) {
                    $slotAvailable = false;
                    break;
                }
            }

            if ($slotAvailable) {
                $slots[] = [
                    'start' => $current->copy()->toDateTimeString(),
                    'end' => $slotEnd->copy()->toDateTimeString(),
                    'duration_minutes' => $slotDuration
                ];
            }

            $current->addMinutes($slotDuration);
        }

        return $slots;
    }

    private function generateDynamicSlots(Resource $resource, Carbon $date, array $workingHours, ResourceConfig $config): array
    {
        if (!isset($workingHours['working_hours'])) {
            return [];
        }

        $workingHours = $workingHours['working_hours'];

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ working_hours –∏–º–µ–µ—Ç –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è
        if (!isset($workingHours['start']) || !isset($workingHours['end'])) {
            return [];
        }

        $bookings = Booking::where('resource_id', $resource->id)
            ->whereDate('start', $date)
            ->whereIn('status', ['pending', 'confirmed'])
            ->orderBy('start')
            ->get();

        $slots = [];
        $slotDuration = $config->slot_duration_minutes ?? 60;

        try {
            $startTime = Carbon::parse($date->format('Y-m-d') . ' ' . $workingHours['start']);
            $endTime = Carbon::parse($date->format('Y-m-d') . ' ' . $workingHours['end']);
        } catch (\Exception $e) {
            return [];
        }

        $breaks = $workingHours['breaks'] ?? [];

        $availablePeriods = $this->getAvailablePeriods($startTime, $endTime, $bookings, $breaks);

        foreach ($availablePeriods as $period) {
            $current = $period['start']->copy();

            while ($current->addMinutes($slotDuration)->lte($period['end'])) {
                $slotStart = $current->copy()->subMinutes($slotDuration);
                $slotEnd = $current->copy();

                $slots[] = [
                    'start' => $slotStart->toDateTimeString(),
                    'end' => $slotEnd->toDateTimeString(),
                    'duration_minutes' => $slotDuration
                ];
            }
        }

        return $slots;
    }

    private function getAvailablePeriods(Carbon $startTime, Carbon $endTime, $bookings, array $breaks): array
    {
        $periods = [['start' => $startTime, 'end' => $endTime]];

        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        foreach ($bookings as $booking) {
            $newPeriods = [];
            foreach ($periods as $period) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø–µ—Ä–∏–æ–¥ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
                if (!isset($period['start']) || !isset($period['end'])) {
                    continue;
                }

                if ($booking->start >= $period['end'] || $booking->end <= $period['start']) {
                    $newPeriods[] = $period;
                } else {
                    if ($booking->start > $period['start']) {
                        $newPeriods[] = ['start' => $period['start'], 'end' => $booking->start];
                    }
                    if ($booking->end < $period['end']) {
                        $newPeriods[] = ['start' => $booking->end, 'end' => $period['end']];
                    }
                }
            }
            $periods = $newPeriods;
        }

        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–µ—Ä–µ—Ä—ã–≤—ã
        foreach ($breaks as $break) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø–µ—Ä–µ—Ä—ã–≤ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
            if (!isset($break['start']) || !isset($break['end'])) {
                continue;
            }

            try {
                $breakStart = Carbon::parse($startTime->format('Y-m-d') . ' ' . $break['start']);
                $breakEnd = Carbon::parse($startTime->format('Y-m-d') . ' ' . $break['end']);
            } catch (\Exception $e) {
                continue;
            }

            $newPeriods = [];
            foreach ($periods as $period) {
                if (!isset($period['start']) || !isset($period['end'])) {
                    continue;
                }

                if ($breakStart >= $period['end'] || $breakEnd <= $period['start']) {
                    $newPeriods[] = $period;
                } else {
                    if ($breakStart > $period['start']) {
                        $newPeriods[] = ['start' => $period['start'], 'end' => $breakStart];
                    }
                    if ($breakEnd < $period['end']) {
                        $newPeriods[] = ['start' => $breakEnd, 'end' => $period['end']];
                    }
                }
            }
            $periods = $newPeriods;
        }

        return $periods;
    }

    // –í app/Services/Booking/SlotGenerationService.php
    private function getWorkingHoursForDate($timetable, Carbon $date): ?array
    {
        if (!$timetable || !isset($timetable->schedule)) {
            return null;
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –¥–Ω–∏ –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
        if ($timetable->type === 'static') {
            $dateKey = $date->format('m-d');
            $holidays = $timetable->schedule['holidays'] ?? [];

            // –ï—Å–ª–∏ –¥–∞—Ç–∞ –≤ –ø—Ä–∞–∑–¥–Ω–∏–∫–∞—Ö - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º null
            if (in_array($dateKey, $holidays)) {
                return null;
            }

            $dayOfWeek = strtolower($date->englishDayOfWeek);

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã –¥–ª—è —ç—Ç–æ–≥–æ –¥–Ω—è –Ω–µ–¥–µ–ª–∏
            if (!isset($timetable->schedule['days'][$dayOfWeek])) {
                return null;
            }

            $daySchedule = $timetable->schedule['days'][$dayOfWeek];

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–µ–Ω—å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–±–æ—á–∏–π (–µ—Å—Ç—å —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã)
            if (!isset($daySchedule['working_hours']) ||
                !isset($daySchedule['working_hours']['start']) ||
                !isset($daySchedule['working_hours']['end']) ||
                empty($daySchedule['working_hours']['start']) ||
                empty($daySchedule['working_hours']['end'])) {
                return null;
            }

            return $daySchedule;
        } else {
            $dateKey = $date->format('m-d');
            return isset($timetable->schedule['dates'][$dateKey]) ? $timetable->schedule['dates'][$dateKey] : null;
        }
    }

    private function isTimeInBreaks(Carbon $start, Carbon $end, array $breaks): bool
    {
        foreach ($breaks as $break) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø–µ—Ä–µ—Ä—ã–≤ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
            if (!isset($break['start']) || !isset($break['end'])) {
                continue;
            }

            try {
                $breakStart = Carbon::parse($start->format('Y-m-d') . ' ' . $break['start']);
                $breakEnd = Carbon::parse($start->format('Y-m-d') . ' ' . $break['end']);
            } catch (\Exception $e) {
                continue;
            }

            if ($start < $breakEnd && $end > $breakStart) {
                return true;
            }
        }
        return false;
    }

    private function isSlotAvailable(Resource $resource, string $start, int $slots = 1): bool
    {
        try {
            $startTime = Carbon::parse($start);
        } catch (\Exception $e) {
            return false;
        }

        $config = $resource->getResourceConfig();
        $duration = ($config->slot_duration_minutes ?? 60) * $slots;
        $endTime = $startTime->copy()->addMinutes($duration);

        $overlapExists = Booking::where('resource_id', $resource->id)
            ->where('start', '<', $endTime)
            ->where('end', '>', $startTime)
            ->whereIn('status', ['pending', 'confirmed'])
            ->exists();

        return !$overlapExists;
    }
}



=== app/Services/Booking/BookingService.php ===
<?php
// app/Services/Booking/BookingService.php

namespace App\Services\Booking;

use App\Models\Booking;
use App\Models\Resource;
use App\Models\Booker;
use App\Enums\BookingStatus;
use App\ValueObjects\ResourceConfig;
use Illuminate\Support\Facades\DB;
use Carbon\Carbon;
use App\Services\Logging\BookingLoggerService;

class BookingService
{
    public function __construct(
        private SlotGenerationService $slotService
    ) {}

    /**
     * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω–∞ —Å —É—á–µ—Ç–æ–º –ø–µ—Ä–µ—Ä—ã–≤–æ–≤ –∏ –¥—Ä—É–≥–∏—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
     */
    public function isTimeRangeAvailable(Resource $resource, Carbon $start, Carbon $end): bool
    {
        // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        if (!$this->isRangeAvailable($resource, $start, $end)) {
            return false;
        }

        // –ó–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Ä—ã–≤—ã —Å –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ô –ª–æ–≥–∏–∫–æ–π
        if (!$this->isTimeAvailableConsideringBreaks($resource, $start, $end)) {
            return false;
        }

        return true;
    }

    public function isSlotAvailable(Resource $resource, string $start, int $slots = 1): bool
    {
        $startTime = Carbon::parse($start);
        $config = $resource->getResourceConfig();
        $duration = $config->slot_duration_minutes * $slots;
        $endTime = $startTime->copy()->addMinutes($duration);

        return $this->isRangeAvailable($resource, $startTime, $endTime);
    }

    // –í —Ñ–∞–π–ª–µ app/Services/Booking/BookingService.php

    public function isRangeAvailable(Resource $resource, Carbon $from, Carbon $to): bool
    {
        $overlapExists = Booking::where('resource_id', $resource->id)
            ->where(function ($query) use ($from, $to) {
                $query->where(function ($q) use ($from, $to) {
                    // –ë—Ä–æ–Ω—å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
                    $q->where('start', '>=', $from)
                        ->where('start', '<', $to);
                })->orWhere(function ($q) use ($from, $to) {
                    // –ë—Ä–æ–Ω—å –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
                    $q->where('end', '>', $from)
                        ->where('end', '<=', $to);
                })->orWhere(function ($q) use ($from, $to) {
                    // –ë—Ä–æ–Ω—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω
                    $q->where('start', '<', $from)
                        ->where('end', '>', $to);
                });
            })
            ->whereIn('status', [BookingStatus::PENDING->value, BookingStatus::CONFIRMED->value])
            ->exists();

        return !$overlapExists;
    }

    public function createBooking(
        Resource $resource,
        string $start,
        string $end,
        array $bookerData = [],
        bool $isAdmin = false
    ): Booking {
        return DB::transaction(function () use ($resource, $start, $end, $bookerData, $isAdmin) {
            $config = $resource->getResourceConfig();
            $startTime = Carbon::parse($start);
            $endTime = Carbon::parse($end);

            if (!$isAdmin) {
                $this->validateBookingTime($resource, $startTime, $endTime, $config);

                // –î–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
                if (!$this->isTimeRangeAvailable($resource, $startTime, $endTime)) {
                    throw new \Exception('–í—ã–±—Ä–∞–Ω–Ω—ã–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–∑–∞–Ω—è—Ç –∏–ª–∏ –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è —Å –ø–µ—Ä–µ—Ä—ã–≤–æ–º)');
                }
            } else {
                // –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—É—é –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –≤—Ä–µ–º–µ–Ω–∏
                if ($startTime >= $endTime) {
                    throw new \Exception('–í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ—Å–ª–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞');
                }

                // –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –±—Ä–æ–Ω–∏ –¥–∞–∂–µ –≤ –∑–∞–Ω—è—Ç–æ–µ –≤—Ä–µ–º—è
                // (–ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –±—Ä–æ–Ω–∏)
                $this->handleAdminBookingOverlap($resource, $startTime, $endTime);
            }

            $status = $config->requiresConfirmation() && !$isAdmin
                ? BookingStatus::PENDING
                : BookingStatus::CONFIRMED;

            $booking = Booking::create([
                'company_id' => $resource->company_id,
                'resource_id' => $resource->id,
                'timetable_id' => $resource->getEffectiveTimetable()?->id,
                'is_group_booking' => $config->isGroupResource(),
                'start' => $startTime,
                'end' => $endTime,
                'status' => $status->value,
            ]);

            if (!empty($bookerData)) {
                $this->attachBooker($booking, $bookerData);
            }

            BookingLoggerService::info("‚úÖ –ë—Ä–æ–Ω—å —Å–æ–∑–¥–∞–Ω–∞", [
                'booking_id' => $booking->id,
                'resource_id' => $resource->id,
                'status' => $booking->status,
                'is_admin' => $isAdmin
            ]);

            event(new \App\Events\BookingCreated($booking));

            return $booking;
        });
    }

    /**
     * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—Å–∫–∏—Ö –±—Ä–æ–Ω–µ–π
     * –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–º–µ–Ω—è–µ—Ç –ø–µ—Ä–µ—Å–µ–∫–∞—é—â–∏–µ—Å—è –±—Ä–æ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
     */
    private function handleAdminBookingOverlap(Resource $resource, Carbon $start, Carbon $end): void
    {
        $overlappingBookings = Booking::where('resource_id', $resource->id)
            ->where(function ($query) use ($start, $end) {
                $query->where(function ($q) use ($start, $end) {
                    $q->where('start', '<', $end)
                        ->where('end', '>', $start);
                });
            })
            ->whereIn('status', [BookingStatus::PENDING->value, BookingStatus::CONFIRMED->value])
            ->whereDoesntHave('bookers', function ($q) {
                $q->where('type', 'admin');
            })
            ->get();

        foreach ($overlappingBookings as $overlappingBooking) {
            $overlappingBooking->update([
                'status' => BookingStatus::CANCELLED_BY_ADMIN->value,
                'reason' => '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–º–µ–Ω–µ–Ω–∞ –∏–∑-–∑–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—Å–∫–æ–π –±—Ä–æ–Ω–∏'
            ]);

            BookingLoggerService::warning("‚ùå –ë—Ä–æ–Ω—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–º–µ–Ω–µ–Ω–∞ –∏–∑-–∑–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—Å–∫–æ–π", [
                'booking_id' => $overlappingBooking->id,
                'admin_booking_start' => $start,
                'admin_booking_end' => $end
            ]);

            event(new \App\Events\BookingCancelled($overlappingBooking));
        }
    }

    public function confirmBooking(int $bookingId): Booking
    {
        $booking = Booking::findOrFail($bookingId);

        if ($booking->status !== BookingStatus::PENDING->value) {
            throw new \Exception('–ú–æ–∂–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—Ä–æ–Ω–∏ –≤ —Å—Ç–∞—Ç—É—Å–µ –æ–∂–∏–¥–∞–Ω–∏—è');
        }

        $booking->status = BookingStatus::CONFIRMED->value;
        $booking->save();

        BookingLoggerService::info("‚úÖ –ë—Ä–æ–Ω—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞", ['booking_id' => $booking->id]);
        event(new \App\Events\BookingConfirmed($booking));

        return $booking;
    }

    public function cancelBooking(int $bookingId, string $cancelledBy = 'client', ?string $reason = null): Booking
    {
        $booking = Booking::findOrFail($bookingId);
        $config = $booking->resource->getResourceConfig();

        if ($cancelledBy === 'client' && !$config->canCancel($booking->start)) {
            throw new \Exception('–í—Ä–µ–º—è –¥–ª—è –æ—Ç–º–µ–Ω—ã –±—Ä–æ–Ω–∏ –∏—Å—Ç–µ–∫–ª–æ');
        }

        $status = $cancelledBy === 'admin'
            ? BookingStatus::CANCELLED_BY_ADMIN
            : BookingStatus::CANCELLED_BY_CLIENT;

        $booking->update([
            'status' => $status->value,
            'reason' => $reason
        ]);

        BookingLoggerService::warning("‚ùå –ë—Ä–æ–Ω—å –æ—Ç–º–µ–Ω–µ–Ω–∞", [
            'booking_id' => $booking->id,
            'cancelled_by' => $cancelledBy,
            'reason' => $reason
        ]);

        event(new \App\Events\BookingCancelled($booking));

        return $booking;
    }

    public function rescheduleBooking(
        int $bookingId,
        string $newStart,
        string $newEnd,
        string $requestedBy = 'client'
    ): Booking {
        return DB::transaction(function () use ($bookingId, $newStart, $newEnd, $requestedBy) {
            $booking = Booking::findOrFail($bookingId);
            $resource = $booking->resource;
            $config = $resource->getResourceConfig();

            if (BookingStatus::from($booking->status)->isCancelled()) {
                throw new \Exception('–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –æ—Ç–º–µ–Ω–µ–Ω–Ω—É—é –±—Ä–æ–Ω—å');
            }

            if ($requestedBy === 'client' && !$config->canReschedule($booking->start)) {
                throw new \Exception('–í—Ä–µ–º—è –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –±—Ä–æ–Ω–∏ –∏—Å—Ç–µ–∫–ª–æ');
            }

            $newStartTime = Carbon::parse($newStart);
            $newEndTime = Carbon::parse($newEnd);

            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
            if (!$this->isTimeRangeAvailable($resource, $newStartTime, $newEndTime)) {
                throw new \Exception('–ù–æ–≤—ã–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–∑–∞–Ω—è—Ç –∏–ª–∏ –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è —Å –ø–µ—Ä–µ—Ä—ã–≤–æ–º)');
            }

            $booking->update([
                'start' => $newStartTime,
                'end' => $newEndTime
            ]);

            BookingLoggerService::info("üîÅ –ë—Ä–æ–Ω—å –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞", [
                'booking_id' => $booking->id,
                'requested_by' => $requestedBy
            ]);

            event(new \App\Events\BookingRescheduled($booking));

            return $booking;
        });
    }

    public function getBookingsForResourceInRange(Resource $resource, string $from, string $to)
    {
        return Booking::where('resource_id', $resource->id)
            ->where('start', '<', $to)
            ->where('end', '>', $from)
            ->whereIn('status', [BookingStatus::PENDING->value, BookingStatus::CONFIRMED->value])
            ->get();
    }

    public function getNextAvailableSlots(
        Resource $resource,
        Carbon $from = null,
        int $count = 5,
        bool $onlyToday = true
    ): array {
        return $this->slotService->getNextAvailableSlots($resource, $from, $count, $onlyToday);
    }

    // –í app/Services/Booking/BookingService.php
    private function validateBookingTime(Resource $resource, Carbon $start, Carbon $end, ResourceConfig $config): void
    {
        $now = now();

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        if ($config->min_advance_time > 0) {
            $minutesUntilStart = $start->diffInMinutes($now, false); // false —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—à–µ–¥—à–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

            if ($minutesUntilStart < $config->min_advance_time) {
                throw new \Exception('–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –∑–∞ ' . $config->min_advance_time . ' –º–∏–Ω—É—Ç –¥–æ –Ω–∞—á–∞–ª–∞. –î–æ –Ω–∞—á–∞–ª–∞ –æ—Å—Ç–∞–ª–æ—Å—å: ' . $minutesUntilStart . ' –º–∏–Ω—É—Ç');
            }
        }

        // –î–ª—è —Å—Ç—Ä–æ–≥–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π (min_advance_time = 0) - –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –≤ –±—É–¥—É—â–µ–º
        if ($config->min_advance_time === 0 && $start <= $now) {
            throw new \Exception('–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –¥–ª—è –ø—Ä–æ—à–µ–¥—à–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏');
        }

        if ($start >= $end) {
            throw new \Exception('–í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ—Å–ª–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞');
        }

        if (!$this->isValidSlotTime($resource, $start, $end, $config)) {
            throw new \Exception('–í—ã–±—Ä–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–º —Å–ª–æ—Ç–∞–º');
        }
    }

    private function isValidSlotTime(Resource $resource, Carbon $start, Carbon $end, ResourceConfig $config): bool
    {
        if ($config->isFixedStrategy()) {
            $slots = $this->slotService->generateSlotsForDate($resource, $start);

            foreach ($slots as $slot) {
                if ($slot['start'] === $start->toDateTimeString() && $slot['end'] === $end->toDateTimeString()) {
                    return true;
                }
            }
            return false;
        }

        return true;
    }

    private function attachBooker(Booking $booking, array $bookerData): void
    {
        $booker = Booker::firstOrCreate(
            [
                'external_id' => $bookerData['external_id'] ?? null,
                'type' => $bookerData['type'] ?? 'client'
            ],
            [
                'name' => $bookerData['name'] ?? null,
                'email' => $bookerData['email'] ?? null,
                'phone' => $bookerData['phone'] ?? null,
                'metadata' => $bookerData['metadata'] ?? null,
            ]
        );

        $booking->bookers()->syncWithoutDetaching([$booker->id]);
    }

    /**
     * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤—Ä–µ–º–µ–Ω–∏ —Å —É—á–µ—Ç–æ–º –ø–µ—Ä–µ—Ä—ã–≤–æ–≤
     */
    public function isTimeAvailableConsideringBreaks(Resource $resource, Carbon $start, Carbon $end): bool
    {
        $timetable = $resource->getEffectiveTimetable();

        if (!$timetable) {
            return true;
        }

        $workingHours = $this->getWorkingHoursForDate($timetable, $start);

        if (!$workingHours) {
            return true;
        }

        $breaks = $workingHours['breaks'] ?? [];

        foreach ($breaks as $break) {
            if (!isset($break['start']) || !isset($break['end'])) {
                continue;
            }

            try {
                $breakStart = Carbon::parse($start->format('Y-m-d') . ' ' . $break['start']);
                $breakEnd = Carbon::parse($start->format('Y-m-d') . ' ' . $break['end']);
            } catch (\Exception $e) {
                continue;
            }

            // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π
            // –ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –µ—Å—Ç—å –µ—Å–ª–∏:
            // - –Ω–∞—á–∞–ª–æ –±—Ä–æ–Ω–∏ –≤–Ω—É—Ç—Ä–∏ –ø–µ—Ä–µ—Ä—ã–≤–∞ (–∏—Å–∫–ª—é—á–∞—è –∫–æ–Ω–µ—Ü –ø–µ—Ä–µ—Ä—ã–≤–∞)
            // - –∫–æ–Ω–µ—Ü –±—Ä–æ–Ω–∏ –≤–Ω—É—Ç—Ä–∏ –ø–µ—Ä–µ—Ä—ã–≤–∞ (–∏—Å–∫–ª—é—á–∞—è –Ω–∞—á–∞–ª–æ –ø–µ—Ä–µ—Ä—ã–≤–∞)
            // - –±—Ä–æ–Ω—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–µ—Ä–µ—Ä—ã–≤
            // - –ø–µ—Ä–µ—Ä—ã–≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–¥–µ—Ä–∂–∏—Ç –±—Ä–æ–Ω—å

            $startInBreak = $start->between($breakStart, $breakEnd, false);
            $endInBreak = $end->between($breakStart, $breakEnd, false);
            $spansBreak = $start->lt($breakStart) && $end->gt($breakEnd);
            $containedInBreak = $start->gte($breakStart) && $end->lte($breakEnd);

            // –î–û–ü–û–õ–ù–ï–ù–ò–ï: —Ä–∞–∑—Ä–µ—à–∞–µ–º –∫–∞—Å–∞–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü –ø–µ—Ä–µ—Ä—ã–≤–∞
            $touchesBreakStart = $end->eq($breakStart); // –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è —Ç–æ—á–Ω–æ –≤ –Ω–∞—á–∞–ª–µ –ø–µ—Ä–µ—Ä—ã–≤–∞ - –†–ê–ó–†–ï–®–ê–ï–ú
            $touchesBreakEnd = $start->eq($breakEnd);   // –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Ç–æ—á–Ω–æ –≤ –∫–æ–Ω—Ü–µ –ø–µ—Ä–µ—Ä—ã–≤–∞ - –†–ê–ó–†–ï–®–ê–ï–ú

            if ($startInBreak || $endInBreak || $spansBreak || $containedInBreak) {
                return false;
            }

            // –ó–∞–ø—Ä–µ—â–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –±—Ä–æ–Ω—å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –î–û –∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –ü–û–°–õ–ï –ø–µ—Ä–µ—Ä—ã–≤–∞
            // (–Ω–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∫–∞—Å–∞–µ—Ç—Å—è –≥—Ä–∞–Ω–∏—Ü)
            if ($start->lt($breakStart) && $end->gt($breakEnd) &&
                !$touchesBreakStart && !$touchesBreakEnd) {
                return false;
            }
        }

        return true;
    }

    /**
     * –ü–æ–ª—É—á–∞–µ—Ç —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã –¥–ª—è –¥–∞—Ç—ã
     */
    private function getWorkingHoursForDate($timetable, Carbon $date): ?array
    {
        if (!$timetable || !isset($timetable->schedule)) {
            return null;
        }

        if ($timetable->type === 'static') {
            $dayOfWeek = strtolower($date->englishDayOfWeek);
            return isset($timetable->schedule['days'][$dayOfWeek]) ? $timetable->schedule['days'][$dayOfWeek] : null;
        } else {
            $dateKey = $date->format('m-d');
            return isset($timetable->schedule['dates'][$dateKey]) ? $timetable->schedule['dates'][$dateKey] : null;
        }
    }
}



=== app/Services/ArtisanCommandService.php ===
<?php

namespace App\Services;

use Illuminate\Support\Facades\Artisan;
use Illuminate\Support\Facades\Cache;

class ArtisanCommandService
{
    /**
     * –í—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–º–∞–Ω–¥—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
     */
    public function generateStaticTimetable(int $companyId): array
    {
        // –í—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—É
        Artisan::call('timetable:generate-static', [
            'company_id' => $companyId
        ]);

        // –ü–æ–ª—É—á–∞–µ–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞
        $filePath = storage_path('app/exports/static_timetable_example.json');
        if (!file_exists($filePath)) {
            throw new \Exception('Static timetable example file not found');
        }

        $content = file_get_contents($filePath);
        return json_decode($content, true);
    }

    /**
     * –í—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–º–∞–Ω–¥—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
     */
    public function generateDynamicTimetable(int $companyId, int $days = 30): array
    {
        // –í—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—É
        Artisan::call('timetable:generate-dynamic', [
            'company_id' => $companyId,
            'days' => $days
        ]);

        // –ü–æ–ª—É—á–∞–µ–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞
        $filePath = storage_path('app/exports/dynamic_timetable_example.json');
        if (!file_exists($filePath)) {
            throw new \Exception('Dynamic timetable example file not found');
        }

        $content = file_get_contents($filePath);
        return json_decode($content, true);
    }

    /**
     * –ü–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏
     */
    public function getTimetableInfo(array $timetableData, string $type): array
    {
        if ($type === 'static') {
            $workingDays = count($timetableData['days'] ?? []);
            $totalBreaks = 0;

            foreach ($timetableData['days'] ?? [] as $day) {
                $totalBreaks += count($day['breaks'] ?? []);
            }

            return [
                'working_days' => $workingDays,
                'total_breaks' => $totalBreaks,
                'holidays' => count($timetableData['holidays'] ?? [])
            ];
        } else {
            $workingDays = count($timetableData['dates'] ?? []);
            $totalBreaks = 0;

            foreach ($timetableData['dates'] ?? [] as $date) {
                $totalBreaks += count($date['breaks'] ?? []);
            }

            return [
                'working_days' => $workingDays,
                'total_breaks' => $totalBreaks,
                'schedule_types' => array_unique(array_column($timetableData['dates'] ?? [], 'schedule_type'))
            ];
        }
    }
}



=== app/Services/Logging/BookingLoggerService.php ===
<?php

namespace App\Services\Logging;

use Illuminate\Support\Facades\Log;

class BookingLoggerService
{
    public static function info(string $message, array $context = []): void
    {
        Log::channel('booking')->info($message, $context);
    }

    public static function warning(string $message, array $context = []): void
    {
        Log::channel('booking')->warning($message, $context);
    }

    public static function error(string $message, array $context = []): void
    {
        Log::channel('booking')->error($message, $context);
    }

    public static function debug(string $message, array $context = []): void
    {
        Log::channel('booking')->debug($message, $context);
    }
}



=== database/factories/UserFactory.php ===
<?php

namespace Database\Factories;

use Illuminate\Database\Eloquent\Factories\Factory;
use Illuminate\Support\Facades\Hash;
use Illuminate\Support\Str;

/**
 * @extends \Illuminate\Database\Eloquent\Factories\Factory<\App\Models\User>
 */
class UserFactory extends Factory
{
    /**
     * The current password being used by the factory.
     */
    protected static ?string $password;

    /**
     * Define the model's default state.
     *
     * @return array<string, mixed>
     */
    public function definition(): array
    {
        return [
            'name' => fake()->name(),
            'email' => fake()->unique()->safeEmail(),
            'email_verified_at' => now(),
            'password' => static::$password ??= Hash::make('password'),
            'remember_token' => Str::random(10),
        ];
    }

    /**
     * Indicate that the model's email address should be unverified.
     */
    public function unverified(): static
    {
        return $this->state(fn (array $attributes) => [
            'email_verified_at' => null,
        ]);
    }
}



=== database/migrations/2025_01_15_000003_create_resource_types_table.php ===
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('resource_types', function (Blueprint $table) {
            $table->id();
            $table->unsignedBigInteger('company_id');
            $table->unsignedBigInteger('timetable_id')->nullable();
            $table->string('type', 63);
            $table->string('name', 127);
            $table->string('description', 255)->nullable();
            $table->json('options')->nullable();
            $table->json('resource_config')->nullable();
            $table->timestamps();
            $table->unique(['company_id', 'type']);

            $table->foreign('company_id')->references('id')->on('companies')->cascadeOnDelete();
            $table->foreign('timetable_id')->references('id')->on('timetables')->nullOnDelete();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('resource_types');
    }
};



=== database/migrations/2014_10_12_000000_create_users_table.php ===
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('users', function (Blueprint $table) {
            $table->id();
            $table->string('name');
            $table->string('email')->unique();
            $table->timestamp('email_verified_at')->nullable();
            $table->string('password');
            $table->rememberToken();
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('users');
    }
};



=== database/migrations/2025_01_15_000004_create_resources_table.php ===
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('resources', function (Blueprint $table) {
            $table->id();
            $table->unsignedBigInteger('company_id');
            $table->unsignedBigInteger('timetable_id')->nullable();
            $table->foreignId('resource_type_id')->constrained('resource_types')->cascadeOnDelete();
            $table->json('options')->nullable();
            $table->json('payload')->nullable();
            $table->json('resource_config')->nullable();
            $table->timestamps();

            $table->foreign('company_id')->references('id')->on('companies')->cascadeOnDelete();
            $table->foreign('timetable_id')->references('id')->on('timetables')->nullOnDelete();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('resources');
    }
};



=== database/migrations/2025_01_15_100000_create_booking_tables.php ===
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        // –¢–∞–±–ª–∏—Ü–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
        Schema::create('bookings', function (Blueprint $table) {
            $table->id();
            $table->unsignedBigInteger('company_id');
            $table->foreignId('resource_id')->constrained('resources')->cascadeOnDelete();
            $table->foreignId('timetable_id')->nullable()->constrained('timetables')->nullOnDelete();
            $table->boolean('is_group_booking')->default(false);
            $table->dateTime('start');
            $table->dateTime('end');
            $table->string('status')->default('pending');
            $table->string('reason', 255)->nullable();
            $table->timestamps();

            $table->foreign('company_id')->references('id')->on('companies')->cascadeOnDelete();
            $table->index(['resource_id', 'start', 'end']);
            $table->index(['company_id', 'start']);
        });

        // –¢–∞–±–ª–∏—Ü–∞ –±—Ä–æ–Ω–∏—Ä—É—é—â–∏—Ö (–∫–ª–∏–µ–Ω—Ç–æ–≤/–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤)
        Schema::create('bookers', function (Blueprint $table) {
            $table->id();
            $table->string('external_id')->nullable();
            $table->string('type');
            $table->string('name')->nullable();
            $table->string('email')->nullable();
            $table->string('phone')->nullable();
            $table->json('metadata')->nullable();
            $table->timestamps();

            $table->index(['external_id', 'type']);
        });

        // –°–≤—è–∑—É—é—â–∞—è —Ç–∞–±–ª–∏—Ü–∞ –º–µ–∂–¥—É –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏ –∏ –±—Ä–æ–Ω–∏—Ä—É—é—â–∏–º–∏
        Schema::create('booking_booker', function (Blueprint $table) {
            $table->id();
            $table->foreignId('booking_id')->constrained()->cascadeOnDelete();
            $table->foreignId('booker_id')->constrained()->cascadeOnDelete();
            $table->timestamps();

            $table->unique(['booking_id', 'booker_id']);
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('booking_booker');
        Schema::dropIfExists('bookers');
        Schema::dropIfExists('bookings');
    }
};



=== database/migrations/2025_01_15_000001_create_companies_table.php ===
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('companies', function (Blueprint $table) {
            $table->unsignedBigInteger('id')->primary();
            $table->string('name')->nullable();
            $table->text('description')->nullable();
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('companies');
    }
};



=== database/migrations/2014_10_12_100000_create_password_reset_tokens_table.php ===
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('password_reset_tokens', function (Blueprint $table) {
            $table->string('email')->primary();
            $table->string('token');
            $table->timestamp('created_at')->nullable();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('password_reset_tokens');
    }
};



=== database/migrations/2019_12_14_000001_create_personal_access_tokens_table.php ===
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('personal_access_tokens', function (Blueprint $table) {
            $table->id();
            $table->morphs('tokenable');
            $table->string('name');
            $table->string('token', 64)->unique();
            $table->text('abilities')->nullable();
            $table->timestamp('last_used_at')->nullable();
            $table->timestamp('expires_at')->nullable();
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('personal_access_tokens');
    }
};



=== database/migrations/2019_08_19_000000_create_failed_jobs_table.php ===
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('failed_jobs', function (Blueprint $table) {
            $table->id();
            $table->string('uuid')->unique();
            $table->text('connection');
            $table->text('queue');
            $table->longText('payload');
            $table->longText('exception');
            $table->timestamp('failed_at')->useCurrent();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('failed_jobs');
    }
};



=== database/migrations/2025_01_15_000002_create_timetables_table.php ===
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('timetables', function (Blueprint $table) {
            $table->id();
            $table->unsignedBigInteger('company_id');
            $table->string('type', 32)->default('static');
            $table->json('schedule')->nullable();
            $table->timestamps();

            $table->foreign('company_id')->references('id')->on('companies')->cascadeOnDelete();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('timetables');
    }
};



=== database/seeders/DatabaseSeeder.php ===
<?php

namespace Database\Seeders;

// use Illuminate\Database\Console\Seeds\WithoutModelEvents;
use Illuminate\Database\Seeder;

class DatabaseSeeder extends Seeder
{
    /**
     * Seed the application's database.
     */
    public function run(): void
    {
        // \App\Models\User::factory(10)->create();

        // \App\Models\User::factory()->create([
        //     'name' => 'Test User',
        //     'email' => 'test@example.com',
        // ]);
    }
}



=== database/.gitignore ===
*.sqlite*



=== routes/api.php ===
<?php

use Illuminate\Support\Facades\Route;

// =============================================
// Booking System Routes - Core Entities
// =============================================

use App\Http\Controllers\CompanyController;
use App\Http\Controllers\TimetableController;
use App\Http\Controllers\ResourceTypeController;
use App\Http\Controllers\ResourceController;
use App\Http\Controllers\Api\BookingController;
use App\Http\Controllers\Api\TimetableImportController;

// Core Entities CRUD
Route::apiResource('companies', CompanyController::class);
Route::apiResource('timetables', TimetableController::class);
Route::apiResource('resource-types', ResourceTypeController::class);
Route::apiResource('resources', ResourceController::class);

// Additional timetable routes
Route::prefix('timetables/{timetable}')->group(function () {
    Route::post('/attach-resource', [TimetableController::class, 'attachResource']);
    Route::post('/detach-resource', [TimetableController::class, 'detachResource']);
    Route::post('/attach-resource-type', [TimetableController::class, 'attachResourceType']);
    Route::post('/detach-resource-type', [TimetableController::class, 'detachResourceType']);
});

// =============================================
// Booking System Routes - Booking Functionality
// =============================================

Route::prefix('booking')->group(function () {
    Route::get('/resources', [BookingController::class, 'getResources']);
    Route::get('/{resource}/slots', [BookingController::class, 'getAvailableSlots']);
    Route::post('/create', [BookingController::class, 'createBooking']);
    Route::post('/{id}/confirm', [BookingController::class, 'confirmBooking']);
    Route::post('/{id}/cancel', [BookingController::class, 'cancelBooking']);
    Route::post('/{id}/reschedule', [BookingController::class, 'rescheduleBooking']);
    Route::get('/resource/{id}/bookings', [BookingController::class, 'getBookingsForResource']);
    Route::get('/check', [BookingController::class, 'checkSlotAvailability']);
});

// =============================================
// Timetable Import Routes
// =============================================

Route::prefix('timetables')->group(function () {
    Route::post('/import-json', [TimetableImportController::class, 'importFromJson']);
    Route::post('/import-file', [TimetableImportController::class, 'importFromFile']);
});




=== routes/console.php ===
<?php

use Illuminate\Foundation\Inspiring;
use Illuminate\Support\Facades\Artisan;

/*
|--------------------------------------------------------------------------
| Console Routes
|--------------------------------------------------------------------------
|
| This file is where you may define all of your Closure based console
| commands. Each Closure is bound to a command instance allowing a
| simple approach to interacting with each command's IO methods.
|
*/

Artisan::command('inspire', function () {
    $this->comment(Inspiring::quote());
})->purpose('Display an inspiring quote');



=== routes/web.php ===
<?php

use Illuminate\Support\Facades\Route;

/*
|--------------------------------------------------------------------------
| Web Routes
|--------------------------------------------------------------------------
|
| Here is where you can register web routes for your application. These
| routes are loaded by the RouteServiceProvider and all of them will
| be assigned to the "web" middleware group. Make something great!
|
*/

Route::get('/', function () {
    return view('welcome');
});



=== routes/channels.php ===
<?php

use Illuminate\Support\Facades\Broadcast;

/*
|--------------------------------------------------------------------------
| Broadcast Channels
|--------------------------------------------------------------------------
|
| Here you may register all of the event broadcasting channels that your
| application supports. The given channel authorization callbacks are
| used to check if an authenticated user can listen to the channel.
|
*/

Broadcast::channel('App.Models.User.{id}', function ($user, $id) {
    return (int) $user->id === (int) $id;
});



